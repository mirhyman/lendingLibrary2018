if (self.CavalryLogger) { CavalryLogger.start_js(["F862F"]); }

__d("IrisProtocolMessageLifetime",[],(function a(b,c,d,e,f,g){f.exports={TTL_OFF:0,TTL_ON_UNKNOWN:1,TTL_30SECONDS:3e4,TTL_1MINUTE:6e4,TTL_3MINUTES:18e4,TTL_5MINUTES:3e5,TTL_10MINUTES:6e5,TTL_15MINUTES:9e5,TTL_30MINUTES:18e5,TTL_1HOUR:36e5,TTL_2HOURS:72e5,TTL_4HOURS:144e5,TTL_8HOURS:288e5,TTL_12HOURS:432e5,TTL_24HOURS:864e5}}),null);
__d("MessageLiveLocationClientSyncProtocolStopReason",[],(function a(b,c,d,e,f,g){f.exports={EXPIRED:1,CANCELED:2,ARRIVED:3}}),null);
__d("WorkUserAvailabilityStatusType",[],(function a(b,c,d,e,f,g){f.exports={NONE:"None",AVAILABLE:"Available",SPORADIC:"Sporadic",TENTATIVE:"Tentative",BUSY:"Busy",DO_NOT_DISTURB:"Do Not Disturb",FOCUS:"Focus"}}),null);
__d("MercurySyncHolesTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("logger:MercurySyncHolesLoggerConfig",this.$MercurySyncHolesTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("logger:MercurySyncHolesLoggerConfig",this.$MercurySyncHolesTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$MercurySyncHolesTypedLogger1={};return this};h.prototype.updateData=function(j){this.$MercurySyncHolesTypedLogger1=babelHelpers["extends"]({},this.$MercurySyncHolesTypedLogger1,j);return this};h.prototype.setDifference=function(j){this.$MercurySyncHolesTypedLogger1.difference=j;return this};h.prototype.setSeqID=function(j){this.$MercurySyncHolesTypedLogger1.seq_id=j;return this};h.prototype.setTopicType=function(j){this.$MercurySyncHolesTypedLogger1.topic_type=j;return this};h.prototype.setVC=function(j){this.$MercurySyncHolesTypedLogger1.vc=j;return this};var i={difference:true,seq_id:true,topic_type:true,vc:true};f.exports=h}),null);
__d("ChatActivity",["Arbiter","Event","JSLogger","MercuryConfig","PresenceState","UserActivity"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("MercuryConfig").activity_limit||6e4,i=c("MercuryConfig").idle_limit||18e5,j=c("MercuryConfig").idle_poll_interval||3e5,k=c("JSLogger").create("chat_activity"),l=Date.now(),m=true;function n(){var r=Date.now();return!!(m&&r-l<h)}var o=Object.assign(new(c("Arbiter"))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug("idle_to_active",r);c("PresenceState").doSync()}o.inform("activity")}c("Event").listen(window,"focus",function(){m=true;p()});c("Event").listen(window,"blur",function(){m=false});c("UserActivity").subscribe(function(){p()});function q(r){var s=r&&r.at&&c("PresenceState").verifyNumber(r.at);if(typeof s!=="number")s=null;return s||0}setInterval(function(){var r=Date.now(),s=q(c("PresenceState").get()),t=Math.max(l,s);if(r-t>i){k.debug("idle",{cookie:s,local:l});o.inform("idle",r-t)}},j);c("PresenceState").registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r});c("Arbiter").subscribe(c("JSLogger").DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l}});f.exports=o}),null);
__d("MercuryNotificationRenderer",["fbt","MercuryAssert","MercuryIDs","MercuryMessages","MercuryParticipants","MercuryThreads","MercuryViewer","MessagingGenericAdminTextType"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=c("MercuryMessages").get(),j=c("MercuryThreads").get(),k="source:messenger_growth:event_upcoming_bump";function l(m,n){__p&&__p();c("MercuryAssert").isThreadID(m);j.getThreadMeta(m,function(o){__p&&__p();i.getThreadMessagesRange(m,0,1,function(p){__p&&__p();var q=p.length&&p[p.length-1],r=[];if(q.tags!==undefined)r=r.concat(q.tags);if(q.log_message_data&&(q.log_message_data.message_type==c("MessagingGenericAdminTextType").CONFIRM_FRIEND_REQUEST||q.log_message_data.message_type==c("MessagingGenericAdminTextType").WORK_INVITE_CLAIMED))n(h._("New contact added"));else if(r.indexOf(k)!==-1)n(h._("You have an upcoming event."));else if(q&&q.author!=c("MercuryViewer").getID())c("MercuryParticipants").get(q.author,function(s){__p&&__p();var t=s.short_name,u=o.custom_nickname;if(u){var v=c("MercuryIDs").getUserIDFromParticipantID(s.id);if(u[v])t=u[v]}if(o.name)n(h._("{senderName} messaged {groupName}",[h.param("senderName",t),h.param("groupName",o.name)]));else if(c("MercuryIDs").isGroupChat(m))n(h._("{name} messaged your group",[h.param("name",t)]));else n(h._("{name} messaged you",[h.param("name",t)]))});else n(h._("New message!"))})})}f.exports={renderDocumentTitle:l}}),null);
__d("MercuryTimestampTracker",["MercuryActionType","MercuryDispatcher","MercuryPayloadSource","MercurySingletonProvider"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};function h(j){this.$MercuryTimestampTracker1=j;this.$MercuryTimestampTracker3=0;this.$MercuryTimestampTracker2=c("MercuryDispatcher").getForFBID(this.$MercuryTimestampTracker1);this.$MercuryTimestampTracker2.subscribe("update-messages",this.$MercuryTimestampTracker4.bind(this))}h.prototype.$MercuryTimestampTracker4=function(j,k){if(!k.actions||!k.actions.length)return;if(k.payload_source===c("MercuryPayloadSource").CLIENT_SEND_MESSAGE||k.payload_source===c("MercuryPayloadSource").UNKNOWN)return;for(var l=0;l<k.actions.length;l++){var m=k.actions[l],n=m.action_type;if(n==c("MercuryActionType").USER_GENERATED_MESSAGE&&m.thread_id&&m.timestamp>this.$MercuryTimestampTracker3)this.$MercuryTimestampTracker3=m.timestamp}};h.prototype.getLastUserMessageTimestamp=function(){return this.$MercuryTimestampTracker3};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryThreadInformer").get(),i=c("MercuryTimestampTracker").get(),j=c("JSLogger").create("chat_title"),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true}return false}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c("PresenceState").doSync()}}var p={blink:function u(v,w){if(!k&&l<w)c("MercuryNotificationRenderer").renderDocumentTitle(v,function(x){if(!k)k=c("DocumentTitle").blink(x)})},stopBlinking:function u(){o()},blinkingElsewhere:function u(){m=true}};function q(u){var v=c("PresenceState").verifyNumber(u.sb2);if(!v||v<=l)return null;return v}function r(u){var v=u&&q(u);if(v){l=v;j.debug("load",l);n();m=false}}function s(u){var v=q(u);if(!v){j.debug("store",l);u.sb2=l;m=false}return u}c("PresenceState").registerStateStorer(s);c("PresenceState").registerStateLoader(r);h.subscribe("thread-read-changed",function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x)});c("ChatActivity").subscribe("activity",function(){return o()});var t=c("PresenceState").getInitial();if(t)l=q(t)||0;f.exports=p}),null);
__d("MercuryIgnoredBlockedParticipants.bs",["bs_caml_obj","bs_js_boolean","MercuryIDs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(l,m,n){var o=n.participants.filter(function(p){return+(p!==c("MercuryIDs").getParticipantIDFromUserID(l))});return o.filter(function(p){return+(+m.has(p)!==0)})}function i(l,m,n){return c("bs_js_boolean").to_js_boolean(1-+n.is_canonical&&+(h(l,m,n).length>0))}function j(l,m,n){if(n.is_canonical)return[];else return h(l,m,n)}function k(l,m,n){var o=+n.is_canonical;if(o!==0){var p=n.participants.filter(function(q){return c("bs_caml_obj").caml_notequal(q,c("MercuryIDs").getParticipantIDFromUserID(l))});return c("bs_js_boolean").to_js_boolean(1-+p.every(function(q){return 1-+m.has(q)}))}else return false}g.findIntersection=h;g.isPresentInGroupThread=i;g.participantsInGroupThread=j;g.qualifiesAs=k}),null);
__d("MercuryBlockedParticipants.bs",["Set","Utils.bs","MercuryIDs","bs_js_primitive","MercuryDispatcher","MercurySingletonProvider.bs","MercuryIgnoredBlockedParticipants.bs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(m,n){__p&&__p();var o=n.message_blocked_ids;if(o==null)return 0;else{o.forEach(function(p){if(m.has(p)){+m["delete"](p);return 0}else{m.add(p);return 0}});return 0}}function i(m){__p&&__p();var n=new(c("Set"))(),o=c("MercuryDispatcher").getForFBID(m);o.subscribe("update-blocked-users",function(p,q){__p&&__p();var r=q.actions;if(!(r==null))r.forEach(function(t){return h(n,t)});h(n,q);var s=c("Utils.bs").$pipe$unknown(c("bs_js_primitive").null_undefined_to_opt(q.participants),[]);s.forEach(function(t){__p&&__p();var r=c("Utils.bs").nullUndefinedBooleanToOptionBool(t.is_messenger_blocked),u=t.fbid;if(r)if(r[0]!==0)if(u==null)return 0;else{n.add(c("MercuryIDs").getParticipantIDFromUserID(u));return 0}else if(u==null)return 0;else{+n["delete"](c("MercuryIDs").getParticipantIDFromUserID(u));return 0}else return 0});return 0});return{findIntersection:function p(q){return c("MercuryIgnoredBlockedParticipants.bs").findIntersection(m,n,q)},isPresentInGroupThread:function p(q){return c("MercuryIgnoredBlockedParticipants.bs").isPresentInGroupThread(m,n,q)},blockedParticipantsInGroupThread:function p(q){return c("MercuryIgnoredBlockedParticipants.bs").participantsInGroupThread(m,n,q)},isMessageBlocked:function p(q){return c("MercuryIgnoredBlockedParticipants.bs").qualifiesAs(m,n,q)},__fbid:m}}var j=c("MercurySingletonProvider.bs").Provider([i]),k=j[0],l=j[1];g.getForFBID=k;g.get=l}),null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","Event","Map","MercuryBlockedParticipants.bs","MercuryIDs","MercuryThreadInfo","MercuryThreads","MercuryViewer","MessagingTag","Sound","UserActivity"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryBlockedParticipants.bs").get(),i=c("MercuryThreads").get(),j=3,k=6e5,l=new(c("Map"))(),m=null;function n(){return!c("UserActivity").isOnTab()&&!c("UserActivity").hasBeenInactive()}function o(){l=new(c("Map"))()}function p(r){if(c("ChatOptions").getSetting("sound")&&!n())c("Sound").play([c("ChatConfig").get("sound.notif_ogg_url"),c("ChatConfig").get("sound.notif_mp3_url")],r,false)}var q=Object.assign({init:function r(){c("Event").listen(window,"focus",function(){o();clearInterval(m)});c("Event").listen(window,"blur",function(){m=setInterval(o,k)})},messageReceived:function r(s){__p&&__p();if(s.author&&c("MercuryViewer").isViewer(s.author)||!s.is_unread||s.folder!=c("MessagingTag").INBOX&&s.folder!=c("MessagingTag").ARCHIVED)return;var t=s.thread_id,u=c("ChatActivity").isActive();if(u){var v=false;q.inform("before-alert",{threadID:t,cancelAlert:function w(){v=true}})}i.getThreadMeta(t,function(w){__p&&__p();var x=c("MercuryThreadInfo").isMuted(w),y=c("MercuryIDs").getUserIDFromParticipantID(c("MercuryViewer").getID());if(x)if(!c("MercuryThreadInfo").areMentionsMuted(w)){if(!s.profile_ranges||!s.profile_ranges.some||!s.profile_ranges.some(function(B){return B.id===y}))return}else return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u)!v&&p(z);else{c("ChatTitleBarBlinker").blink(t,z);var A=l.get(t)||0;if(A<j){l.set(t,A+1);p(z)}}c("ChatTitleBarBlinker").blinkingElsewhere()})}},c("ArbiterMixin"));f.exports=q}),null);
__d("ChatAppActions",["ChatDispatcher","ChatAppActionTypes"],(function a(b,c,d,e,f,g){"use strict";var h={tti:function i(){c("ChatDispatcher").dispatch({type:c("ChatAppActionTypes").TTI})},hide:function i(){c("ChatDispatcher").dispatch({type:c("ChatAppActionTypes").HIDE})},unhide:function i(){c("ChatDispatcher").dispatch({type:c("ChatAppActionTypes").UNHIDE})},setInitialDisplayDone:function i(){c("ChatDispatcher").dispatch({type:c("ChatAppActionTypes").INITIAL_DISPLAY_DONE})},load:function i(){c("ChatDispatcher").dispatch({type:c("ChatAppActionTypes").LOAD})}};f.exports=h}),null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy"],(function a(b,c,d,e,f,g){__p&&__p();var h=function h(i,j){__p&&__p();this._userID=i;this._logger=c("JSLogger").create("blackbird");this._getState=function(){if(c("ChatVisibility").isOnline())return c("PresencePrivacy").allows(this._userID)?h.NORMAL:h.BLOCKED;return h.OFFLINE};this._togglePrivacy=function(){__p&&__p();var l=this._getState();switch(this._getState()){case h.OFFLINE:if(c("ChatVisibility").isOnline()){this._logger.error("tabs_already_online");break}this._logger.log("tabs_go_online",{tab_id:this._userID});c("ChatVisibility").goOnline(function(){if(!c("PresencePrivacy").allows(this._userID)){if(this._getState()!==h.BLOCKED)this._logger.error("privacy_action_controller_blocked_inconsistency");this._togglePrivacy()}}.bind(this));break;case h.BLOCKED:c("PresencePrivacy").allow(this._userID);this._logger.log("tabs_unblock",{tab_id:this._userID});break;case h.NORMAL:c("PresencePrivacy").disallow(this._userID);this._logger.log("tabs_block",{tab_id:this._userID});break}};var k=function(){j&&j(this._getState())}.bind(this);k();this._subscribeToken=c("PresencePrivacy").subscribe("privacy-changed",k)};h.OFFLINE="offline";h.BLOCKED="blocked";h.NORMAL="normal";Object.assign(h.prototype,{togglePrivacy:function i(){this._logger.log("gear_menu_toggle_privacy",{tab_id:this._userID});this._togglePrivacy()},destroy:function i(){this._subscribeToken&&c("PresencePrivacy").unsubscribe(this._subscribeToken)}});f.exports=h}),null);
__d("MontageDispatcher",["ExplicitRegistrationDispatcher"],(function a(b,c,d,e,f,g){"use strict";var h,i;h=babelHelpers.inherits(j,c("ExplicitRegistrationDispatcher"));i=h&&h.prototype;function j(){h.apply(this,arguments)}f.exports=new j({strict:false})}),null);
__d("MontageActions",["MontageDispatcher","keyMirror"],(function a(b,c,d,e,f,g){"use strict";var h=c("keyMirror")({REQUEST_UPDATE:null,HAS_UPDATED:null}),i={Types:h,requestUpdate:function j(k){c("MontageDispatcher").dispatch({type:h.REQUEST_UPDATE,threadFBID:k})},hasUpdated:function j(k){c("MontageDispatcher").dispatch({type:h.HAS_UPDATED,threadFBID:k})}};f.exports=i}),null);
__d("MercuryTypeaheadDataSource",["CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles","WorkModeConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h,i,j=[],k={},l={},m={},n=[],o=false,p=false;h=babelHelpers.inherits(q,c("DataSource"));i=h&&h.prototype;function q(r){"use strict";r=r||{};r.kanaNormalization=true;i.constructor.call(this,r);this.showDefaultList=r.showDefaultList||false}q.prototype.dirty=function(){"use strict";this.$MercuryTypeaheadDataSource1=j;this.localCache=l;this.queryCache=k;this.queryIDs=m;this.defaultList=n;return this};q.prototype.bootstrap=function(){"use strict";__p&&__p();if(o||p)return false;p=true;c("ShortProfiles").fetchAll().then(function(){this.updateBootstrapData();p=false;o=true;if(this.showDefaultList)this.inform("show-default")}.bind(this),function(){}.bind(this));return true};q.prototype.updateBootstrapData=function(){"use strict";__p&&__p();var r=this.getCachedShortProfileIDs(),s=c("WorkModeConfig").is_work_user?c("MercuryParticipantTypes").FB4C:c("MercuryParticipantTypes").FRIEND,t=r.map(function(v){var w=c("ShortProfiles").getNow(v),x=v==c("CurrentUser").getID()?s:w.type,y=[w.additionalName,w.alternateName].concat(w.searchTokens||[]).join(" "),z=w.name,A=null;return{uid:v,index:c("OrderedFriendsList").getActiveRank(v),text:z,subtext:A,tokens:y,localized_text:w.name,additional_text:w.additionalName,photo:w.thumbSrc,render_type:x,type:c("MercuryTypeaheadConstants").USER_TYPE}});if(t.length)this.addEntries(t);if(!this.showDefaultList)return;var u=t.sort(function(v,w){return v.index-w.index}).slice(0,5);n=this.buildData(u.map(function(v){return v.uid}));this.defaultList=n};q.prototype.query=function(r,s,t,u){"use strict";var v=s||r.length===1;return i.query.call(this,r,v,t,u)};q.prototype.getQueryData=function(r,s){"use strict";return babelHelpers["extends"]({},i.getQueryData.call(this,r,s))};q.prototype.setEntry=function(r,s){"use strict";this.$MercuryTypeaheadDataSource1[r]=s};q.prototype.getEntry=function(r){"use strict";return this.$MercuryTypeaheadDataSource1[r]||null};q.prototype.getCachedShortProfileIDs=function(){"use strict";var r=c("ShortProfiles").getCachedProfileIDs(),s=r.filter(function(t){var u=c("ShortProfiles").getNow(t);return t==c("CurrentUser").getID()||u.type===c("MercuryParticipantTypes").FRIEND||u.type===c("MercuryParticipantTypes").FB4C});return s};q.prototype.isBootstrapped=function(){"use strict";return o};q.prototype.isBootstrapping=function(){"use strict";return p};q.prototype.processEntries=function(r,s){"use strict";r=r.map(function(t){if(t.index==null&&(t.render_type===c("MercuryParticipantTypes").FRIEND||t.render_type===c("MercuryParticipantTypes").FB4C))t.index=c("OrderedFriendsList").getActiveRank(t.uid);return t});return i.processEntries.call(this,r)};q.prototype.mergeUids=function(r,s,t,u){"use strict";var v=s.sort(function(w,x){return this.getEntry(w).index-this.getEntry(x).index}.bind(this));return i.mergeUids.call(this,r,v,t,u)};q.prototype.setShowDefaultList=function(r){"use strict";this.showDefaultList=r};f.exports=q}),null);
__d("ChatTabTypeaheadDataSource",["MercuryTypeaheadConstants","MercuryTypeaheadDataSource"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("MercuryTypeaheadDataSource"));i=h&&h.prototype;function j(k){"use strict";k=k||{};k.maxResults=c("MercuryTypeaheadConstants").COMPOSER_CHATTAB_MAX;i.constructor.call(this,k);this.$ChatTabTypeaheadDataSource1=true}j.prototype.buildData=function(k){"use strict";__p&&__p();var l=[],m=[],n=[],o=[],p=[],q=[],r=[];k.forEach(function(t){__p&&__p();var u=i.getEntry.call(this,t);switch(u.render_type){case c("MercuryTypeaheadConstants").FRIEND_TYPE:l.push(t);break;case c("MercuryTypeaheadConstants").THREAD_TYPE:if(this.$ChatTabTypeaheadDataSource1)m.push(t);break;case c("MercuryTypeaheadConstants").NON_FRIEND_TYPE:n.push(t);break;case c("MercuryTypeaheadConstants").FB4C_TYPE:o.push(t);break;case c("MercuryTypeaheadConstants").PAGE_TYPE:if(this.$ChatTabTypeaheadDataSource1)p.push(t);break;case c("MercuryTypeaheadConstants").INTERNAL_BOT_PAGE_TYPE:r.push(t);break;default:break}}.bind(this),this);var s=q.concat(l,o,m,p,n,r);return i.buildData.call(this,s)};j.prototype.query=function(k,l,m,n){"use strict";return i.query.call(this,k,l,m,n)};j.prototype.respond=function(k,l,m){"use strict";return i.respond.call(this,k,l,m)};j.prototype.setShowThreads=function(k){"use strict";this.$ChatTabTypeaheadDataSource1=k};f.exports=j}),null);
__d("DisplayGenderConst",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({UNKNOWN:"UNKNOWN",FEMALE:"FEMALE",MALE:"MALE",NEUTER:"NEUTER"})}),null);
__d("bs_js_types",["bs_block"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(k){__p&&__p();if(typeof k==="undefined")return[0,k];else if(k===null)return[1,k];else if(typeof k==="number")return[3,k];else if(typeof k==="string")return[4,k];else if(typeof k==="boolean")return[2,k];else if(typeof k==="function")return[5,k];else if(typeof k==="object")return[6,k];else return[7,k]}function i(k){__p&&__p();var l=typeof k;if(l==="undefined")return 3;else if(k===null)return 2;else if(l==="number")return c("bs_block").__(0,[k]);else if(l==="string")return c("bs_block").__(1,[k]);else if(l==="boolean")if(k===true)return 1;else return 0;else if(l==="function")return c("bs_block").__(2,[k]);else if(l==="object")return c("bs_block").__(3,[k]);else return c("bs_block").__(4,[k])}function j(k,l){switch(l){case 0:return+(typeof k==="undefined");case 1:return+(k===null);case 2:return+(typeof k==="boolean");case 3:return+(typeof k==="number");case 4:return+(typeof k==="string");case 5:return+(typeof k==="function");case 6:return+(typeof k==="object");case 7:return+(typeof k==="symbol")}}g.reify_type=h;g.test=j;g.classify=i}),null);
__d("FBID.bs",["invariant","bs_js_exn","bs_string","gkx","bs_js_types","bs_js_boolean"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();function i(l){if(c("gkx")("AT5AGDWr7VWKZPg1PvTz69G07vIW7nWrxrA4PloGCgjyPuof8r7WUUsWLIKzWOZMmcJyN6U1BeEUXZmBqPUEAKAe")){c("bs_js_boolean").to_js_boolean(c("bs_js_types").test(l,4))||h(0);c("bs_js_boolean").to_js_boolean(+(l!=="0"))||h(0);var m=/^[0-9]+$/;c("bs_js_boolean").to_js_boolean(+m.test(l))||h(0)}return l}function j(l){try{return[i(l)]}catch(m){var n=c("bs_js_exn").internalToOCamlException(m);if(n[0]===c("bs_js_exn").$$Error)return 0;else throw n}}var k=c("bs_string").compare;g.compare=k;g.ofString=j;g.ofStringExn=i}),null);
__d("MessengerServerPayloadTransformer.bs",["URI","FBID.bs","bs_array","Utils.bs","bs_string","getByPath","bs_caml_array","bs_js_boolean","MercuryIDs","bs_caml_format","GenderConst","bs_js_primitive","WorkModeConfig","bs_js_null_undefined","DisplayGenderConst","MessagingThreadType","MessengerMessageTransformer.bs","MessengerAttachmentTransformer.bs","MessengerThreadCannotReplyReason"],(function aa(ba,a,ca,da,ea,b){"use strict";__p&&__p();function c(f){__p&&__p();var g=f.location_coordinates,h=g==null?[null,null]:[g.latitude,g.longitude],i=f.location_page,j;if(i==null)j=null;else{var k=i.address;j=k==null?null:k.full_address}var l=f.allows_rsvp,m=l!==0?1:0,n=a("bs_array").fold_left(function(p,q){p[q.node.id]=q.guest_list_state;return p},{},f.event_reminder_members.edges),o=f.lightweight_event_creator;return{creator_id:o==null?null:o.id,event_members:n,event_time:f.time,event_type:f.lightweight_event_type,latitude:h[0],longitude:h[1],location_address:j,location_name:f.location_name,note:f.note,oid:f.id,related_event:f.related_event,repeat_mode:f.repeat_mode,seconds_to_notify_before:f.seconds_to_notify_before,status:f.lightweight_event_status,title:f.event_title,track_rsvp:m}}function d(f){__p&&__p();var g=f.associated_object;if(g==null)return null;else{var h=g.action_link,i;if(h==null)i=null;else{var j=+a("WorkModeConfig").is_work_user,k=j!==0?a("WorkModeConfig").company_subdomain+".facebook.com":"www.facebook.com";i=new(a("URI"))(h).setDomain(k)}var l=g.profile_picture;return{id:g.id,name:g.name,action_link:i,profile_picture:l==null?null:{uri:l.uri},room_type:g.room_type,privacy_mode:g.privacy_mode,approval_mode_toggleable:g.approval_mode_toggleable,start_timestamp:g.start_timestamp,event_place:g.event_place,mentorship_program:g.mentorship_program}}}function fa(f){var g=f.related_page_thread;if(g==null)return null;else{var h=a("bs_array").map(function(k){return k.name},g.custom_thread_tags.nodes),i=g.page,j=i==null?null:i.id;return{flagged:g.is_flagged,pageID:j,customTagNames:h}}}function ga(f){__p&&__p();var g=f.thread_key.other_user_id;if(g==null)return 0;else{var h=f.all_participants.nodes;return a("bs_array").fold_left(function(i,j){var k=j.messaging_actor;if(k.id===g)return+(k.__typename==="User");else return i},0,h)}}function ha(f){__p&&__p();if(f.length){var g={};a("bs_array").iter(function(h){var i=h.nickname;if(i==null)return 0;else{g[h.participant_id]=i;return 0}},f);return g}else return null}function ia(f){if(!(f==null)&&f!=="")return"#"+a("bs_string").sub(f,2,f.length-2|0);else return null}function ja(f){return f.thread_key.thread_fbid}function ka(f){return f.thread_key.other_user_id}function la(f){return a("bs_js_primitive").null_undefined_to_opt(a("getByPath")(f,["messages","page_info"]))}function e(f){__p&&__p();var g=f.gender,h=f.url,i;if(h==null)i=null;else{var j=+a("WorkModeConfig").is_work_user,k=j!==0?a("WorkModeConfig").company_subdomain+".facebook.com":"www.facebook.com";i=new(a("URI"))(h).getUnqualifiedURI().setDomain(k).setProtocol("https").toString()}var l=f.big_image_src,m=f.big_image_src,n=f.__typename,o;switch(n){case"Page":o="page";break;case"User":o="user";break;default:o=null}var p=f.accepts_messenger_user_feedback,q=f.is_viewer_friend,r=f.is_messenger_user,s=f.is_verified,t=f.is_messenger_platform_bot,u=f.is_message_blocked_by_viewer,v=f.is_viewer_subscribed_to_message_updates,w=f.is_viewer_coworker,x=f.scim_company_user,y;if(x==null)y=null;else{var z=x.company_title;if(z==="")y=null;else{var A=a("bs_js_null_undefined").bind(f.work_info,function(C){return a("bs_js_null_undefined").bind(C.work_community,function(D){return D.name})});y=A==null?z:""+(String(z)+(" \u2022 "+(String(A)+"")))}}var B=f.is_employee;return{id:"fbid:"+f.id,fbid:f.id,gender:g==null?a("GenderConst").NOT_A_PERSON:g===a("DisplayGenderConst").MALE?a("GenderConst").MALE_SINGULAR:g===a("DisplayGenderConst").FEMALE?a("GenderConst").FEMALE_SINGULAR:a("GenderConst").NOT_A_PERSON,href:i,image_src:l==null?null:l.uri,big_image_src:m==null?null:m.uri,name:f.name,short_name:a("Utils.bs").$pipe$unknown(a("bs_js_primitive").null_undefined_to_opt(f.short_name),f.name),type:o,vanity:f.username,accepts_messenger_user_feedback:p==null?false:p,is_friend:q==null?false:q,is_messenger_user:r==null?false:r,is_business_enabled:f.__typename==="Page"?true:false,is_verified:s==null?false:s,is_messenger_platform_bot:t==null?false:t,is_messenger_ignored:null,is_messenger_blocked:u==null?false:u,is_subscribed_to_page_updates:v==null?true:v,is_coworker:w==null?true:w,title:y,employee:B==null?false:B}}function ma(f){return a("bs_array").map(function(g){return e(g.messaging_actor)},f.all_participants.nodes)}function na(f,g){__p&&__p();var h=g.read_receipts;if(h==null)return 0;else{var i={};a("bs_array").iter(function(j){var h=j.actor;if(!(h==null)&&f!==h.id){i[h.id]={action:a("bs_caml_format").caml_float_of_string(j.action),watermark:a("bs_caml_format").caml_float_of_string(j.watermark)};return 0}else return 0},h.nodes);return[i]}}function oa(f){__p&&__p();var g=f.delivery_receipts;if(g==null)return[];else return g.nodes.sort(function(h,i){var j=a("bs_caml_format").caml_float_of_string(h.timestamp_precise),k=a("bs_caml_format").caml_float_of_string(i.timestamp_precise);if(j>k)return-1;else if(j===k)return 0;else return 1})}function pa(f,g,h){var i=g.messages;if(i==null)return 0;else return[a("bs_array").map(function(j){return a("MessengerMessageTransformer.bs").transformMessage(f,j,{thread_id:null,thread_fbid:g.thread_key.thread_fbid,other_user_fbid:g.thread_key.other_user_id,folder:a("bs_string").lowercase(g.folder)},h)},i.nodes)]}function qa(f,g,h){__p&&__p();var i=a("bs_array").map(function(Z){var ra=a("MessengerMessageTransformer.bs").unsafeCastBlobAttachments(Z),k=Z.extensible_attachment,$;if(k==null)$=null;else{var l=k.story_attachment;$={legacy_attachment_id:k.legacy_attachment_id,story_attachment:l==null?null:a("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(l)}}return{snippet:Z.snippet,message_sender:Z.message_sender,timestamp_precise:Z.timestamp_precise,commerce_message_type:Z.commerce_message_type,extensible_attachment:$,blob_attachments:ra,sticker:Z.sticker,extensible_message_admin_text:Z.extensible_message_admin_text}},g.last_message.nodes),j={thread_key:g.thread_key,name:g.name,all_participants:g.all_participants,last_message:{nodes:i},unread_count:g.unread_count,message_count:g.messages_count,image:g.image,updated_time_precise:g.updated_time_precise,mute_until:g.mute_until,is_pin_protected:g.is_pin_protected,is_viewer_subscribed:g.is_viewer_subscribed,is_canonical_neo_user:g.is_canonical_neo_user,thread_queue_enabled:g.thread_queue_enabled,folder:g.folder,has_viewer_archived:g.has_viewer_archived,is_page_follow_up:g.is_page_follow_up,cannot_reply_reason:g.cannot_reply_reason,ephemeral_ttl_mode:g.ephemeral_ttl_mode,customization_info:g.customization_info,thread_admins:g.thread_admins,approval_mode:g.approval_mode,joinable_mode:g.joinable_mode,thread_queue_metadata:g.thread_queue_metadata,event_reminders:g.event_reminders,montage_thread:g.montage_thread,last_read_receipt:g.last_read_receipt,related_page_thread:g.related_page_thread,rtc_call_data:g.rtc_call_data,associated_object:g.associated_object,reactions_mute_mode:g.reactions_mute_mode,mentions_mute_mode:g.mentions_mute_mode,privacy_mode:g.privacy_mode,customization_enabled:g.customization_enabled,thread_type:g.thread_type,participant_add_mode_as_string:g.participant_add_mode_as_string,participants_event_status:g.participants_event_status,marketplace_thread_data:g.marketplace_thread_data,page_comm_item:g.page_comm_item,group_approval_queue:g.group_approval_queue},k=j.customization_info,l;if(k==null)l=[null,null,null];else{var m=k.emoji;l=[ia(k.outgoing_bubble_color),m==null?null:{emoji:m},ha(k.participant_customizations)]}var n=j.page_comm_item,o=n==null?[null,null,null,null,null]:[n.comm_status,n.comm_source_id,n.id,n.subtitle,n.comm_item_owners],p=j.last_message.nodes.length?[a("bs_caml_array").caml_array_get(j.last_message.nodes,0)]:0,q=j.last_read_receipt.nodes.length?[a("bs_caml_array").caml_array_get(j.last_read_receipt.nodes,0)]:0,r;if(p){var s=p[0];r=a("MessengerAttachmentTransformer.bs").transformAttachment(f,{extensible_attachment:s.extensible_attachment,blob_attachments:s.blob_attachments,sticker:s.sticker},h)}else r=[];var t;if(p){var u=p[0].extensible_message_admin_text;if(u==null)t=null;else{var v=u.game;t=v==null?null:v.id}}else t=null;var w=j.cannot_reply_reason,x=j.thread_queue_metadata,y=j.thread_type,z=j.montage_thread,A=j.image,B=j.thread_key.other_user_id,C=j.thread_queue_metadata,D=j.name,E=j.thread_key.other_user_id,F;if(E==null){var G=j.thread_key.thread_fbid;F=G==null?null:G}else F=E;var H=j.rtc_call_data,I;if(H==null)I=null;else{var J=H.initiator;I={call_state:H.call_state,server_info_data:H.server_info_data,initiator_fbid:J==null?0:a("bs_caml_format").caml_float_of_string(J.id)}}var K=j.marketplace_thread_data,L;if(K==null)L=null;else{var M=K.for_sale_item,N;if(M==null)N=null;else{var O=M.id,P=M.formatted_price,Q=M.location,R;if(Q==null)R=null;else{var S=Q.reverse_geocode;R={reverse_geocode:S==null?null:{city:S.city,state:S.state}}}var T=M.primary_photo,U;if(T==null)U=null;else{var V=T.image;U=V==null?null:V.uri}N={id:O==null?0:a("bs_caml_format").caml_float_of_string(O),story_id:M.story_id,title:M.group_commerce_item_title,price:P==null?null:P.text,location:R,is_sold:M.is_sold,image_uri:U}}var W=K.buyer,X=K.seller;L={for_sale_item:N,buyer_fbid:W==null?0:a("bs_caml_format").caml_float_of_string(W.id),seller_fbid:X==null?0:a("bs_caml_format").caml_float_of_string(X.id)}}var Y=j.group_approval_queue;return{admin_ids:a("bs_array").map(function(Z){return Z.id},j.thread_admins),approval_mode:j.approval_mode,approval_queue_ids:x==null?[]:a("bs_array").map(function(Z){return a("MercuryIDs").getParticipantIDFromUserID(a("FBID.bs").ofStringExn(Z.id))},x.approval_requests.nodes),can_reply:w==null?true:false,cannot_reply_reason:j.cannot_reply_reason,custom_color:l[0],custom_like_icon:l[1],custom_nickname:l[2],customization_enabled:j.customization_enabled,thread_type:y==null?null:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("MessagingThreadType")[y])),participant_add_mode:j.participant_add_mode_as_string,ephemeral_ttl_mode:j.ephemeral_ttl_mode,folder:a("bs_string").lowercase(j.folder),has_email_participant:w==null?false:a("bs_js_boolean").to_js_boolean(+(w===a("MessengerThreadCannotReplyReason").HAS_EMAIL_PARTICIPANT)),has_montage:z==null?false:true,image_src:A==null?null:A.uri,is_archived:a("bs_js_boolean").to_js_boolean(j.has_viewer_archived),is_page_follow_up:a("bs_js_boolean").to_js_boolean(j.is_page_follow_up),is_canonical_user:a("bs_js_boolean").to_js_boolean(ga(j)),is_canonical:B==null?false:true,is_pin_protected:a("bs_js_boolean").to_js_boolean(j.is_pin_protected),is_subscribed:a("bs_js_boolean").to_js_boolean(j.is_viewer_subscribed),is_canonical_neo_user:a("bs_js_boolean").to_js_boolean(j.is_canonical_neo_user),is_thread_queue_enabled:C==null?false:true,joinable_mode:{mode:a("bs_caml_format").caml_int_of_string(j.joinable_mode.mode),link:j.joinable_mode.link},last_message_timestamp:p?a("bs_caml_format").caml_float_of_string(p[0].timestamp_precise):0,last_message_type:p?p[0].commerce_message_type:null,last_read_timestamp:q?a("bs_caml_format").caml_float_of_string(q[0].timestamp_precise):0,lightweight_event:j.event_reminders.nodes.length?c(a("bs_caml_array").caml_array_get(j.event_reminders.nodes,0)):null,message_count:j.message_count,mute_until:j.mute_until,name:D==null?"":D,other_user_fbid:j.thread_key.other_user_id,page_thread_info:fa(j),participants:a("bs_array").map(function(Z){return a("MercuryIDs").getParticipantIDFromUserID(Z.messaging_actor.id)},j.all_participants.nodes),participants_event_status:j.participants_event_status,read_only:w==null?false:a("bs_js_boolean").to_js_boolean(+(w===a("MessengerThreadCannotReplyReason").READ_ONLY)),recipients_loadable:w==null?true:a("bs_js_boolean").to_js_boolean(+(w!==a("MessengerThreadCannotReplyReason").RECIPIENTS_NOT_LOADABLE)),server_timestamp:a("bs_caml_format").caml_float_of_string(j.updated_time_precise),snippet_attachments:r,snippet_sender:p?a("MercuryIDs").getParticipantIDFromUserID(p[0].message_sender.messaging_actor.id):null,snippet:p?p[0].snippet:null,thread_fbid:F,thread_id:"",timestamp:a("bs_caml_format").caml_float_of_string(j.updated_time_precise),unread_count:j.unread_count,rtc_call_data:I,marketplace_thread_data:L,associated_object:d(j),reactions_mute_mode:j.reactions_mute_mode==="REACTIONS_NOT_MUTED"?0:1,mentions_mute_mode:j.mentions_mute_mode==="MENTIONS_NOT_MUTED"?0:1,comm_status:o[0],page_comm_item_id:o[2],comm_source_id:o[1],subtitle:o[3],comm_item_owners:o[4],group_approval_queue:Y==null?null:Y.nodes,game_id:t}}b.getThreadFBID=ja;b.getOtherUserID=ka;b.getMessagePageInfo=la;b.transformParticipant=e;b.transformParticipants=ma;b.transformReadReceipts=na;b.transformDeliveryReceipts=oa;b.transformMessages=pa;b.transformThread=qa}),null);
__d("MercuryCanonicalGroupThreadManager",["Bootloader","KeyedCallbackManager","MercuryIDs","MercuryPayloadSource","MercuryServerPayloadPreprocessor","MercurySingletonProvider","MercuryThreads","MessengerServerPayloadTransformer.bs","MercuryServerDispatcher","SubscriptionsHandler"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.$MercuryCanonicalGroupThreadManager1=j;this.$MercuryCanonicalGroupThreadManager2=new(c("KeyedCallbackManager"))();this.$MercuryCanonicalGroupThreadManager3=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager6=c("MercuryThreads").getForFBID(this.$MercuryCanonicalGroupThreadManager1);this.$MercuryCanonicalGroupThreadManager4={};this.$MercuryCanonicalGroupThreadManager8();this.$MercuryCanonicalGroupThreadManager9();this.$MercuryCanonicalGroupThreadManager7={}}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.getCanonicalGroupThreadIDForParticipants=function(j,k){j=this.$MercuryCanonicalGroupThreadManager10(j);var l=this.$MercuryCanonicalGroupThreadManager11(j),m=this.$MercuryCanonicalGroupThreadManager2.executeOrEnqueue(l,k);this.$MercuryCanonicalGroupThreadManager12(j);return m};h.prototype.unsubscribe=function(j){if(j)this.$MercuryCanonicalGroupThreadManager2.unsubscribe(j)};h.prototype.$MercuryCanonicalGroupThreadManager11=function(j){return j.sort().join(",")};h.prototype.$MercuryCanonicalGroupThreadManager13=function(j,k){var l=c("MercuryIDs").getThreadIDFromThreadFBID(k);this.$MercuryCanonicalGroupThreadManager2.setResource(j,l);this.$MercuryCanonicalGroupThreadManager4[l]=j};h.prototype.$MercuryCanonicalGroupThreadManager12=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(j),l={canonical_group_key:k,participants:j};c("MercuryServerDispatcher").trySend("/ajax/mercury/search_canonical_groups.php",l,null,this.$MercuryCanonicalGroupThreadManager1)};h.prototype.$MercuryCanonicalGroupThreadManager8=function(){c("MercuryServerDispatcher").registerEndpoints({"/ajax/mercury/search_canonical_groups.php":{request_user_id:this.$MercuryCanonicalGroupThreadManager1,mode:c("MercuryServerDispatcher").IMMEDIATE,handler:function(j){this.handleUpdate(j)}.bind(this)}})};h.prototype.$MercuryCanonicalGroupThreadManager10=function(j){if(j.indexOf(this.$MercuryCanonicalGroupThreadManager1)===-1)j.push(this.$MercuryCanonicalGroupThreadManager1);return j};h.prototype.handleUpdate=function(j){if(j.graphql_payload){var k=c("MessengerServerPayloadTransformer.bs").transformThread(j.viewer,j.graphql_payload,j.for_page);this.$MercuryCanonicalGroupThreadManager3.handleUpdate({threads:[k],payload_source:c("MercuryPayloadSource").SERVER_SEARCH})}var l=j.canonical_group;if(l)for(var m in l)this.$MercuryCanonicalGroupThreadManager13(m,l[m])};h.prototype.getNow=function(j){var k=this.$MercuryCanonicalGroupThreadManager11(this.$MercuryCanonicalGroupThreadManager10(j));return this.$MercuryCanonicalGroupThreadManager2.getResource(k)};h.prototype.$MercuryCanonicalGroupThreadManager9=function(){c("Bootloader").loadModules(["MercuryThreadInformer"],function(j){var k=j.getForFBID(this.$MercuryCanonicalGroupThreadManager1),l=new(c("SubscriptionsHandler"))();l.addSubscriptions(k.subscribe("threads-deleted",function(m,n){for(var o in n)if(this.$MercuryCanonicalGroupThreadManager4[o]){this.$MercuryCanonicalGroupThreadManager2.setResource(this.$MercuryCanonicalGroupThreadManager4[o],undefined);delete this.$MercuryCanonicalGroupThreadManager4[o]}}.bind(this)));this.$MercuryCanonicalGroupThreadManager5=l}.bind(this),"MercuryCanonicalGroupThreadManager")};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("FantaGetMessageActions",["FantaDispatcher","MercuryCanonicalGroupThreadManager","MercuryIDs","MercuryTypeaheadConstants","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")({ADD_PARTICIPANTS:null,CLEAR_PARTICIPANTS:null,CLEAR_PREVIEW:null,FETCH_MORE_MESSAGES:null,ON_BOOTLOAD_TYPEAHEAD:null,ON_GET_APPROVAL_QUEUE_RESPONSE:null,ON_GET_THREAD_PREVIEW_RESPONSE:null,ON_GET_THREAD_RESPONSE:null,ON_MESSAGE_STORE_RESPONSE:null,ON_PAGE_NULL_RESPONSE:null,ON_PRIVACY_STATE_CHANGE:null,ON_SHOW_CONTEXT_BANNER_TIMER:null,REFRESH_THREAD:null,THREADS_UPDATED:null}),i={Types:h,addParticipants:function j(k,l){__p&&__p();var m,n=l.length===1&&l[0].getInfo().render_type===c("MercuryTypeaheadConstants").THREAD_TYPE,o=void 0;if(n){var p=l[0].getInfo().mercury_thread;if(p)o=c("MercuryIDs").getThreadIDFromThreadFBID(p.thread_fbid)}else if(l.length===1){var q=l[0].info&&l[0].info.uid;if(q)o=c("MercuryIDs").getThreadIDFromUserID(q)}else if(l.length===0){c("FantaDispatcher").dispatch({type:h.CLEAR_PARTICIPANTS,tabID:k});return}else(function(){var r=c("MercuryCanonicalGroupThreadManager").get(),s=l.map(function(u){return u.info.uid});c("FantaDispatcher").dispatch({type:h.CLEAR_PREVIEW,tabID:k,tokens:l});var t=r.getCanonicalGroupThreadIDForParticipants(Array.from(s),function(o){r.unsubscribe(t);if(o)c("FantaDispatcher").dispatch({type:h.ADD_PARTICIPANTS,previewTabID:o,tabID:k,tokens:l})})})();if(o)c("FantaDispatcher").dispatch({type:h.ADD_PARTICIPANTS,previewTabID:o,tabID:k,tokens:l})},onBootloadTypeahead:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_BOOTLOAD_TYPEAHEAD,tabID:k,thread:l})},fetchMoreMessages:function j(k){c("FantaDispatcher").dispatch({type:h.FETCH_MORE_MESSAGES,threadID:k})},refreshThread:function j(k){c("FantaDispatcher").dispatch({type:h.REFRESH_THREAD,threadID:k})},onGetThreadResponse:function j(k){c("FantaDispatcher").dispatch({type:h.ON_GET_THREAD_RESPONSE,thread:k})},onGetThreadPreviewResponse:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_GET_THREAD_PREVIEW_RESPONSE,tabID:k,thread:l})},onApprovalQueueResponse:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_GET_APPROVAL_QUEUE_RESPONSE,membershipParticipants:l,tabID:k})},onShowContextBannerTimer:function j(k){c("FantaDispatcher").dispatch({type:h.ON_SHOW_CONTEXT_BANNER_TIMER,threadID:k})},onMessageStoreResponse:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_MESSAGE_STORE_RESPONSE,messages:k,tabID:l})},threadsUpdated:function j(k){c("FantaDispatcher").dispatch({type:h.THREADS_UPDATED,threads:k})},onPrivacyStateChange:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_PRIVACY_STATE_CHANGE,threadID:k,privacyState:l})},onPageNullResponse:function j(k,l){c("FantaDispatcher").dispatch({type:h.ON_PAGE_NULL_RESPONSE,threadID:k,nullStateCTA:l})}};f.exports=i}),null);
__d("FantaTabSheetActions",["FantaDispatcher","LogHistory","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")({CLOSE_ADD_FRIENDS_SHEET:null,CLOSE_ADD_MORE_FRIENDS_SHEET:null,CLOSE_EMPLOYEE_PERSONAL_USER_SHEET:null,CLOSE_EMPLOYEE_WORK_USER_SHEET:null,CLOSE_NAME_CONVERSATION_TAB_SHEET:null,CLOSE_PAGE_INDICATOR_SHEET:null,CLOSE_READ_ONLY_PERMANENT_SHEET:null,CLOSE_READ_ONLY_SHEET:null,CLOSE_USER_FOCUS_AND_BYPASS_SHEET:null,CLOSE_USER_TIMEZONE_SHEET:null,ON_BOOTLOAD_EVENT_REMINDER:null,ON_WORK_DO_NOT_DISTURB_RESPONSE:null,ON_MENTORSHIP_PROGRAM_RESPONSE:null,ON_IS_PAGE_TAB:null,OPEN_ADD_MORE_FRIENDS_SHEET:null,OPEN_APPOINTMENT_SHEET:null,OPEN_BYPASS_FOCUS_SHEET:null,OPEN_EMPLOYEE_AWAY_SHEET:null,OPEN_EMPLOYEE_PERSONAL_USER_SHEET:null,OPEN_EMPLOYEE_WORK_USER_SHEET:null,OPEN_NAME_CONVERSATION_TAB_SHEET:null,OPEN_PAGE_INDICATOR_SHEET:null,OPEN_READ_ONLY_PERMANENT_SHEET:null,OPEN_READ_ONLY_SHEET:null,OPEN_USER_FOCUS_SHEET:null,OPEN_USER_TIMEZONE_SHEET:null,OPEN_WORK_DO_NOT_DISTURB_SHEET:null,OPEN_MENTORSHIP_PROGRAM_SHEET:null}),i=c("LogHistory").getInstance("fanta_sheets");function j(l){c("FantaDispatcher").dispatch(l);i.log(l.type,l.tabID)}var k={Types:h,openUserFocusSheet:function l(m){j({type:h.OPEN_USER_FOCUS_SHEET,tabID:m})},openBypassFocusSheet:function l(m){j({type:h.OPEN_BYPASS_FOCUS_SHEET,tabID:m})},closeUserFocusAndBypassSheet:function l(m){j({type:h.CLOSE_USER_FOCUS_AND_BYPASS_SHEET,tabID:m})},openUserTimezoneSheet:function l(m,n){j({type:h.OPEN_USER_TIMEZONE_SHEET,tabID:m,timezoneInfo:n})},closeUserTimezoneSheet:function l(m){j({type:h.CLOSE_USER_TIMEZONE_SHEET,tabID:m})},openAddMoreFriendsSheet:function l(m){j({type:h.OPEN_ADD_MORE_FRIENDS_SHEET,tabID:m})},closeAddMoreFriendsSheet:function l(m){j({type:h.CLOSE_ADD_MORE_FRIENDS_SHEET,tabID:m})},closeAddFriendsSheet:function l(m){j({type:h.CLOSE_ADD_FRIENDS_SHEET,tabID:m})},openNameConversationSheet:function l(m){j({type:h.OPEN_NAME_CONVERSATION_TAB_SHEET,tabID:m})},closeNameConversationSheet:function l(m){j({type:h.CLOSE_NAME_CONVERSATION_TAB_SHEET,tabID:m})},openReadOnlySheet:function l(m){j({type:h.OPEN_READ_ONLY_SHEET,tabID:m})},closeReadOnlySheet:function l(m){j({type:h.CLOSE_READ_ONLY_SHEET,tabID:m})},openReadOnlyPermanentSheet:function l(m){j({type:h.OPEN_READ_ONLY_PERMANENT_SHEET,tabID:m})},closeReadOnlyPermanentSheet:function l(m){j({type:h.CLOSE_READ_ONLY_PERMANENT_SHEET,tabID:m})},openEmployeeAwaySheet:function l(m){j({type:h.OPEN_EMPLOYEE_AWAY_SHEET,tabID:m})},openEmployeePersonalUserSheet:function l(m){j({type:h.OPEN_EMPLOYEE_PERSONAL_USER_SHEET,tabID:m})},closeEmployeePersonalUserSheet:function l(m){j({type:h.CLOSE_EMPLOYEE_PERSONAL_USER_SHEET,tabID:m})},openEmployeeWorkUserSheet:function l(m){j({type:h.OPEN_EMPLOYEE_WORK_USER_SHEET,tabID:m})},closeEmployeeWorkUserSheet:function l(m){j({type:h.CLOSE_EMPLOYEE_WORK_USER_SHEET,tabID:m})},openPageIndicatorSheet:function l(m,n){j({type:h.OPEN_PAGE_INDICATOR_SHEET,description:n,tabID:m})},closePageIndicatorSheet:function l(m){j({type:h.CLOSE_PAGE_INDICATOR_SHEET,tabID:m})},openWorkDoNotDisturbSheet:function l(m,n){j({type:h.OPEN_WORK_DO_NOT_DISTURB_SHEET,description:n,tabID:m})},openMentorshipProgramSheet:function l(m){j({type:h.OPEN_MENTORSHIP_PROGRAM_SHEET,tabID:m})},onIsPageTab:function l(m,n){j({type:h.ON_IS_PAGE_TAB,pageIndicator:n,tabID:m})},onBootloadEventReminder:function l(m){j({type:h.ON_BOOTLOAD_EVENT_REMINDER,tabID:m})},openAppointmentBannerSheet:function l(m){j({type:h.OPEN_APPOINTMENT_SHEET,tabID:m})},onWorkDoNotDisturbResponse:function l(m,n,o){j({type:h.ON_WORK_DO_NOT_DISTURB_RESPONSE,tabID:m,status:n,description:o})},onMentorshipProgramResponse:function l(m,n,o){j({type:h.ON_MENTORSHIP_PROGRAM_RESPONSE,tabID:m,groupID:o,programName:n})}};f.exports=k}),null);
__d("MercurySheetPolicy",["keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={ChatThreadIsMutedTabSheet:{isPermanent:false,isSheetWithInput:false},ChatUserFocusSheet:{isPermanent:true,isSheetWithInput:true},ChatUserFocusBypassSheet:{isPermanent:true,isSheetWithInput:true},ChatUserTimezoneSheet:{isPermanent:true,isSheetWithInput:true},ChatUserBlockedTabSheet:{isPermanent:true,isSheetWithInput:false},ChatUploadWarningTabSheet:{isPermanent:false,isSheetWithInput:false},ChatThreadIsMessageBlockedSheet:{isPermanent:true,isSheetWithInput:false},ChatReadOnlyTabSheet:{isPermanent:false,isSheetWithInput:false},ChatReadOnlyPermanentTabSheet:{isPermanent:true,isSheetWithInput:false},ChatOfflineTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNoRecipientsTabSheet:{isPermanent:true,isSheetWithInput:false},ChatNewMessagesTabSheet:{isPermanent:true,isSheetWithInput:true},ChatNameConversationTabSheet:{isPermanent:true,isSheetWithInput:true},ChatEmployeeAwaySheet:{isPermanent:true,isSheetWithInput:false},ChatEventReminderTabSheet:{isPermanent:true,isSheetWithInput:false},ChatAppointmentBanner:{isPermanent:true,isSheetWithInput:false},ChatMontageSheet:{isPermanent:false,isSheetWithInput:false},ChatJoinCallSheet:{isPermanent:true,isSheetWithInput:false},FantaAddFriendsSheet:{isPermanent:true,isSheetWithInput:true},FantaAddMoreFriendsSheet:{isPermanent:true,isSheetWithInput:true},ChatRoomAssociatedObjectSheet:{isPermanent:false,isSheetWithInput:false},ChatWorkDoNotDisturbSheet:{isPermanent:false,isSheetWithInput:false},ChatMentorshipProgramSheet:{isPermanent:false,isSheetWithInput:false}},i={canReplaceOpenSheet:function j(k,l){var m=this.getType(l),n=this.isPermanent(l),o=this.isSheetWithInput(l),p=this.getType(k),q=this.isPermanent(k),r=this.isSheetWithInput(k);if(r)return!!(m!==p&&o);if(q&&!n)return false;if(p===this.sheets.ChatThreadIsMessageBlockedSheet)return false;return true},getType:function j(k){var l=k.getType||k.type&&k.type.getType||function(){return k},m=l.call(k);return m},isPermanent:function j(k){if(typeof k==="string"&&h[k])return h[k].isPermanent;var l=k.isPermanent||k.type&&k.type.isPermanent||function(){return false},j=l.call(k);return j},isSheetWithInput:function j(k){if(typeof k==="string"&&h[k])return h[k].isSheetWithInput;var l=k.isSheetWithInput||k.type&&k.type.isSheetWithInput||function(){return false},j=l.call(k);return j},sheets:c("keyMirror")(h)};f.exports=i}),null);
__d("TimeSpentRoomTypeEnum",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({GROUP:"GROUP",EVENT:"EVENT"})}),null);
__d("MessageThreadAssociatedObjectUtils",["TimeSpentRoomTypeEnum"],(function a(b,c,d,e,f,g){"use strict";var h={shouldRender:function i(j){return j&&j.room_type===c("TimeSpentRoomTypeEnum").GROUP&&!j.is_workplace_community},isLinkedToGroupChat:function i(j){return j&&j.room_type===c("TimeSpentRoomTypeEnum").GROUP&&!j.is_workplace_community}};f.exports=h}),null);
__d("MessengerApprovalModeTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({OPEN:0,APPROVALS:1})}),null);
__d("MessengerJoinableModeType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({PRIVATE:0,JOINABLE:1})}),null);
__d("MessengerParticipantAddModeTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ADD:"ADD",INVITE:"INVITE",ADD_INVITE:"ADD_INVITE"})}),null);
__d("MessengerAdminGroupUtils",["fbt","MercuryConfig","MercuryIDs","MessageThreadAssociatedObjectUtils","MessengerApprovalModeTypes","MessengerJoinableModeType","MessengerParticipantAddModeTypes","WorkModeConfig","CurrentUser","QE2Logger","gkx"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i="messenger_use_new_group_participant_suggestion_ranking",j="show_nullstate_chat_tab_composer",k="show_nullstate_chat_tab_group_chat",l={isJoinableAndOpenThread:function m(n){return this.isJoinableThread(n)&&this.isApprovalOpenThread(n)},isJoinableAndApprovalRequiredThread:function m(n){return!!(this.isJoinableThread(n)&&n&&n.approval_mode===c("MessengerApprovalModeTypes").APPROVALS)},shouldAddToApprovalQueue:function m(n,o){return!!(this.isJoinableAndApprovalRequiredThread(n)&&n&&!l.isViewerAdmin(n.admin_ids,o))},isJoinableThread:function m(n){return!!(c("gkx")("AT5xrCi08i7kM3hip_Bf4sUgmdKPV1QphRx_J6kDVSso_LwnuXnsPyhq98JRQV_MqHjleZ_pelk8UHK4mDklEDU4gdH-DgPi3glxyQ2_7CHTgw")&&n&&n.is_thread_queue_enabled===true&&n.joinable_mode&&n.joinable_mode.mode===c("MessengerJoinableModeType").JOINABLE)},isGroupChat:function m(n){return!!(n&&c("MessageThreadAssociatedObjectUtils").isLinkedToGroupChat(n.associated_object))},shouldInvite:function m(n){return!!(c("gkx")("AT5xrCi08i7kM3hip_Bf4sUgmdKPV1QphRx_J6kDVSso_LwnuXnsPyhq98JRQV_MqHjleZ_pelk8UHK4mDklEDU4gdH-DgPi3glxyQ2_7CHTgw")&&n&&n.participant_add_mode===c("MessengerParticipantAddModeTypes").INVITE)},isApprovalOpenThread:function m(n){return!!(c("gkx")("AT5xrCi08i7kM3hip_Bf4sUgmdKPV1QphRx_J6kDVSso_LwnuXnsPyhq98JRQV_MqHjleZ_pelk8UHK4mDklEDU4gdH-DgPi3glxyQ2_7CHTgw")&&n&&n.approval_mode===c("MessengerApprovalModeTypes").OPEN)},isOwner:function m(n,o){return n&&this.isJoinableThread(o)},canSeeGroupOptions:function m(n,o,p){var q=c("WorkModeConfig").is_work_user;return!q&&this.isJoinableThread(o)},canSeeBotsInGroupTypeahead:function m(){var n=c("CurrentUser").isWorkUser();return n&&c("gkx")("AT5GhC4rylRpYKpnZf2oEtsedOSc0WCJLB5V8z6-mqCNieSKORSJnqenUlgYVRpQaRNASrJq2SeIYY3m4QNhPBlK")},canMakeOthersAdmins:function m(n,o,p){return this.isOwner(n,p)&&!o},canMakeSelfAdmin:function m(n,o){return this.isJoinableThread(o)&&o.admin_ids.length===0&&n},canRemoveAdmin:function m(n,o,p){return this.isOwner(n,p)&&o},canRemoveFromGroup:function m(n,o){return this.isOwner(n,o)||!this.isJoinableThread(o)},showJoinableLink:function m(n){var o=!!(n&&n.joinable_mode&&n.joinable_mode.link),p=l.isJoinableThread(n);return p&&o},showJoinableApprovalToggle:function m(n,o){if(n.associated_object&&!n.associated_object.approval_mode_toggleable)return false;var p=l.isViewerAdmin(n.admin_ids,o);return l.isOwner(p,n)},showApprovalQueue:function m(n,o){var p=l.isViewerAdmin(n.admin_ids,o),q=l.isOwner(p,n),r=0;if(n&&n.approval_queue_ids&&n.approval_queue_ids.length)r=n.approval_queue_ids.length;var s=l.isJoinableAndApprovalRequiredThread(n);return s&&q&&r>0},showParticipantsModal:function m(n,o,p){return this.isJoinableThread(p)&&!n&&!o},useNewGroupMemberSuggestionRanking:function m(){c("QE2Logger").logExposureForUser(i);return c("MercuryConfig").MessengerNewGroupParticipantSuggestionQE},showDefaultListForNewPersonAddChatTab:function m(){c("QE2Logger").logExposureForUser(k);return c("MercuryConfig").ChatGroupChat},showDefaultListForNewChatTab:function m(){c("QE2Logger").logExposureForUser(j);return c("MercuryConfig").ChatComposer},canUpdateThreadCustomization:function m(n,o){var p=l.isJoinableThread(n),q=l.isViewerAdmin(n.admin_ids,o);return n.is_subscribed&&(!p||q)},isViewerAdmin:function m(n,o){return this.isAdmin(n,c("MercuryIDs").getParticipantIDFromUserID(o))},isAdmin:function m(n,o){return n!==null&&n!==undefined&&n.indexOf(o)!==-1},getLeaveGroupBodyText:function m(n,o){return this.isOwner(n,o)?h._("Leaving this group will remove you as an owner and allow other members to manage the group. You will no longer be able to send or receive new messages."):h._("You will stop receiving messages from this conversation and people will see that you left.")},getLeaveGroupTitleText:function m(n,o){return this.isOwner(n,o)?h._("Leave this conversation?"):h._("Leave Conversation?")},getLeaveGroupButtonText:function m(n,o){return this.isOwner(n,o)?h._("Leave converstaion"):h._("Leave")},getMakeOwnerBodyText:function m(n,o){return n?h._("As a group owner, you will be able to manage group ownership and remove members from the conversation. Only owners will be able to add other owners."):h._("As a group owner, \"{owner's name}\" will be able to manage group ownership and remove members from the conversation. They will be able to remove ownership from other owners.",[h.param("owner's name",o)])},getMakeOwnerTitleText:function m(n){return n?h._("Become group owner?"):h._("Add group owner?")},getMakeOwnerButtonText:function m(n){return n?h._("Become owner"):h._("Make owner")},getRemoveOwnerBodyText:function m(n,o,p){var q=void 0;if(n&&o)q=h._("You will no longer manage group ownership and remove members from this conversation. You will still be a participant in the group. Any other member will be able to own the group.");else if(n&&!o)q=h._("You will no longer manage group ownership and remove members from this conversation. You will still be a participant in the group.");else q=h._("\"{owner's name}\" will no longer manage group ownership and remove members from the conversation. They will still be a participant in the group.",[h.param("owner's name",p)]);return q}};f.exports=l}),null);
__d("MessengerRoomPrivacyMode",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({WHITELISTED_MODE:0,PUBLIC_MODE:1})}),null);
__d("FantaComposeViewReducers",["Bootloader","FantaGetMessageActions","FantaTabSheetActions","MercuryDataSourceWrapper","MercurySheetPolicy","MercuryTypeaheadConstants","MessengerRoomPrivacyMode","MessengerAdminGroupUtils","ifRequired"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FantaGetMessageActions").Types,i=c("FantaTabSheetActions").Types;function j(r,s){switch(s.type){case h.ON_GET_THREAD_RESPONSE:case h.ON_GET_THREAD_PREVIEW_RESPONSE:var t=s.thread,u=s.tabID||t.thread_id;r=k(r,t,u)}return r}function k(r,s,t){if(s.participants.length===0){r=m(r,t,s);r=p(r,t,c("MercurySheetPolicy").sheets.FantaAddFriendsSheet)}return r}function l(r,s){switch(s.type){case h.ON_BOOTLOAD_TYPEAHEAD:var t=s.thread,u=t.thread_id;r=m(r,u,t)}return r}function m(r,s,t){__p&&__p();var u=r.mercury.tabContents.get(s);if(!u||u.typeahead)return r;c("ifRequired")("ChatTabTypeaheadRenderer",function(v){__p&&__p();c("ifRequired")("ContextualTypeaheadView",function(w){__p&&__p();c("ifRequired")("MercuryTypeahead",function(x){__p&&__p();if(!r.mercury.tabContents.get(s))return;var y=!!(t&&t.participants&&t.participants.length===0),z=!!(t&&t.associated_object&&t.associated_object.privacy_mode===c("MessengerRoomPrivacyMode").WHITELISTED_MODE),A=y?c("MercuryDataSourceWrapper").chat_typeahead_source:z?c("MercuryDataSourceWrapper").chat_add_people_froup_source:c("MercuryDataSourceWrapper").chat_add_people_source;A.setShowThreads(y);if(y)A.setShowDefaultList(c("MessengerAdminGroupUtils").showDefaultListForNewChatTab());else if(!z)A.setShowDefaultList(c("MessengerAdminGroupUtils").showDefaultListForNewPersonAddChatTab());if(z)A.setQueryData({thread_id:t.thread_fbid});var B=new x(A,w);B.setViewOption("renderer",v);B.setExcludedParticipantsFromThreadMeta(t);u=u.merge({typeahead:B});r=r.setIn(["mercury","tabContents",s],u)},function(){return o(s,t)})},function(){return o(s,t)})},function(){return o(s,t)});return r}function n(r,s){switch(s.type){case i.OPEN_ADD_MORE_FRIENDS_SHEET:var t=s.tabID,u=r.mercury.tabContents.get(t).thread;if(u){r=m(r,t,u);return p(r,s.tabID,c("MercurySheetPolicy").sheets.FantaAddMoreFriendsSheet)}}return r}function o(r,s){c("Bootloader").loadModules(["ChatTabTypeaheadRenderer","ContextualTypeaheadView","MercuryTypeahead"],function(t,u,v){c("FantaGetMessageActions").onBootloadTypeahead(r,s)},"FantaComposeViewReducers")}function p(r,s,t){var u=r.mercury.tabContents.get(s),v=r.tabGroup.tabs.get(s);if(!v||!u)return r;var w=u,x=w.openSheet;if(x&&!c("MercurySheetPolicy").canReplaceOpenSheet(x,t))return r;u=u.merge({openSheet:t});r=r.setIn(["mercury","tabContents",s],u);return r}function q(r,s){switch(s.type){case h.ADD_PARTICIPANTS:var t=s.tokens,u=s.tabID,v=t.length===1&&t[0].getInfo().render_type===c("MercuryTypeaheadConstants").THREAD_TYPE;if(!v)return p(r,u,c("MercurySheetPolicy").sheets.FantaAddFriendsSheet)}return r}f.exports={addParticipants:q,onBootloadTypeahead:l,onGetThreadResponse:j,openAddMoreFriends:n}}),null);
__d("FantaTypeFileUploader",["immutable"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=Object.freeze({ANIMATED_IMAGE:"animated_image",AUDIO:"audio",FILE:"file",GENERIC_ATTACHMENT:"generic_attachment",IMAGE:"image",VIDEO:"video"}),k={uploadedFiles:c("immutable").Map(),uploadingFiles:c("immutable").Map()};h=babelHelpers.inherits(l,c("immutable").Record(k));i=h&&h.prototype;l.prototype.getTypeIDs=function(m){return this.uploadedFiles.reduce(function(n,o){if(o.type===m&&o.uploadedID)n=n.concat(o.uploadedID);return n},[])};function l(){h.apply(this,arguments)}l.fileTypes=j;f.exports=l}),null);
__d("FantaTypeSharePreview",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={isLoading:false,params:null,type:null,uri:null};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("FantaTypeComposer",["FantaTypeFileUploader","FantaTypeSharePreview","immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j=0,k={fileUploader:new(c("FantaTypeFileUploader"))(),sharePreview:new(c("FantaTypeSharePreview"))(),text:"",version:j};h=babelHelpers.inherits(l,c("immutable").Record(k));i=h&&h.prototype;function l(){i.constructor.call(this,{version:++j})}f.exports=l}),null);
__d("FantaMessageActions",["Bootloader","FantaDispatcher","FantaTypeComposer","MercuryConfig","ifRequired","keyMirror","emptyFunction","setImmediate"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")({CANCEL_FILE_UPLOAD:null,COMPOSER_TEXT_UPDATE:null,LINK_PREVIEW:null,LOADED_SHARE_DATA:null,LOADING_SHARE_DATA:null,PREPARE_FILES_FOR_SEND:null,RECEIVED_NEW_MESSAGE:null,REMOVE_SHARE_PREVIEW:null,SEND_GROUP_MESSAGE:null,SEND_HOT_LIKE:null,SEND_MESSAGE:null,SEND_PHOTO:null,SEND_STICKER:null,UPDATE_GROUP_NAME:null,UPLOAD_FILE_FAILED:null,UPLOADED_FILE:null});function i(){var l=document.createElement("form");l.action=c("MercuryConfig").upload_url;l.method="post";return l}function j(l,m){var n=document.createElement("input");n.type="file";n.name="attachment[]";n.multiple=true;if(m)n.onchange=m;l.appendChild(n);return n}var k={Types:h,prepareFilesForSend:function l(m,n,o){this.dispatchOrBootloadUploader(function(){c("FantaDispatcher").dispatch({type:h.PREPARE_FILES_FOR_SEND,tabID:m,files:n,composer:o})})},openUploadFilePicker:function l(m,n){var o=i(),p=j(o,function(){k.prepareFilesForSend(m,this.files,n)});p.click()},uploadedFile:function l(m,n,o){this.dispatchOrBootloadUploader(function(){c("FantaDispatcher").dispatch({type:h.UPLOADED_FILE,tabID:m,uploadID:n,payload:o})})},uploadFileFailed:function l(m,n){this.dispatchOrBootloadUploader(function(){c("FantaDispatcher").dispatch({type:h.UPLOAD_FILE_FAILED,tabID:m,uploadID:n})})},cancelFileUpload:function l(m,n){this.dispatchOrBootloadUploader(function(){c("FantaDispatcher").dispatch({type:h.CANCEL_FILE_UPLOAD,tabID:m,uploadID:n})})},linkPreview:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c("FantaDispatcher").dispatch({type:h.LINK_PREVIEW,tabID:m,uri:n})})},loadedShareData:function l(m,n,o){this.dispatchOrBootloadSharePreview(function(){c("FantaDispatcher").dispatch({type:h.LOADED_SHARE_DATA,tabID:m,attachmentData:n,composer:o})})},loadingShareData:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c("FantaDispatcher").dispatch({type:h.LOADING_SHARE_DATA,composer:n,tabID:m})})},removeSharePreview:function l(m,n){this.dispatchOrBootloadSharePreview(function(){c("FantaDispatcher").dispatch({type:h.REMOVE_SHARE_PREVIEW,tabID:m,composer:n})})},receivedNewMessage:function l(m,n){c("FantaDispatcher").dispatch({type:h.RECEIVED_NEW_MESSAGE,tabID:m,message:n})},updateGroupName:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.UPDATE_GROUP_NAME,threadID:m,newName:n})})},sendGroupMessage:function l(m,n){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.SEND_GROUP_MESSAGE,threadID:m,onSendSuccess:n})})},sendMessage:function l(m,n,o,p){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.SEND_MESSAGE,threadID:m,message:n,composer:o,onSendSuccess:p})})},sendPhoto:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.SEND_PHOTO,onSendSuccess:o,photoData:n,threadID:m})})},sendHotLike:function l(m,n,o,p,q){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.SEND_HOT_LIKE,emoji:n,onSendSuccess:q,size:o,source:p,threadID:m})})},sendSticker:function l(m,n,o){this.dispatchOrBootloadSendMessages(function(){c("FantaDispatcher").dispatch({type:h.SEND_STICKER,threadID:m,stickerID:n,onSendSuccess:o})})},composerTextUpdate:function l(m,n,o){if(n.length>0)c("ifRequired")("FantaReducersSendMessages",c("emptyFunction"),function(){return this.dispatchOrBootloadSendMessages(c("emptyFunction"))}.bind(this));this.dispatchOrBootloadSharePreview(function(){c("FantaDispatcher").dispatch({type:h.COMPOSER_TEXT_UPDATE,composer:o,message:n,threadID:m})})},dispatchOrBootloadSendMessages:function l(m){c("ifRequired")("FantaReducersSendMessages",function(){c("setImmediate")(m)},function(){c("Bootloader").loadModules(["FantaAppStore","FantaReducersSendMessages"],function(n,o){n.addReducers(o);c("setImmediate")(m)},"FantaMessageActions")})},dispatchOrBootloadUploader:function l(m){c("ifRequired")("FantaReducersFileUploader",function(){m()},function(){c("Bootloader").loadModules(["FantaAppStore","FantaReducersFileUploader"],function(n,o){n.addReducers(o);m()},"FantaMessageActions")})},dispatchOrBootloadSharePreview:function l(m){c("ifRequired")("FantaReducersSharePreview",function(){m()},function(){c("Bootloader").loadModules(["FantaAppStore","FantaReducersSharePreview"],function(n,o){n.addReducers(o);m()},"FantaMessageActions")})}};f.exports=k}),null);
__d("FantaReducersCookie",["FantaMessageActions","FantaTabActions","PresenceState","emptyFunction","throttle","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FantaMessageActions").Types,i=c("FantaTabActions").Types,j=c("gkx")("AT7GEM_Bk6j5oGIkj34d9qm70CejWGUjCaOEQ_zb6oT8Z0SFosMbKeMY0NUporco3a4nlVgYlJ0f1Hlwi6t_P31q")?c("throttle").acrossTransitions(c("PresenceState").doSync,500):c("emptyFunction");function k(n,o){switch(o.type){case h.RECEIVED_NEW_MESSAGE:case i.CLOSE_ALL_TABS:case i.CLOSE_AND_TAB_NEXT:case i.CLOSE_TAB:case i.DELETE_TAB:case i.MINIMIZE_ALL_TABS:case i.MINIMIZE_TAB:case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:case i.REPLACE_TAB:case i.UNMINIMIZE_TAB:j();return m(n)}return n}function l(n,o){switch(o.type){case i.LOAD_FROM_DATA:var p=n.tabGroup,q=o.tabData,r=p.updatedTime,s=r>=q.updatedTime||q.updatedTime===undefined?r:q.updatedTime;return n.mergeIn(["tabGroup"],{updatedTime:s})}return n}function m(n){return n.mergeIn(["tabGroup"],{updatedTime:Date.now()})}f.exports={updateCookie:k,loadFromData:l}}),null);
__d("FantaReducersDockCalculator",["Arbiter","FantaTabActions","FantaMessageActions","setImmediate"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FantaTabActions").Types,i=c("FantaMessageActions").Types,j=null;function k(n){j=n;c("setImmediate")(function(){c("Arbiter").inform("FantaReducersDockCalculator/shouldRecalculate")})}function l(n){__p&&__p();if(!j||n.size!==j.size)k(n);else{var o=false;n.forEach(function(p){var q=j&&j.get(p.id);if(!q||p.isMinimized!==q.isMinimized)o=true});if(o)k(n)}}function m(n,o){var p=n.tabGroup.tabs;switch(o.type){case h.CLOSE_ALL_TABS:case h.CLOSE_AND_TAB_NEXT:case h.CLOSE_TAB:case h.DELETE_TAB:case h.MINIMIZE_ALL_TABS:case h.MINIMIZE_TAB:case h.OPEN_TAB:case h.OPEN_TAB_WITH_INTERSTITIAL_DATA:case h.UNMINIMIZE_TAB:k(p);break;case h.LOAD_FROM_DATA:case i.RECEIVED_NEW_MESSAGE:l(p);break}return n}f.exports={recalculateDock:m}}),null);
__d("FantaReducersLogging",["Bootloader","FantaMessageActions","FantaTabActions"],(function a(b,c,d,e,f,g){"use strict";var h=c("FantaMessageActions").Types,i=c("FantaTabActions").Types;function j(k,l){switch(l.type){case i.CLOSE_ALL_TABS:case i.CLOSE_AND_TAB_NEXT:case i.CLOSE_TAB:case i.DELETE_TAB:case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:var m=k.tabGroup.allowedRaisedTabs,n=k.tabGroup.getRaisedandUnraisedTabs(),o=n.raisedTabs,p=n.unraisedTabs,q=o.count(),r=q+p.count();c("Bootloader").loadModules(["FantaTabsVisibleTypedLogger"],function(s){new s().setAllowedRaisedTabs(m).setOpenTabs(r).setVisibleTabs(q).log()},"FantaReducersLogging")}return k}f.exports={updateVisibleTabs:j}}),null);
__d("FantaTypeJoinableThread",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={admins:[],approvalMode:0,associatedObject:null,description:null,friendsInParticipants:[],imageURL:null,isViewerSubscribed:false,isWorkpaceChat:false,joinableMode:{mode:0,link:""},linkHash:"",participants:[],threadID:null,threadFBID:null,threadName:null};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("FantaTypeTabContents",["ChatPrivacyActionController","FantaGetMessageActions","FantaTypeComposer","immutable","MercuryIDs","emptyFunction","setImmediate"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j={composer:new(c("FantaTypeComposer"))(),hasFetchedAll:false,id:"",isMultiCompany:null,isScrolledToBottom:true,joinableInterstitialData:null,membershipParticipants:null,mentorship:null,messages:c("immutable").List(),messageStore:null,nullStateCTA:null,openSheet:null,pageIndicator:null,pageIndicatorDescription:null,privacyController:null,showContextBanner:false,showUnseenMessages:c("emptyFunction"),signatureID:null,thread:null,threadPreviewID:null,threadPreviewRecipients:null,timezoneInfo:null,typeahead:null,workAvailabilityHumanReadable:null,workAvailabilityStatus:null};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(l){var m=void 0,n=c("MercuryIDs").getUserIDFromThreadID(l.id);if(n)m=new(c("ChatPrivacyActionController"))(n,function(o){c("setImmediate")(function(){c("FantaGetMessageActions").onPrivacyStateChange(l.id,o)})});i.constructor.call(this,babelHelpers["extends"]({privacyController:m},l))}f.exports=k}),null);
__d("WorkFocusMode",["invariant","WorkModeConfig","WorkUserAvailabilityStatusType","emptyFunction","ifRequired"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i={},j={status:"AVAILABLE",end_date:0};if(c("WorkModeConfig").availability){j.status=c("WorkModeConfig").availability.status;j.end_date=c("WorkModeConfig").availability.end_date}f.exports={updateAvailability:function k(l,m){var n=Object.keys(c("WorkUserAvailabilityStatusType")).find(function(o){return c("WorkUserAvailabilityStatusType")[o]===l});typeof n==="string"||h(0);j.status=n;j.end_date=m},currentViewerInFocusMode:function k(l){__p&&__p();if(!c("WorkModeConfig").focus_messaging_enabled)return false;if(l){if(i[l])return false;var m=null;c("ifRequired")("MercuryThreads",function(o){m=o.get().getThreadMetaNow(l)},c("emptyFunction"));if(m&&m.bypass_focus_mode_until&&m.bypass_focus_mode_until>Date.now()/1e3)return false}var n=c("WorkUserAvailabilityStatusType")[j.status];if(n===c("WorkUserAvailabilityStatusType").FOCUS&&j.end_date*1e3>Date.now())return true;return false},addBypassFocusModeForThread:function k(l){i[l]=true},removeBypassFocusModeForThread:function k(l){i[l]=false}}}),null);
__d("FantaReducersMercury",["Arbiter","AsyncSignal","AvailableList","AvailableListConstants","Bootloader","FantaAvailableStatus","FantaGetMessageActions","FantaMessageActions","FantaTabActions","FantaTabSheetActions","FantaTypeJoinableThread","FantaTypeTabContents","JSLogger","MercuryIDs","MercuryThreadIDMap","TimeSlice","WorkFocusMode","getPageIDFromThreadID","gkx","ifRequired","setImmediate"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryThreadIDMap").get(),i=c("JSLogger").create("FantaReducersMercury"),j=c("FantaMessageActions").Types,k=c("FantaTabActions").Types,l=c("FantaGetMessageActions").Types;function m(){return Math.floor(Math.random()*2147483648).toString(16)}function n(G,H){__p&&__p();switch(H.type){case k.OPEN_TAB:case k.OPEN_TAB_WITH_INTERSTITIAL_DATA:var I=H.tabID;c("ifRequired")("FantaTabsReactApp",function(M){if(!c("MercuryIDs").isValidThreadID(I)){G=G.deleteIn(["tabGroup","tabs",I]);v(I)}else D(G,I)},function(){return G=o(G,H.tabID)});G=q(G,I);var J=m(),K=G.mercury.tabContents.get(I);K=K.merge({signatureID:J});G=G.setIn(["mercury","tabContents",I],K);new(c("AsyncSignal"))("/ajax/chat/opentab_tracking.php",{threadID:I,userID:c("MercuryIDs").getUserIDFromThreadID(I),signatureID:J}).send();if(H.interstitialData){var L=new(c("FantaTypeJoinableThread"))(H.interstitialData);K=K.merge({joinableInterstitialData:L});G=G.setIn(["mercury","tabContents",I],K)}c("Arbiter").inform("jewel/hide");return G}return G}function o(G,H){c("ifRequired")("FantaTabsSlimApp",function(I){if(!c("MercuryIDs").isValidThreadID(H)){G=G.deleteIn(["tabGroup","tabs",H]);v(H)}else D(G,H)},function(){D(G,H)});return G}function p(G,H){switch(H.type){case j.RECEIVED_NEW_MESSAGE:G=q(G,H.tabID)}return G}function q(G,H){__p&&__p();var I,J=G.mercury.tabContents.get(H);if(!J){var I=function(){__p&&__p();var K=c("getPageIDFromThreadID")(H);if(K)c("Bootloader").loadModules(["PagesMercuryChatTabIndicatorHandler"],function(L){var M=c("AvailableListConstants").OFFLINE,N=new L(K,M,function(O){c("setImmediate")(function(){c("FantaTabSheetActions").openPageIndicatorSheet(H,O)})},function(){c("setImmediate")(function(){return c("FantaTabSheetActions").closePageIndicatorSheet(H)})});c("setImmediate")(function(){c("FantaTabSheetActions").onIsPageTab(H,N)});N.checkResponsiveness()},"FantaReducersMercury");return{v:G.setIn(["mercury","tabContents",H],new(c("FantaTypeTabContents"))({id:H}))}}();if(typeof I==="object")return I.v}return G}function r(G,H){switch(H.type){case k.REPLACE_TAB:G=u(G,H.newTabID);G=q(G,H.newTabID);return G}return G}function s(G,H){switch(H.type){case l.ADD_PARTICIPANTS:var I=H.tabID,J=H.previewTabID,K=G.mercury.tabContents.get(I);if(!K)return G;K=K.merge({threadPreviewID:J});G=G.setIn(["mercury","tabContents",I],K);return G}return G}function t(G,H){switch(H.type){case l.CLEAR_PARTICIPANTS:var I=H.tabID;G=G.setIn(["mercury","tabContents",I],new(c("FantaTypeTabContents"))({id:I}))}return G}function u(G,H){__p&&__p();c("ifRequired")("FantaTabsReactApp",function(I){if(!c("MercuryIDs").isValidThreadID(H)){G=G.deleteIn(["tabGroup","tabs",H]);v(H)}},function(){c("ifRequired")("FantaTabsSlimApp",function(I){if(!c("MercuryIDs").isValidThreadID(H)){G=G.deleteIn(["tabGroup","tabs",H]);v(H)}})});return G}function v(G){h.getClientIDFromServerID(G,function(H){return c("setImmediate")(function(){if(c("MercuryIDs").isValidThreadID(H))c("FantaTabActions").openTab(H);else i.error("invalid id",G)})})}function w(G,H){switch(H.type){case k.FOCUS_TAB:D(G,H.tabID)}return G}function x(G,H){switch(H.type){case k.CLOSE_TAB:var I=H.tabID;G=z(G,I)}return G}function y(G,H){switch(H.type){case k.DELETE_TAB:var I=H.tabID;G=z(G,I);G=G.deleteIn(["mercury","tabContents",I])}return G}function z(G,H){c("ifRequired")("MessengerVideoAutoplayActions",function(I){I.deleteThread(H)});c("WorkFocusMode")&&c("WorkFocusMode").removeBypassFocusModeForThread(H);return G}function A(G,H){switch(H.type){case k.CLOSE_ALL_TABS:c("ifRequired")("MessengerVideoAutoplayActions",function(I){I.deleteAllThreads()});return G}return G}function B(G,H){switch(H.type){case k.FOCUS_NEXT_TAB:case k.FOCUS_PREVIOUS_TAB:case k.CLOSE_AND_TAB_NEXT:var I=G.tabGroup.focusedTabID;if(I)D(G,I)}return G}function C(G,H){switch(H.type){case k.CLOSE_AND_TAB_NEXT:var I=H.tabID;c("WorkFocusMode")&&c("WorkFocusMode").removeBypassFocusModeForThread(I)}return G}function D(G,H){__p&&__p();var I=c("MercuryIDs").getUserIDFromThreadID(H);if(I){var J=function J(){c("AvailableList").updateForID(I)};if(c("gkx")("AT45Q0YAtTF77a1x8ZT9-rWfsF83gTI5tMuldZujY0KaNI6icTW09jBEE5BSuvPKdZtVIIdleK4appEhrvQPrVOyhvdXTeLDSdYEXUe9KmbS3Q"))c("TimeSlice").guard(J,"superfluous request to first open DD",{propagationType:c("TimeSlice").PropagationType.ORPHAN})();else J()}var K=G.mercury.tabContents.get(H);if(K){var L=K.thread,M=K.pageIndicator;if(M)M.notifyPageOnlineStatusChanged(c("FantaAvailableStatus").getStatus(L,H))}}function E(G,H){switch(H.type){case k.UNMINIMIZE_TAB:D(G,H.tabID)}return G}function F(G,H){__p&&__p();switch(H.type){case k.LOAD_FROM_DATA:for(var I=G.tabGroup.tabs.keys(),J=Array.isArray(I),K=0,I=J?I:I[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var L;if(J){if(K>=I.length)break;L=I[K++]}else{K=I.next();if(K.done)break;L=K.value}var M=L;G=q(G,M)}}return G}f.exports={addParticipants:s,clearParticipants:t,closeAllTabs:A,closeAndTabNext:C,closeTab:x,deleteTab:y,focusTab:w,focusTabEvents:B,loadFromData:F,openTab:n,receivedNewMessage:p,replaceTab:r,unminimizeTab:E}}),null);
__d("FantaReducersMessages",["CurrentUser","FantaGetMessageActions","FantaMessageActions","FantaTabActions","FantaTypeComposer","MercuryBrowserAlerts","MercuryParticipants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FantaMessageActions").Types,i=c("FantaTabActions").Types,j=c("FantaGetMessageActions").Types;function k(r,s){switch(s.type){case h.RECEIVED_NEW_MESSAGE:var t=s.message;c("MercuryBrowserAlerts").messageReceived(t);return r}return r}function l(r,s){switch(s.type){case h.COMPOSER_TEXT_UPDATE:var t=s.composer,u=s.message,v=s.threadID,w=r.mercury.tabContents.get(v);if(!w||w&&w.composer.version!==t.version)return r;return r.mergeIn(["mercury","tabContents",v,"composer"],{text:u})}return r}function m(r,s){switch(s.type){case i.CLOSE_TAB:case i.CLOSE_AND_TAB_NEXT:if(!r.mercury.tabContents.get(s.tabID))return r;return r.setIn(["mercury","tabContents",s.tabID,"composer"],new(c("FantaTypeComposer"))())}return r}function n(r,s){switch(s.type){case i.CLOSE_ALL_TABS:var t=r.mercury.tabContents;t.forEach(function(u){var v=u.id;r=r.setIn(["mercury","tabContents",v,"composer"],new(c("FantaTypeComposer"))())});return r}return r}function o(r,s){switch(s.type){case i.SCROLL_BOTTOM_CHANGED:var t=s.tabID,u=s.isScrolledToBottom,p=s.showUnseenMessages,v=r.mercury.tabContents.get(t);if(!v)return r;v=v.merge({isScrolledToBottom:u,showUnseenMessages:p});r=r.setIn(["mercury","tabContents",t],v)}return r}function p(r,s){switch(s.type){case i.SHOW_UNSEEN_MESSAGES:var t=s.tabID,u=r.mercury.tabContents.get(t);if(u)u.showUnseenMessages()}return r}function q(r,s){__p&&__p();switch(s.type){case j.ON_GET_THREAD_RESPONSE:var t=s.thread,u=t.thread_id,v=r.mercury.tabContents.get(u);if(!v)return r;var w=null;if(c("CurrentUser").isWorkUser()&&t.participants)w=t.participants.map(c("MercuryParticipants").getOrFetch,c("MercuryParticipants")).find(function(x){return x&&x.is_coworker===false})!==undefined;v=v.merge({thread:t,isMultiCompany:w});r=r.setIn(["mercury","tabContents",u],v);break}return r}f.exports={closeAllTabs:n,closeTab:m,composerTextUpdate:l,onGetThreadResponse:q,receivedNewMessage:k,scrollBottomChanged:o,showUnseenMessages:p}}),null);
__d("FantaTypeTab",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={focusCounter:0,id:"",isHovered:false,isMinimized:false,openCounter:0,entryPoint:"unknown"};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("FantaTypeTabGroup",["FantaConst","immutable"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j={allowedRaisedTabs:c("FantaConst").DEFAULT_ALLOWED_RAISED_TABS,focusedTabID:null,tabs:c("immutable").Map({}),updatedTime:0},k=function k(n){return n.openCounter*-1},l=function l(n){return n.focusCounter*-1};h=babelHelpers.inherits(m,c("immutable").Record(j));i=h&&h.prototype;m.prototype.getRaisedandUnraisedTabs=function(){var n=this.tabs.sortBy(l),o=n.slice(this.allowedRaisedTabs),p=n.take(this.allowedRaisedTabs).sortBy(k);return{raisedTabs:p,unraisedTabs:o}};function m(){h.apply(this,arguments)}f.exports=m}),null);
__d("isWebMessengerURI",[],(function a(b,c,d,e,f,g){function h(i){return/^(\/messages)/.test(i.getPath())}f.exports=h}),null);
__d("FantaReducersTabs",["Bootloader","EventProfiler","FantaConst","FantaMessageActions","FantaTabActions","FantaTypeTab","FantaTypeTabGroup","LogHistory","MercuryThreads","PinnedConversationNubsConfig","TimeSlice","URI","isWebMessengerURI"],(function a(b,c,d,e,f,aa){"use strict";__p&&__p();var g=c("MercuryThreads").get(),h=c("FantaMessageActions").Types,i=c("FantaTabActions").Types,j="tab_",k=c("LogHistory").getInstance("fanta_tabs"),l=1,m=1,n=1;function o(O,P){switch(P.type){case i.OPEN_TAB:case i.OPEN_TAB_WITH_INTERSTITIAL_DATA:k.debug(P.type,JSON.stringify({id:P.tabID}));if(m===1)c("EventProfiler").tagCurrentActiveInteractionsAs("FirstChatTabOpen");return v(O,P.tabID||j+n++,true,P.entryPoint)}return O}function p(O,P){__p&&__p();switch(P.type){case i.REPLACE_TAB:var Q=P.tabID,R=P.newTabID,S=O.tabGroup,T=S.tabs,U=T.get(Q);k.debug(P.type,JSON.stringify({id:Q,isExisting:!!U,newID:R}));if(U){var V=U.id===O.tabGroup.focusedTabID;O=O.setIn(["tabGroup","tabs",R],U.merge({id:R})).deleteIn(["tabGroup","tabs",Q]);return v(O,R,V,"replace_tab")}return v(O,R,false,"replace_tab")}return O}function q(O,P){switch(P.type){case i.MINIMIZE_TAB:return w(O,P.tabID,true)}return O}function r(O,P){switch(P.type){case i.UNMINIMIZE_TAB:return w(O,P.tabID,false)}return O}function s(O,P){switch(P.type){case i.FOCUS_TAB:var Q=P.tabID;return D(O,Q)}return O}function t(O,P){switch(P.type){case i.BLUR_TAB:return E(O,P.tabID)}return O}function u(O,P){__p&&__p();var Q;switch(P.type){case h.RECEIVED_NEW_MESSAGE:var R=P.tabID,o=O.tabGroup.tabs.get(R);k.debug(P.type,JSON.stringify({id:R,isOpen:!!o}));if(!o){var Q=function(){__p&&__p();var S=O.tabGroup.focusedTabID;O=v(O,R,false,"message_received");var T=O.tabGroup.allowedRaisedTabs,U=O.tabGroup.getRaisedandUnraisedTabs(),V=U.raisedTabs,W=U.unraisedTabs,X=V.count(),Y=X+W.count();c("TimeSlice").guard(function(){c("Bootloader").loadModules(["FantaTabsVisibleTypedLogger"],function($){new $().setAllowedRaisedTabs(T).setOpenTabs(Y).setVisibleTabs(X).log()},"FantaReducersTabs")},"name",{propagationType:c("TimeSlice").PropagationType.ORPHAN})();var Z=c("URI").getNextURI();if(c("isWebMessengerURI")(Z))return{v:O=w(O,R,true)};else if(S)return{v:D(O,S)}}();if(typeof Q==="object")return Q.v}}return O}function v(O,P,Q){__p&&__p();var R=arguments.length<=3||arguments[3]===undefined?"unknown":arguments[3],S=O.tabGroup,T=S.tabs,U=T.get(P);if(!U){U=new(c("FantaTypeTab"))({id:P,focusCounter:l,openCounter:m++,entryPoint:R});O=O.setIn(["tabGroup","tabs",P],U)}else if(U.isMinimized&&Q)O=w(O,P,false);if(Q)return D(O,P);return O}function w(O,P,Q){var R=O.tabGroup,S=R.tabs.get(P);if(S)O=O.mergeIn(["tabGroup","tabs",P],{isMinimized:Q});return O}function x(O,P){__p&&__p();switch(P.type){case i.MINIMIZE_ALL_TABS:for(var Q=O.tabGroup.tabs.keys(),R=Array.isArray(Q),S=0,Q=R?Q:Q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var T;if(R){if(S>=Q.length)break;T=Q[S++]}else{S=Q.next();if(S.done)break;T=S.value}var U=T;O=w(O,U,true)}return O}return O}function y(O,P){switch(P.type){case i.CLOSE_TAB:case i.DELETE_TAB:var Q=P.tabID;k.debug(P.type,JSON.stringify({id:Q}));return A(O,Q)}return O}function z(O,P){switch(P.type){case h.SEND_GROUP_MESSAGE:var Q=P.threadID,R=g.isEmptyLocalThread(Q);if(R)return A(O,Q)}return O}function A(O,P){O=E(O,P);return O.deleteIn(["tabGroup","tabs",P])}function B(O,P){switch(P.type){case i.CLOSE_ALL_TABS:k.debug(P.type);O=E(O,O.tabGroup.focusedTabID);return O.setIn(["tabGroup","tabs"],O.tabGroup.tabs.clear())}return O}function C(O,P){switch(P.type){case i.CLOSE_AND_TAB_NEXT:k.debug(P.type,JSON.stringify({id:P.tabID}));O=A(O,P.tabID);return M(O)}return O}function D(O,P){var Q=arguments.length<=2||arguments[2]===undefined?false:arguments[2],R=O.tabGroup,S=R.tabs.get(P);if(S)O=O.mergeIn(["tabGroup","tabs",P],{focusCounter:l++});var T=Q?null:P;O=O.mergeIn(["tabGroup"],{focusedTabID:T});return O}function E(O,P){if(O.tabGroup.focusedTabID===P)return O.mergeIn(["tabGroup"],{focusedTabID:null});return O}function F(O,P){switch(P.type){case i.HOVERED_TAB:var Q=P.tabID;return H(O,Q,true)}return O}function G(O,P){switch(P.type){case i.UNHOVERED_TAB:var Q=P.tabID;return H(O,Q,false)}return O}function H(O,P,Q){var R=O.tabGroup,S=R.tabs.get(P);if(S)O=O.mergeIn(["tabGroup","tabs",P],{isHovered:Q});return O}function I(O,P){__p&&__p();var Q;switch(P.type){case i.SET_ALLOWED_RAISED_TABS:var R=P.allowedRaisedTabs,S=O.tabGroup.allowedRaisedTabs;if(R!==S)(function(){k.debug(P.type,JSON.stringify({count:R}));if(!c("PinnedConversationNubsConfig").chatTabTypingPriority)R=Math.max(1,R);var T=O.tabGroup.tabs.count(),U=T>R?R:T,V=R>S&&T>S,W=R<S&&T>R;if(V||W)c("Bootloader").loadModules(["FantaTabsVisibleTypedLogger"],function(X){new X().setAllowedRaisedTabs(R).setOpenTabs(T).setVisibleTabs(U).log()},"FantaReducersTabs")})();return J(O,R)}return O}function J(O){var P=arguments.length<=1||arguments[1]===undefined?c("FantaConst").DEFAULT_ALLOWED_RAISED_TABS:arguments[1];if(P===O.tabGroup.allowedRaisedTabs)return O;if(!c("PinnedConversationNubsConfig").chatTabTypingPriority)P=Math.max(1,P);return O.mergeIn(["tabGroup"],{allowedRaisedTabs:P})}function K(O,P){__p&&__p();switch(P.type){case i.LOAD_FROM_DATA:var Q=O.tabGroup,R=P.tabData,S=Q.updatedTime;if(S>=R.updatedTime||R.updatedTime===undefined)return O;O=J(O.set("tabGroup",new(c("FantaTypeTabGroup"))()),Q.allowedRaisedTabs);var T=[];R.tabs.sort(function(U,V){return U.openCounter-V.openCounter}).forEach(function(U){T.push(U.id);O=v(O,U.id,false,"loaded_from_data");if(U.isMinimized)O=w(O,U.id,U.isMinimized)});R.tabs.sort(function(U,V){return U.focusCounter-V.focusCounter}).forEach(function(U){O=D(O,U.id,true)});k.debug(P.type,JSON.stringify({updatedTime:S,newerTime:R.updatedTime,opened:T}));O=R.focusedTabID?D(O,R.focusedTabID,true):E(O)}return O}function L(O,P){switch(P.type){case i.FOCUS_NEXT_TAB:return M(O)}return O}function M(O){__p&&__p();var P=O.tabGroup.focusedTabID,Q=O.tabGroup.getRaisedandUnraisedTabs(),R=Q.raisedTabs,S=R.count();if(S===0)return O;else if(R.count()===1)return D(O,R.first().id);var T=R.skipUntil(function(U){return U.id===P}).rest();if(T.count()===0)return D(O,R.first().id);else return D(O,T.first().id)}function N(O,P){__p&&__p();switch(P.type){case i.FOCUS_PREVIOUS_TAB:var Q=O.tabGroup.focusedTabID,R=O.tabGroup.getRaisedandUnraisedTabs(),S=R.raisedTabs;if(S.count()<2)return O;var T=S.reverse().skipUntil(function(U){return U.id===Q}).rest();if(T.count()===0)return D(O,S.last().id);else return D(O,T.first().id)}return O}f.exports={addParticipantsToLocalGroup:z,blurTab:t,closeAllTabs:B,closeAndTabNext:C,closeTab:y,focusNextTab:L,focusPreviousTab:N,focusTab:s,hoveredTab:F,loadFromData:K,minimizAllTabs:x,minimizeTab:q,openTab:o,receivedNewMessage:u,replaceTab:p,setAllowedRaisedTabs:I,unhoveredTab:G,unminimizeTab:r}}),null);
__d("FantaTypeMercuryState",["immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={tabContents:c("immutable").Map({})};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("FantaTypeAppState",["FantaTypeMercuryState","FantaTypeTabGroup","immutable"],(function a(b,c,d,e,f,g){"use strict";var h,i,j={tabGroup:new(c("FantaTypeTabGroup"))(),mercury:new(c("FantaTypeMercuryState"))()};h=babelHelpers.inherits(k,c("immutable").Record(j));i=h&&h.prototype;function k(){h.apply(this,arguments)}f.exports=k}),null);
__d("FantaAppStore",["FantaComposeViewReducers","FantaDispatcher","FantaReducersCookie","FantaReducersDockCalculator","FantaReducersLogging","FantaReducersMercury","FantaReducersMessages","FantaReducersTabs","FantaTypeAppState","FluxReduceStore","PresenceState","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=[].concat(Object.values(c("FantaReducersTabs")),Object.values(c("FantaReducersMercury")),Object.values(c("FantaReducersMessages")),Object.values(c("FantaReducersDockCalculator")),Object.values(c("FantaReducersCookie")),Object.values(c("FantaComposeViewReducers")),Object.values(c("FantaReducersLogging")));h=babelHelpers.inherits(k,c("FluxReduceStore"));i=h&&h.prototype;k.prototype.getInitialState=function(){return new(c("FantaTypeAppState"))()};k.prototype.ignoreReducer=function(m){var n=Object.values(m);j=j.filter(function(o){return!n.find(function(p){return p===o})})};k.prototype.addReducers=function(m){this.ignoreReducer(m);j=j.concat(Object.values(m))};k.prototype.reduce=function(m,n){return j.reduce(function(m,o){return o(m,n)},m)};function k(){h.apply(this,arguments)}var l=new k(c("FantaDispatcher"));if(!c("gkx")("AT7GEM_Bk6j5oGIkj34d9qm70CejWGUjCaOEQ_zb6oT8Z0SFosMbKeMY0NUporco3a4nlVgYlJ0f1Hlwi6t_P31q"))l.addListener(function(){return c("PresenceState").doSync()});f.exports=l}),null);
__d("FantaCookieUtil",["FantaConst","Map","MercuryIDs","MercuryThreads","WorkModeConfig"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryThreads").get(),i={convertCookieData:function j(k,l,m){__p&&__p();var n={tabs:[],focusedTabID:null,updatedTime:0,interstitialData:m},o=[],p=this._getCookieKeys();k=k||{};if(k[p.tabs])o=k[p.tabs];o.forEach(function(u){n.tabs.push({id:u.i,isMinimized:!u.r,openCounter:u.o,focusCounter:u.f})});if(l)for(var q=l.tabs.values(),r=Array.isArray(q),s=0,q=r?q:q[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var t;if(r){if(s>=q.length)break;t=q[s++]}else{s=q.next();if(s.done)break;t=s.value}var u=t;if(h.isEmptyLocalThread(u.id))n.tabs.push({id:u.id,isMinimized:u.isMinimized,openCounter:u.openCounter,focusCounter:u.focusCounter})}n.focusedTabID=k[p.focusedTabID];n.updatedTime=k[p.updatedTime];return n},createCookieData:function j(k,l){__p&&__p();var m=[],n=this._getCookieKeys();if(l[n.updatedTime]>k.updatedTime)return l;for(var o=k.tabs.values(),p=Array.isArray(o),q=0,o=p?o:o[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var r;if(p){if(q>=o.length)break;r=o[q++]}else{q=o.next();if(q.done)break;r=q.value}var s=r;if(!c("MercuryIDs").isLocalThread(s.id))m.push({i:s.id,r:s.isMinimized?undefined:1,o:s.openCounter,f:s.focusCounter})}l[n.tabs]=m;l[n.focusedTabID]=k.focusedTabID;l[n.updatedTime]=k.updatedTime;return l},_getCookieKeys:function j(){var k=c("WorkModeConfig").is_work_user;return{tabs:k?c("FantaConst").cookieIDs.WORK_COOKIE_ID:c("FantaConst").cookieIDs.PERSONAL_COOKIE_ID,focusedTabID:k?c("FantaConst").cookieIDs.WORK_FOCUS_COOKIE_ID:c("FantaConst").cookieIDs.PERSONAL_FOCUS_COOKIE_ID,updatedTime:k?c("FantaConst").cookieIDs.WORK_TIME_COOKIE_ID:c("FantaConst").cookieIDs.PERSONAL_TIME_COOKIE_ID}}};f.exports=i}),null);
__d("FantaMercuryThreadEventsBootloaded",["Bootloader","MercuryThreadInformer","MercuryThreads","MercuryViewer"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryThreadInformer").get(),i=c("MercuryThreads").get(),j={onMessagesReceived:function k(l){__p&&__p();h.subscribe("messages-received",function(m,n){__p&&__p();var o,p=function p(q){__p&&__p();var r,s=n[q],t=function t(u){var v=s[u];if(v.author!=c("MercuryViewer").getID()){if(!v.is_unread)return"continue";i.getThreadMeta(q,function(w){c("Bootloader").loadModules(["ChatTabPolicy"],function(x){x.messageIsAllowed(w,v,function(){l(q,v)})},"FantaMercuryThreadEventsBootloaded")})}};for(var u=0;u<s.length;u++){var r=t(u);if(r==="continue")continue}};for(var q in n)p(q)})}};f.exports=j}),null);
__d("FantaTabViewportManager",["Arbiter","DockTabsViewportCalculator","DockTabsViewportFantaTabUtils","FantaTabActions","immutable","ifRequired","isWebMessengerURI","setImmediate"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){__p&&__p();var j=c("DockTabsViewportCalculator").getInstance(i);if(!j)return;j.registerFantaTabCallbacks({fantaTabModelStateGetter:function k(){var l=c("immutable").Map({});c("ifRequired")("FantaAppStore",function(m){l=m.getState().tabGroup.tabs});return l},onAvailableWidthChanged:function k(l){c("setImmediate")(function(){c("FantaTabActions").setAllowedRaisedTabs(c("DockTabsViewportFantaTabUtils").getTabCountToFitWidth(l))})}});c("Arbiter").subscribe("FantaReducersDockCalculator/shouldRecalculate",function(){j.forceRecalculateChatTabs()});j.forceRecalculateFBDockWidth();c("Arbiter").subscribe("page_transition",function(k,l){if(c("isWebMessengerURI")(l.uri))c("setImmediate")(function(){return c("FantaTabActions").minimizeAllTabs()})})}f.exports={init:h}}),null);
__d("HotLikeSound",["MercurySoundsConfig","SoundPlayer","StickerConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=[c("MercurySoundsConfig").hot_like_grow_mp3_url,c("MercurySoundsConfig").hot_like_grow_ogg_url],i=[c("MercurySoundsConfig").hot_like_pop_mp3_url,c("MercurySoundsConfig").hot_like_pop_ogg_url],j=[c("MercurySoundsConfig").hot_like_outgoing_small_mp3_url,c("MercurySoundsConfig").hot_like_outgoing_small_ogg_url],k=[c("MercurySoundsConfig").hot_like_outgoing_medium_mp3_url,c("MercurySoundsConfig").hot_like_outgoing_medium_ogg_url],l=[c("MercurySoundsConfig").hot_like_outgoing_large_mp3_url,c("MercurySoundsConfig").hot_like_outgoing_large_ogg_url],m=function m(){return false},n={setCheckSoundEnabledFunc:function o(p){m=p},start:function o(){this._play(h)},stop:function o(){c("SoundPlayer").stop(h)},pop:function o(){this.stop();this._play(i)},snap:function o(p){this.stop();if(p===c("StickerConstants").HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c("StickerConstants").HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c("StickerConstants").HOT_LIKE_LARGE_STICKER_ID)this._play(l)},_play:function o(p){if(m())c("SoundPlayer").play(p)}};f.exports=n}),null);
__d("MercuryDeliveryState",["MercuryConfig","MercuryIDs","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInformer","PresencePrivacy","UserActivity","debounceAcrossTransitions","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryConfig").delivery_timeout||12e4;i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};function i(k){__p&&__p();this.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var l=this.$MercuryDeliveryState5.map(function(m){return m.message_id});if(l)this.$MercuryDeliveryState2.sendDeliveryReceipts(l,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[]}.bind(this);this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c("MercuryServerRequests").getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c("MercuryThreadInformer").getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c("MercuryThreadIDMap").getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe("messages-received",this.$MercuryDeliveryState7.bind(this));c("UserActivity").subscribe(c("debounceAcrossTransitions")(this.$MercuryDeliveryState8,300,this))}i.prototype.$MercuryDeliveryState7=function(k,l){__p&&__p();for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id)}.bind(this))}}.bind(this))}if(c("UserActivity").isActive(h)||c("gkx")("AT6QldQ637XMvCyugHEhjQqDDf2-wtP50HTiWZ1Ww9U3TKMTy-LCSwNJff4SK8McDFogXyIPPHKCxhkz9mFRLCX-m6fUBuF8qkM5EElKo4EzDw"))this.$MercuryDeliveryState8()};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c("MercuryIDs").getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;return true};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MercuryDelayedDispatcher",["MercuryDispatcher","MercuryServerPayloadPreprocessor","MercuryServerRequests","MercurySingletonProvider","MercuryThreadIDMap"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.$MercuryDelayedDispatcher1=j;this.$MercuryDelayedDispatcher2=[];this.$MercuryDelayedDispatcher3=c("MercuryThreadIDMap").getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4=c("MercuryDispatcher").getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher5=c("MercuryServerRequests").getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher6=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercuryDelayedDispatcher1);this.$MercuryDelayedDispatcher4.subscribe("model-update-completed",function(k,l){return this.$MercuryDelayedDispatcher7()}.bind(this))}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.handleUpdateWaitForThread=function(j,k){var l=this.$MercuryDelayedDispatcher3.getClientIDFromServerIDNow(k);if(l){this.$MercuryDelayedDispatcher8(j);return}this.$MercuryDelayedDispatcher3.getClientIDFromServerID(k,function(){return this.$MercuryDelayedDispatcher2.push({thread_fbid:k,payload:j})}.bind(this));this.$MercuryDelayedDispatcher5.ensureThreadIsFetched(k)};h.prototype.$MercuryDelayedDispatcher7=function(){if(this.$MercuryDelayedDispatcher2&&this.$MercuryDelayedDispatcher2.length){var j=this.$MercuryDelayedDispatcher2.shift(),k=j.thread_fbid,l=j.payload;this.handleUpdateWaitForThread(l,k)}};h.prototype.$MercuryDelayedDispatcher8=function(j){if(j.from_client)this.$MercuryDelayedDispatcher4.handleUpdate(j);else this.$MercuryDelayedDispatcher6.handleUpdate(j)};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercurySyncChannelMonitor",["Arbiter","ChannelConstants","CurrentUser","MercurySingletonProvider","MercurySyncFakeDFFSender"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.handleAwfulChannelEvent=function(){if(!c("CurrentUser").isLoggedInNow()){this.killSubscriptions();return}c("MercurySyncFakeDFFSender").getForFBID(this.$MercurySyncChannelMonitor1).sendGlobalDFF()}.bind(this);this.$MercurySyncChannelMonitor1=j;this.$MercurySyncChannelMonitor2=false}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.setupSubscriptions=function(){if(!this.$MercurySyncChannelMonitor2){this.$MercurySyncChannelMonitor4=c("Arbiter").subscribe(c("ChannelConstants").JUMPSTART,this.handleAwfulChannelEvent);this.$MercurySyncChannelMonitor3=c("Arbiter").subscribe(c("ChannelConstants").THROTTLED,this.handleAwfulChannelEvent);this.$MercurySyncChannelMonitor2=true}};h.prototype.killSubscriptions=function(){if(this.$MercurySyncChannelMonitor2){c("Arbiter").unsubscribe(this.$MercurySyncChannelMonitor4);c("Arbiter").unsubscribe(this.$MercurySyncChannelMonitor3);this.$MercurySyncChannelMonitor2=false}};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercuryMessageCustomizations",[],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j,k){var l=j.customizations;if(!l)return null;var m=l.filter(function(n){return n.customization_type===k});return m.length>0?m[0].customization_value:null}function i(j){var k=JSON.parse(j),l=[];Object.keys(k).forEach(function(m){l.push({customization_type:m,customization_value:k[m]})});return l}f.exports={getCustomizationValue:h,parseCustomizations:i}}),null);
__d("MercuryProfileRanges",["idx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){if(!i.id&&i.i)return{id:i.i,offset:i.o,length:i.l};return i}f.exports={extractFromDelta:function i(j){var k,l=(k=j)!=null?(k=k.data)!=null?k.prng:k:k;if(!l)return undefined;var m=[];try{m=JSON.parse(l);if(m.length>0)return m.map(h)}catch(n){}return m}}}),null);
__d("MessengerRealtimeAttachmentTransformer.bs",["MessengerMessageTransformer.bs","MessengerAttachmentTransformer.bs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j,k){var l=c("MessengerMessageTransformer.bs").unsafeCastBlobAttachments(j),m=j.extensible_attachment,n;if(m==null)n=null;else{var o=m.story_attachment;n={legacy_attachment_id:m.legacy_attachment_id,story_attachment:o==null?null:c("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(o)}}return c("MessengerAttachmentTransformer.bs").transformAttachment(i,{extensible_attachment:n,blob_attachments:l,sticker:j.sticker},k)}g.transform=h}),null);
__d("MercurySyncNewMessageTransformer",["FBIDCheck","IrisProtocolMessageLifetime","MercuryActionType","MercuryConfig","MercuryIDs","MercuryMessageCustomizations","MercuryProfileRanges","MercuryTimestamp","MessagingTag","PageCommItemStatus","MessengerRealtimeAttachmentTransformer.bs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=function h(j){var k={};try{k=JSON.parse(j)}catch(l){}return k};function i(j,k){__p&&__p();var l=parseInt(k.messageMetadata.timestamp,10),m=c("MercuryTimestamp").getFormatedTimestamp(l),n=k.messageMetadata.skipBumpThread,o=j!==k.messageMetadata.actorFbId,p=[];if(k.attachments)p=k.attachments.map(function(u){__p&&__p();var v=u.mercury,w=v.extensible_attachment,x=v.blob_attachment,y=v.sticker_attachment;if(!w&&!x&&!y)return null;var z=c("FBIDCheck").isUser_deprecated(j),A=[];if(w)A=c("MessengerRealtimeAttachmentTransformer.bs").transform(j,{extensible_attachment:w},z);else if(x)A=c("MessengerRealtimeAttachmentTransformer.bs").transform(j,{blob_attachments:[x]},z);else A=c("MessengerRealtimeAttachmentTransformer.bs").transform(j,{sticker:y});return A.length>0?A[0]:null});var q=!c("FBIDCheck").isUser_deprecated(j);p=p.filter(Boolean);var r=k.messageMetadata.tags?k.messageMetadata.tags[0]:undefined,s=null;if(k.data&&k.data.adminSignatureCreatorID){var t=k.data;s={creatorID:t.adminSignatureCreatorID||null,creatorName:t.adminSignatureCreatorName||null,creatorType:t.adminSignatureCreatorType||null,labelType:t.adminSignatureLabelType||null,pageID:t.adminSignaturePageID||null,profileURI:t.adminSignatureProfileURI||null}}return{message_id:k.messageMetadata.messageId,threading_id:null,offline_threading_id:k.messageMetadata.offlineThreadingId,author:c("MercuryIDs").getParticipantIDFromUserID(k.messageMetadata.actorFbId),author_email:k.messageMetadata.actorFbId+"@facebook.com",ephemeral_ttl_mode:k.ttl?c("IrisProtocolMessageLifetime")[k.ttl]:0,timestamp:l,is_unread:o,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,source:r,tags:k.messageMetadata.tags,is_spoof_warning:false,folder:c("MessagingTag").INBOX,thread_fbid:k.messageMetadata.threadKey.threadFbId,other_user_fbid:k.messageMetadata.threadKey.otherUserFbId,body:k.body!==undefined?k.body:"",html_body:null,subject:null,has_attachment:p.length>0,attachments:p,ranges:undefined,thread_id:null,action_type:c("MercuryActionType").USER_GENERATED_MESSAGE,is_from_iris:true,is_sponsored:!!(k.data&&k.data.is_sponsored&&k.data.is_sponsored==="true")||!!(k.untypedData&&k.untypedData.is_sponsored&&k.untypedData.is_sponsored==="true"),commerce_message_type:k.data?k.data.commerce_message_type:null,customizations:k.data&&k.data.customization?c("MercuryMessageCustomizations").parseCustomizations(k.data.customization):null,platform_xmd:k.data&&k.data.platform_xmd?k.data.platform_xmd:null,profile_ranges:c("MercuryProfileRanges").extractFromDelta(k),message_source:k.data&&k.data.message_source_data?h(k.data.message_source_data).message_source:null,skip_bump_thread:n,montage_reply_data:k.data&&k.data.montage_reply_data?h(k.data.montage_reply_data):null,meta_ranges:k.data&&k.data.meta_ranges?h(k.data.meta_ranges):null,creator_info:s,comm_status:q?c("PageCommItemStatus").TODO:null}}f.exports={transform:i}}),null);
__d("MercurySyncAdminTextMessageTransformer",["MercuryActionType","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){var k=c("MercurySyncNewMessageTransformer").transform(i,j);k.action_type=c("MercuryActionType").LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={message_type:j.type,untypedData:j.untypedData};k.log_message_type=c("MercuryLogMessageType").GENERIC_ADMIN_TEXT;return k}f.exports={transform:h}}),null);
__d("LiveLocationStopReason",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({EXPIRED:1,CANCELED:2,ARRIVED:3})}),null);
__d("MercurySyncClientPayloadTransformer",["DateConsts","LiveLocationStopReason","MercuryActionType","MercuryIDs","MessageLiveLocationClientSyncProtocolStopReason","PageCommItemStatus","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")(c("LiveLocationStopReason")),i=8;function j(r){__p&&__p();var s=r.payload;s=JSON.parse(String.fromCharCode.apply(null,s));var t=s&&s.deltas,u=t[0];if(u.deltaMessageReaction)return m(u.deltaMessageReaction);else if(u.liveLocationData)return o(u.liveLocationData);else if(u.deltaUpdateGroupEventRSVPStatus){var v=u.deltaUpdateGroupEventRSVPStatus;return n(v)}else if(u.deltaPageThreadFollowUpData)return q(u.deltaPageThreadFollowUpData);else if(u.deltaChangeViewerStatus)return k(u.deltaChangeViewerStatus);else if(u.deltaMontageDirectExpire)return l(u.deltaMontageDirectExpire);else return p(u)}function k(r){var s=r.actorFbid,t=r.canViewerReply,u=r.reason,v=r.threadKey,w=c("MercuryIDs").getParticipantIDFromUserID(v.otherUserFbId);return{action_type:c("MercuryActionType").BLOCK_STATUS_CHANGED,actorFbid:s,canViewerReply:t,reason:u,message_blocked_ids:[w],other_user_fbid:v.otherUserFbId.toString()}}function l(r){var s=r.threadKey.threadFbId||r.threadKey.otherUserFbId;return{action_type:c("MercuryActionType").MONTAGE_DIRECT_EXPIRE,messageId:r.messageId,timestamp:r.timestamp,thread_fbid:s.toString(),keep_expiry_timestamp:r.keepExpiryTimestamp}}function m(r){var s=r.messageId,t=r.offlineThreadingId,u=r.reaction,v=r.senderId,w=r.userId,x=r.threadKey.threadFbId||r.threadKey.otherUserFbId;return{action_type:c("MercuryActionType").REACTION_UPDATE,messageId:s,offlineThreadingId:t,reaction:u,senderId:v,thread_fbid:x.toString(),userId:w}}function n(r){var s=r.threadKey&&r.threadKey.threadFbId;if(!s)return null;var t=r.actorFbId,u=r.rsvpStatus;if(!t)return null;return{action_type:c("MercuryActionType").EVENT_RSVP_CHANGED,thread_fbid:s.toString(),actor_fbid:t.toString(),rsvp_status:u}}function o(r){__p&&__p();var s=r.threadKey;if(!s)return null;var t=s.threadFbId||s.otherUserFbId;if(!t)return null;if(!r.messageLiveLocations||r.messageLiveLocations.length!==1)return null;var u=r.messageLiveLocations[0],v=u.expirationTime,w=u.stopReason!=null||Date.now()/c("DateConsts").MS_PER_SEC>v,x=function x(B){return B/Math.pow(10,i)},y=u.coordinate?{latitude:x(u.coordinate.latitude),longitude:x(u.coordinate.longitude)}:null,z=null;if(u.destination)z={latitude:x(u.destination.latitude),longitude:x(u.destination.longitude),label:u.destination.label};var A=null;switch(u.stopReason){case c("MessageLiveLocationClientSyncProtocolStopReason").EXPIRED:A=h.EXPIRED;break;case c("MessageLiveLocationClientSyncProtocolStopReason").CANCELED:A=h.CANCELED;break;case c("MessageLiveLocationClientSyncProtocolStopReason").ARRIVED:A=h.ARRIVED;break}return{action_type:c("MercuryActionType").LIVE_LOCATION_UPDATE,thread_fbid:t.toString(),messageId:u.messageId,liveLocation:{live_location_id:u.id.toString(),is_expired:w,expiration_time:v,sender:{id:u.senderId.toString()},coordinate:y,location_title:u.locationTitle,sender_destination:z,stop_reason:A}}}function p(r){var s=r&&r.deltaPaymentPinProtectionStatusData,t=s&&s.threadKey&&s.threadKey.otherUserFbId,u=s&&s.isPinProtected;if(!t)return null;var v=t.toString();return{action_type:c("MercuryActionType").IS_PIN_PROTECTED,thread_fbid:v,is_pin_protected:u}}function q(r){var s=r.threadKey.otherUserFbId;return{action_type:c("MercuryActionType").UPDATE_COMM_STATUS,comm_status:r.isFollowUp?c("PageCommItemStatus").FOLLOW_UP:c("PageCommItemStatus").TODO,thread_fbid:s.toString()}}f.exports={transform:j}}),null);
__d("MercurySyncDeliveryReceiptTransformer",[],(function a(b,c,d,e,f,g){"use strict";function h(i){return{delivery_receipts:[{other_user_fbid:i.threadKey.otherUserFbId?i.threadKey.otherUserFbId:"",thread_fbid:i.threadKey.threadFbId?i.threadKey.threadFbId:"",time:parseInt(i.deliveredWatermarkTimestampMs,10)}]}}f.exports={transform:h}}),null);
__d("MercurySyncMarkFolderChangeTransformer",["MercuryActionType","MessagingTag"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").CHANGE_FOLDER,other_user_fbid:i.threadKey.otherUserFbId,new_folder:c("MessagingTag").IRIS_MAPPING[i.folder]}}f.exports={transform:h}}),null);
__d("MercurySyncMarkFolderSeenTransformer",["MercuryGlobalActionType","MessagingTag"],(function a(b,c,d,e,f,g){"use strict";function h(i){return i.folders.map(function(j){return{action_type:c("MercuryGlobalActionType").MARK_ALL_SEEN,folder:c("MessagingTag").IRIS_MAPPING[j],timestamp:parseInt(i.timestamp,10)}})}f.exports={transform:h}}),null);
__d("MercurySyncMarkReadTransformer",["MercuryActionType","MercuryGlobalActionType","MessagingTag"],(function a(b,c,d,e,f,g){"use strict";function h(i){if(i.folders&&i.folders.length>0)return i.folders.map(function(j){return{action_type:c("MercuryGlobalActionType").MARK_ALL_READ,action_id:null,folder:c("MessagingTag").IRIS_MAPPING[j],timestamp:parseInt(i.watermarkTimestamp,10)}});return i.threadKeys.map(function(j){return{action_type:c("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:true,timestamp:parseInt(i.watermarkTimestamp,10),folder:c("MessagingTag").INBOX}})}f.exports={transform:h}}),null);
__d("MercurySyncMarkUnreadTransformer",["MercuryActionType","MessagingTag"],(function a(b,c,d,e,f,g){"use strict";function h(i){return i.threadKeys.map(function(j){return{action_type:c("MercuryActionType").CHANGE_READ_STATUS,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId,mark_as_read:false,timestamp:parseInt(i.watermarkTimestamp,10),folder:c("MessagingTag").INBOX}})}f.exports={transform:h}}),null);
__d("MercurySyncMessageDeleteTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").DELETE_MESSAGES,message_ids:i.messageIds,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId}}f.exports={transform:h}}),null);
__d("PagesMessagingEventType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FLAG:1,CREATE_ADMIN_NOTE:2,PRIORITY_UPDATE:3})}),null);
__d("MercurySyncPagesManagerEventTransformer",["MercuryActionType","PagesMessagingEventType"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){var j=JSON.parse(i.jsonBlob),k=j&&j.type;if(!k)return undefined;switch(k){case c("PagesMessagingEventType").FLAG:var l=!!(j&&j.flagData&&j.flagData.state),m={action_type:c("MercuryActionType").CHANGE_FLAG,mark_as_flag:l,other_user_fbid:i.threadKey.otherUserFbId,thread_fbid:i.threadKey.threadFbId};return m;default:return undefined}}f.exports={transform:h}}),null);
__d("MercurySyncParticipantLeftGroupThreadTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){var k=c("MercurySyncNewMessageTransformer").transform(i,j);k.action_type=c("MercuryActionType").LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={removed_participants:[c("MercuryIDs").getParticipantIDFromUserID(j.leftParticipantFbId)]};k.log_message_type=c("MercuryLogMessageType").UNSUBSCRIBE;return k}f.exports={transform:h}}),null);
__d("MercurySyncParticipantsAddedToGroupThreadTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){var k=c("MercurySyncNewMessageTransformer").transform(i,j);k.action_type=c("MercuryActionType").LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={added_participants:j.addedParticipants.map(function(l){return c("MercuryIDs").getParticipantIDFromUserID(l.userFbId)})};k.log_message_type=c("MercuryLogMessageType").SUBSCRIBE;return k}f.exports={transform:h}}),null);
__d("MercurySyncRTCEventLogTransformer",["MercuryActionType","MercuryIDs","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){var k=c("MercurySyncNewMessageTransformer").transform(i,j),l=j.messageMetadata.actorFbId,m=l===i?j.messageMetadata.threadKey.otherUserFbId:i,n=j.eventType==="VOICE_EVENT"?c("MercuryLogMessageType").PHONE_CALL:c("MercuryLogMessageType").VIDEO_CALL;k.action_type=c("MercuryActionType").LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={answered:j.duration>0,callee:c("MercuryIDs").getParticipantIDFromUserID(m),caller:c("MercuryIDs").getParticipantIDFromUserID(l)};k.log_message_type=n;return k}f.exports={transform:h}}),null);
__d("MercurySyncReadReceiptTransformer",[],(function a(b,c,d,e,f,g){"use strict";function h(i){var j={watermark:parseInt(i.watermarkTimestampMs,10),action:parseInt(i.actionTimestampMs,10)},k=i.threadKey.otherUserFbId||i.actorFbId,l=i.threadKey.otherUserFbId||i.threadKey.threadFbId,m={roger:{}};m.roger[l]={};m.roger[l][k]=j;return m}f.exports={transform:h}}),null);
__d("MercurySyncReplaceMessageTransformer",["MercuryActionType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){j=Object.assign({},j.newMessage,j);return Object.assign(c("MercurySyncNewMessageTransformer").transform(i,j),{action_type:c("MercuryActionType").REPLACE_MESSAGE,replaced_message_id:j.replacedMessageId})}f.exports={transform:h}}),null);
__d("MercurySyncRtcCallDataTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j=i.messageMetadata.threadKey&&i.messageMetadata.threadKey.threadFbId?i.messageMetadata.threadKey.threadFbId.toString():undefined,k=i.initiator&&i.initiator.userFbId?i.initiator.userFbId.toString():undefined;return{action_type:c("MercuryActionType").UPDATE_RTC_CALL_DATA,thread_fbid:j,call_state:i.callState,server_info_data:i.serverInfoData,initiator_fbid:k}}f.exports={transform:h}}),null);
__d("MessagingThreadAction",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ACTION_INVALID:"ACTION_INVALID",ACTION_ARCHIVED:"ACTION_ARCHIVED",ACTION_UNARCHIVED:"ACTION_UNARCHIVED"})}),null);
__d("MercurySyncThreadActionTransformer",["MercuryActionType","MessagingThreadAction"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j={action_type:c("MercuryActionType").CHANGE_ARCHIVED_STATUS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,archived:i.action===c("MessagingThreadAction").ACTION_ARCHIVED};return j}f.exports={transform:h}}),null);
__d("MercurySyncThreadAdminsAddToGroupTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").ADD_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,added_admin_ids:i.addedAdmins.map(function(j){return j.userFbId})}}f.exports={transform:h}}),null);
__d("MercurySyncThreadAdminsRemovedFromGroupTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").REMOVE_GROUP_ADMINS,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_admin_ids:i.removedAdminFbIds}}f.exports={transform:h}}),null);
__d("MercurySyncThreadApprovalModeTransformer",["MercuryActionType","MessengerApprovalModeTypes"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").APPROVAL_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,approval_mode:c("MessengerApprovalModeTypes")[i.mode]}}f.exports={transform:h}}),null);
__d("MessengerApprovalQueueTypes",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({REQUESTED:"REQUESTED",REMOVED:"REMOVED"})}),null);
__d("MercurySyncThreadApprovalQueueTransformer",["MercuryActionType","MercuryIDs","MessengerApprovalQueueTypes"],(function a(b,c,d,e,f,g){"use strict";function h(i){if(i.inviterFbId)return{action_type:c("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_group_id:i.action===c("MessengerApprovalQueueTypes").REMOVED?i.recipientFbId:null,added_group_id:i.action===c("MessengerApprovalQueueTypes").REQUESTED?{requester:{id:i.recipientFbId},inviter:{id:i.inviterFbId}}:null};var j=c("MercuryIDs").getParticipantIDFromUserID(i.recipientFbId);return{action_type:c("MercuryActionType").APPROVAL_QUEUE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,removed_id:i.action===c("MessengerApprovalQueueTypes").REMOVED?j:null,added_id:i.action===c("MessengerApprovalQueueTypes").REQUESTED?j:null}}f.exports={transform:h}}),null);
__d("MercurySyncThreadDeleteTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){return i.threadKeys.map(function(j){return{action_type:c("MercuryActionType").DELETE_THREAD,other_user_fbid:j.otherUserFbId,thread_fbid:j.threadFbId}})}f.exports={transform:h}}),null);
__d("MercurySyncThreadJoinableModeTransformer",["MercuryActionType","MessengerJoinableModeType"],(function a(b,c,d,e,f,g){"use strict";function h(i){return{action_type:c("MercuryActionType").JOINABLE_MODE,action_id:null,thread_fbid:i.messageMetadata.threadKey.threadFbId,joinable_mode:{mode:c("MessengerJoinableModeType")[i.mode],link:i.link}}}f.exports={transform:h}}),null);
__d("MercurySyncThreadMuteSettingsTransformer",["MercuryActionType"],(function a(b,c,d,e,f,g){"use strict";function h(i){var j={action_type:c("MercuryActionType").CHANGE_MUTE_SETTINGS,thread_fbid:i.threadKey.threadFbId,other_user_fbid:i.threadKey.otherUserFbId,mute_until:parseInt(i.expireTime,10)};return j}f.exports={transform:h}}),null);
__d("MercurySyncThreadNameTransformer",["MercuryActionType","MercuryLogMessageType","MercurySyncNewMessageTransformer"],(function a(b,c,d,e,f,g){"use strict";function h(i,j){var k=c("MercurySyncNewMessageTransformer").transform(i,j);k.action_type=c("MercuryActionType").LOG_MESSAGE;k.log_message_body=j.messageMetadata.adminText;k.log_message_data={name:j.name};k.log_message_type=c("MercuryLogMessageType").THREAD_NAME;return k}f.exports={transform:h}}),null);
__d("MercurySyncDispatcher",["MercuryDelayedDispatcher","MercuryGlobalActionType","MercuryPayloadSource","MercuryServerPayloadPreprocessor","MercurySyncThreadAdminsAddToGroupTransformer","MercurySyncThreadAdminsRemovedFromGroupTransformer","MercurySyncAdminTextMessageTransformer","MercurySyncClientPayloadTransformer","MercurySyncDeliveryReceiptTransformer","MercurySyncMarkFolderSeenTransformer","MercurySyncMarkReadTransformer","MercurySyncMarkUnreadTransformer","MercurySyncMessageDeleteTransformer","MercurySyncNewMessageTransformer","MercurySyncReadReceiptTransformer","MercurySyncPagesManagerEventTransformer","MercurySyncParticipantLeftGroupThreadTransformer","MercurySyncParticipantsAddedToGroupThreadTransformer","MercurySyncRTCEventLogTransformer","MercurySyncThreadDeleteTransformer","MercurySyncMarkFolderChangeTransformer","MercurySyncThreadMuteSettingsTransformer","MercurySyncThreadNameTransformer","MercurySyncThreadActionTransformer","MercurySyncReplaceMessageTransformer","MercurySyncThreadJoinableModeTransformer","MercurySyncThreadApprovalModeTransformer","MercurySyncThreadApprovalQueueTransformer","MercurySyncRtcCallDataTransformer","MercurySyncDeltaTypes","MercurySingletonProvider","MontageActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="FOLDER_MONTAGE";i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};function i(k){this.$MercurySyncDispatcher1=k;this.$MercurySyncDispatcher2=c("MercuryDelayedDispatcher").getForFBID(this.$MercurySyncDispatcher1);this.$MercurySyncDispatcher3=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercurySyncDispatcher1)}i.prototype.process=function(k){__p&&__p();var l=void 0,m=void 0;switch(k["class"]){case c("MercurySyncDeltaTypes").NewMessage:l=c("MercurySyncNewMessageTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ReplaceMessage:l=c("MercurySyncReplaceMessageTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").DeliveryReceipt:l=c("MercurySyncDeliveryReceiptTransformer").transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c("MercurySyncDeltaTypes").MarkRead:l=c("MercurySyncMarkReadTransformer").transform(k);var n=[],o=[];l.forEach(function(p){if(p.action_type===c("MercuryGlobalActionType").MARK_ALL_READ)n.push(p);else o.push(p)});n.length&&this.$MercurySyncDispatcher5(n);o.length&&this.$MercurySyncDispatcher6(o);break;case c("MercurySyncDeltaTypes").MarkUnread:l=c("MercurySyncMarkUnreadTransformer").transform(k);this.$MercurySyncDispatcher6(l);break;case c("MercurySyncDeltaTypes").ParticipantLeftGroupThread:l=c("MercurySyncParticipantLeftGroupThreadTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ParticipantsAddedToGroupThread:l=c("MercurySyncParticipantsAddedToGroupThreadTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").RTCEventLog:l=c("MercurySyncRTCEventLogTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ThreadName:l=c("MercurySyncThreadNameTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ReadReceipt:l=c("MercurySyncReadReceiptTransformer").transform(k);this.$MercurySyncDispatcher3.handleUpdate(l);break;case c("MercurySyncDeltaTypes").AdminTextMessage:l=c("MercurySyncAdminTextMessageTransformer").transform(this.$MercurySyncDispatcher1,k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").MessageDelete:m=k.threadKey.threadFbId;if(m&&k.folder&&k.folder===h)c("MontageActions").requestUpdate(m);else{l=c("MercurySyncMessageDeleteTransformer").transform(k);this.$MercurySyncDispatcher4(l)}break;case c("MercurySyncDeltaTypes").ThreadAction:l=c("MercurySyncThreadActionTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ThreadDelete:l=c("MercurySyncThreadDeleteTransformer").transform(k);this.$MercurySyncDispatcher6(l);break;case c("MercurySyncDeltaTypes").AdminAddedToGroupThread:l=c("MercurySyncThreadAdminsAddToGroupTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").AdminRemovedFromGroupThread:l=c("MercurySyncThreadAdminsRemovedFromGroupTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ThreadMuteSettings:l=c("MercurySyncThreadMuteSettingsTransformer").transform(k);this.$MercurySyncDispatcher6([l]);break;case c("MercurySyncDeltaTypes").PagesManagerEvent:l=c("MercurySyncPagesManagerEventTransformer").transform(k);if(!l)return;this.$MercurySyncDispatcher6([l]);break;case c("MercurySyncDeltaTypes").JoinableMode:l=c("MercurySyncThreadJoinableModeTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ApprovalMode:l=c("MercurySyncThreadApprovalModeTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ApprovalQueue:l=c("MercurySyncThreadApprovalQueueTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").ClientPayload:l=c("MercurySyncClientPayloadTransformer").transform(k);if(!l)return;this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").GenieMessage:l=c("MercurySyncNewMessageTransformer").transform(this.$MercurySyncDispatcher1,k.deltaNewMessage);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").MontageMessage:m=k.newMessage.messageMetadata.actorFbId;if(m)c("MontageActions").requestUpdate(m);break;case c("MercurySyncDeltaTypes").RtcCallData:l=c("MercurySyncRtcCallDataTransformer").transform(k);this.$MercurySyncDispatcher4(l);break;case c("MercurySyncDeltaTypes").MarkFolderSeen:l=c("MercurySyncMarkFolderSeenTransformer").transform(k);this.$MercurySyncDispatcher5(l);break;case c("MercurySyncDeltaTypes").ThreadFolder:l=c("MercurySyncMarkFolderChangeTransformer").transform(k);this.$MercurySyncDispatcher6([l]);break;default:break}};i.prototype.$MercurySyncDispatcher4=function(k){var l=k.other_user_fbid||k.thread_fbid;this.$MercurySyncDispatcher2.handleUpdateWaitForThread({actions:[k],payload_source:c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE},l)};i.prototype.$MercurySyncDispatcher5=function(k){this.$MercurySyncDispatcher3.handleUpdate({global_actions:k,payload_source:c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE})};i.prototype.$MercurySyncDispatcher6=function(k){this.$MercurySyncDispatcher3.handleUpdate({actions:k,payload_source:c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE})};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MercurySyncDataFetcherImpl",["errorCode","Promise","AsyncResponse","Bootloader","FBIDCheck","MercuryPayloadSource","MercuryThreadlistConstants","MessagingConfig","UserActivity","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("MessagingConfig").syncFetchRequestTimeoutMs,j={limit:c("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1,folder:"inbox",tags:["INBOX"],timestamp:null,offset:c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,filter:null,includeDeliveryReceipts:false,includeSeqID:true},k={};function l(r){return new(c("Promise"))(function(s,t){m(r,s,t,0)})}function m(r,s,t,u){__p&&__p();if(u>c("MessagingConfig").syncFetchRetries){clearTimeout(k[r]);t();return}var v=u===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,u);if(!c("UserActivity").isOnTab())v+=500*Math.random();clearTimeout(k[r]);k[r]=c("setTimeoutAcrossTransitions")(function(){__p&&__p();var w=false,x=function x(y){__p&&__p();var z;if(w)return;if(y.errors&&y.errors.length>0)(function(){var A=y.errors[0].message;if(A)c("Bootloader").loadModules(["MessengerWebGraphQLTypedLogger","MessengerWebGraphQLEvent"],function(B,C){new B().setErrorMessage(A).setEvent(C.DFF_FAILURE).log()},"MercurySyncDataFetcherImpl")})();w=true;m(r,s,t,u+1)};c("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs"],function(y){return y.fetchAll(r,[j],!c("FBIDCheck").isUser_deprecated(r)).then(function(z){w=true;s(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},z,{payload_source:c("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE})));clearTimeout(k[r])},x)},"MercurySyncDataFetcherImpl")},v)}function n(r,s,t){return new(c("Promise"))(function(u,v){o(r,s,t,u,v,0)})}function o(r,s,t,u,v,w){__p&&__p();if(w>c("MessagingConfig").syncFetchRetries){v();return}var x=w===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,w);c("setTimeoutAcrossTransitions")(function(){var y=false,z=function z(A){if(y)return;y=true;o(r,s,t,u,v,w+1)};c("Bootloader").loadModules(["MessengerThreadDFFFetcher.bs"],function(A){return A.fetch(r,{id:s,limit:t},!c("FBIDCheck").isUser_deprecated(r)).then(function(B){y=true;u(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},B,{payload_source:c("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE})))},z)},"MercurySyncDataFetcherImpl")},x)}function p(r,s,t){return new(c("Promise"))(function(u,v){q(r,s,t,u,v,0)})}function q(r,s,t,u,v,w){__p&&__p();if(w>c("MessagingConfig").syncFetchRetries){v();return}var x=w===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,w);c("setTimeoutAcrossTransitions")(function(){var y=false,z=function z(A){if(y)return;y=true;q(r,s,t,u,v,w+1)};c("Bootloader").loadModules(["MessengerMessageDFFFetcher.bs"],function(A){return A.fetch(r,{thread_id:s,message_id:t},!c("FBIDCheck").isUser_deprecated(r)).then(function(B){y=true;u(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},B)))},z)},"MercurySyncDataFetcherImpl")},x)}f.exports={fetchThreadlistFromGraphQL:l,fetchThreadFromGraphQL:n,fetchMessageFromGraphQL:p}}),null);
__d("MercurySyncDataFetcher",["Promise","LogHistory","MessagingConfig","MercurySyncDataFetcherImpl","WebGraphQLConfig","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("LogHistory").getInstance("mercury_sync_data_fetcher");function i(){var n=0;for(var o=0;o<c("MessagingConfig").syncFetchRetries;o++){var p=o===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,o);n+=p+c("MessagingConfig").syncFetchRequestTimeoutMs}return n}var j=i();function k(n){__p&&__p();var o=null;return new(c("Promise"))(function(p,q){var r=function r(s){h.error("fetch_threadlist_graphql_timeout",JSON.stringify({timeout:j}));clearTimeout(o);q(s)};o=c("setTimeoutAcrossTransitions")(r,Math.max(j,c("WebGraphQLConfig").timeout*c("MessagingConfig").syncFetchRetries));c("MercurySyncDataFetcherImpl").fetchThreadlistFromGraphQL(n).done(function(s){clearTimeout(o);p(s)},r)})}function l(n,o,p){return new(c("Promise"))(function(q,r){var s=function s(u){h.error("fetch_thread_graphql_timeout",JSON.stringify({timeout:j}));r(u)},t=c("setTimeoutAcrossTransitions")(s,j);c("MercurySyncDataFetcherImpl").fetchThreadFromGraphQL(n,o,p).done(function(u){clearTimeout(t);q(u)},s)})}function m(n,o,p){return new(c("Promise"))(function(q,r){var s=function s(u){h.error("fetch_message_graphql_timeout",JSON.stringify({timeout:j}));r(u)},t=c("setTimeoutAcrossTransitions")(s,j);c("MercurySyncDataFetcherImpl").fetchMessageFromGraphQL(n,o,p).done(function(u){clearTimeout(t);q(u)},s)})}f.exports={fetchThreadlistFromGraphQL:k,fetchThreadFromGraphQL:l,fetchMessageFromGraphQL:m,getMaxTimeoutMs:i}}),null);
__d("MercurySyncDFFDataFetcher",["Promise","CurrentUser","MercuryMessages","MercuryThreads","MercuryThreadIDMap","MercurySingletonProvider","MercurySyncDataFetcher"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.$MercurySyncDFFDataFetcher1=j;this.__messages=c("MercuryMessages").getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threads=c("MercuryThreads").getForFBID(this.$MercurySyncDFFDataFetcher1);this.__threadIDMap=c("MercuryThreadIDMap").getForFBID(this.$MercurySyncDFFDataFetcher1)}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.fetchInvalidateGlobalStateForGraphQL=function(){if(this.$MercurySyncDFFDataFetcher1&&this.$MercurySyncDFFDataFetcher1!=="0"&&c("CurrentUser").isLoggedIn())return c("MercurySyncDataFetcher").fetchThreadlistFromGraphQL(this.$MercurySyncDFFDataFetcher1);return new(c("Promise"))(function(j,k){return k(true)})};h.prototype.fetchInvalidateThreadState=function(j,k){var l=11,m=3,n=j||k,o=this.__threadIDMap.getClientIDFromServerIDNow(n);if(!o)return c("Promise").resolve({getPayload:function q(){return{}}});var p=m+this.__messages.getCurrentlyLoadedMessages(o).length;if(!n)return c("Promise").resolve({getPayload:function q(){return{}}});return c("MercurySyncDataFetcher").fetchThreadFromGraphQL(this.$MercurySyncDFFDataFetcher1,n,Math.max(p,l))};h.prototype.fetchInvalidateMessage=function(j,k,l){var m=j||k;if(!m)return c("Promise").resolve({getPayload:function n(){return{}}});return c("MercurySyncDataFetcher").fetchMessageFromGraphQL(this.$MercurySyncDFFDataFetcher1,m,l)};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercurySyncForcedFetchHandler",["Promise","MercurySingletonProvider","MercurySyncDFFDataFetcher","MercuryMessages","MercuryThreadIDMap"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(k){return{getPayload:function l(){return{sequence_id:k}}}}i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};function i(k){this.$MercurySyncForcedFetchHandler1=k;this.$MercurySyncForcedFetchHandler2=c("MercuryMessages").getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler3=c("MercuryThreadIDMap").getForFBID(this.$MercurySyncForcedFetchHandler1);this.$MercurySyncForcedFetchHandler4=c("MercurySyncDFFDataFetcher").getForFBID(this.$MercurySyncForcedFetchHandler1)}i.prototype.processMessageDFF=function(k,l,m,n){if(n){var o=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),p=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(o);if(p===undefined)return c("Promise").resolve(h(k));var q=this.$MercurySyncForcedFetchHandler2.getMessagesFromIDs([m]);if(q.length===0)return c("Promise").resolve(h(k))}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateMessage(l.otherUserFbId,l.threadFbId,m)};i.prototype.processThreadDFF=function(k,l,m){if(m){var n=l.otherUserFbId!==undefined?l.otherUserFbId.toString():l.threadFbId.toString(),o=this.$MercurySyncForcedFetchHandler3.getClientIDFromServerIDNow(n);if(o===undefined)return c("Promise").resolve(h(k))}return this.$MercurySyncForcedFetchHandler4.fetchInvalidateThreadState(l.otherUserFbId,l.threadFbId)};i.prototype.processGlobalDFFForGraphQL=function(){return this.$MercurySyncForcedFetchHandler4.fetchInvalidateGlobalStateForGraphQL()};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MercurySyncTopicType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DELTA:"delta",DELTAFLOW:"deltaflow",DELTAFLOWREJECT:"deltaflowreject"})}),null);
__d("MercurySyncDeltaHandler",["invariant","Arbiter","AsyncResponse","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","FBIDCheck","LogHistory","MercuryConfig","MessagingConfig","MercuryDelayedDispatcher","MercuryPayloadSource","MercurySyncChannelMonitor","MercurySyncConstants","MercurySyncDeltaHolder","MercurySyncDeltaTypes","MercurySyncDispatcher","MercurySyncForcedFetchHandler","MercurySyncHolesTypedLogger","MercuryServerPayloadPreprocessor","MercurySyncTopicType","MercurySingletonProvider","gkx"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("LogHistory").getInstance("mercury_sync_delta_handler"),j=c("MessagingConfig").syncFetchRetries||0;k.getForFBID=function(m){return l.getForFBID(m)};k.get=function(){return l.get()};function k(m){__p&&__p();this.$MercurySyncDeltaHandler1=m;this.$MercurySyncDeltaHandler2=c("MercurySyncDispatcher").getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler3=c("MercurySyncForcedFetchHandler").getForFBID(this.$MercurySyncDeltaHandler1);this.__payloadPreprocessor=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercurySyncDeltaHandler1);this.__delayedDispatcher=c("MercuryDelayedDispatcher").getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler4=c("MercurySyncDeltaHolder").getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler11=c("MercurySyncChannelMonitor").getForFBID(this.$MercurySyncDeltaHandler1);this.$MercurySyncDeltaHandler6=[];this.$MercurySyncDeltaHandler13=0;i.debug("constructor",JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));c("Arbiter").subscribe("MercurySyncDeltaHandler/initSeqID",function(n,o){__p&&__p();i.debug("initSeqID",JSON.stringify(o));var p=o&&o.seqID,m=o&&o.fbid;if(!m)return;if(m!==this.$MercurySyncDeltaHandler1)return;if(p)this.$MercurySyncDeltaHandler4.updateLastSeqID(p);else this.$MercurySyncDeltaHandler4.updateLastSeqID(0);this.$MercurySyncDeltaHandler15();this.$MercurySyncDeltaHandler8=c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("deltaflow"),function(n,o){if(!this.$MercurySyncDeltaHandler14)this.$MercurySyncDeltaHandler15()}.bind(this))}.bind(this))}k.prototype.$MercurySyncDeltaHandler15=function(){__p&&__p();i.debug("setUpSubscriptionsToRealTimeUpdates",JSON.stringify({fbid:this.$MercurySyncDeltaHandler1}));this.$MercurySyncDeltaHandler7=c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("delta"),function(m,n){__p&&__p();var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta,q=n&&n.obj&&n.obj.iseq;if(!p||!q)return;this.$MercurySyncDeltaHandler16(q,c("MercurySyncTopicType").DELTA);this.$MercurySyncDeltaHandler17(q,p);this.$MercurySyncDeltaHandler4.push(q,p);this.$MercurySyncDeltaHandler18()}.bind(this));this.$MercurySyncDeltaHandler12=c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("deltaflowreject"),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o)if(o.toString()!==this.$MercurySyncDeltaHandler1)return;if(this.$MercurySyncDeltaHandler14)this.$MercurySyncDeltaHandler19()}.bind(this));this.$MercurySyncDeltaHandler9=c("Arbiter").subscribe(c("ChannelConstants").getArbiterType(c("ChannelConstants").FAKE_DFF),function(m,n){var o=n&&n.obj&&n.obj.queue;if(o&&o.toString()!==this.$MercurySyncDeltaHandler1)return;var p=n&&n.obj&&n.obj.delta;if(!p)return;this.$MercurySyncDeltaHandler6.push(p);this.$MercurySyncDeltaHandler18()}.bind(this));this.$MercurySyncDeltaHandler11.setupSubscriptions();this.$MercurySyncDeltaHandler14=true};k.prototype.$MercurySyncDeltaHandler18=function(){__p&&__p();if(this.$MercurySyncDeltaHandler5)return;if(this.$MercurySyncDeltaHandler6.length>0){var m=this.$MercurySyncDeltaHandler6.shift();this.$MercurySyncDeltaHandler20(this.$MercurySyncDeltaHandler4.getLastSeqID(),m);this.$MercurySyncDeltaHandler18()}var n=this.$MercurySyncDeltaHandler4.peek();if(!n)return;var o=n-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o===1){var p=this.$MercurySyncDeltaHandler4.pop();if(!p)return;var q=p.seqID,r=p.delta;this.$MercurySyncDeltaHandler20(q,r);this.$MercurySyncDeltaHandler18()}else if(o>1)this.$MercurySyncDeltaHandler21();else{this.$MercurySyncDeltaHandler4.pop();this.$MercurySyncDeltaHandler18()}};k.prototype.$MercurySyncDeltaHandler20=function(m,n){__p&&__p();this.$MercurySyncDeltaHandler4.updateLastSeqID(m);if(n["class"]===c("MercurySyncDeltaTypes").ForcedFetch){i.debug("DFF",JSON.stringify(n));if(n.threadKey!==undefined&&n.messageId===undefined)this.$MercurySyncDeltaHandler22(m,n);else if(n.threadKey!==undefined&&n.messageId!==undefined)this.$MercurySyncDeltaHandler23(m,n);else{c("ChatReliabilityInstrumentation").logDFF_DELTA_INIT(JSON.stringify(n));this.$MercurySyncDeltaHandler24(m)}}else this.$MercurySyncDeltaHandler2.process(n)};k.prototype.$MercurySyncDeltaHandler21=function(){var m=JSON.stringify({$MercurySyncDeltaHandler25:this.$MercurySyncDeltaHandler4.getLastSeqID(),nextSeqID:this.$MercurySyncDeltaHandler4.peek()});i.warn("hole",m);var n=this.$MercurySyncDeltaHandler4.peek();!!n||h(0);var o=n-1;c("ChatReliabilityInstrumentation").logDFF_HOLE_INIT(m);this.$MercurySyncDeltaHandler24(o)};k.prototype.$MercurySyncDeltaHandler26=function(m,n,o,p){__p&&__p();!this.$MercurySyncDeltaHandler5||h(0);this.$MercurySyncDeltaHandler5=true;i.debug("_scheduleDataFetch:start",JSON.stringify({seqID:m}));n().done(function(q){i.debug("_scheduleDataFetch:success",JSON.stringify({seqID:m}));o(m,q);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler18()}.bind(this),function(q){i.error("_scheduleDataFetch:failure",JSON.stringify({seqID:m}));p(m,q);this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler18()}.bind(this))};k.prototype.$MercurySyncDeltaHandler24=function(m){__p&&__p();if(!c("CurrentUser").isLoggedInNow())return;this.$MercurySyncDeltaHandler26(undefined,function(){return this.$MercurySyncDeltaHandler3.processGlobalDFFForGraphQL()}.bind(this),function(m,n){var o=n.getPayload();this.__payloadPreprocessor.handleUpdate(o);if(o.sequence_id){i.debug("_initiateGlobalDFF:success",JSON.stringify({seqID:o.sequence_id}));this.$MercurySyncDeltaHandler4.updateLastSeqID(o.sequence_id)}this.$MercurySyncDeltaHandler13=0;c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RECOVER)}.bind(this),function(n,o){__p&&__p();i.error("_initiateGlobalDFF:failure","");if(this.$MercurySyncDeltaHandler13>=j&&!c("gkx")("AT6272W7G37c2zZOpPDUPGXaehXUPvo7_ZqAqdSAoKzgP5DQ8Luz0w5hQkLZeaPa8UmuuAXTSUI8FctXnbHnbKTw")||o){if(this.$MercurySyncDeltaHandler14)this.$MercurySyncDeltaHandler19();if(c("gkx")("AT6T2zrYpHKRdiC2jWw79jSLuG2Ai8UAXBl4mf7UaSrzuZmkv1aboo5IByEaBzwrmKZ7i_TneQib5Fe9fVTNdQMv"))this.$MercurySyncDeltaHandler4.updateLastSeqID(m)}else{this.$MercurySyncDeltaHandler13++;c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE_RETRY);i.debug("_initiateGlobalDFF:retry","");this.$MercurySyncDeltaHandler5=false;this.$MercurySyncDeltaHandler24(m)}}.bind(this))};k.prototype.$MercurySyncDeltaHandler22=function(m,n){this.$MercurySyncDeltaHandler26(m,function(){return this.$MercurySyncDeltaHandler3.processThreadDFF(m,n.threadKey,n.isLazy)}.bind(this),function(m,o){this.__payloadPreprocessor.handleUpdate(o.getPayload());this.$MercurySyncDeltaHandler4.updateLastSeqID(m)}.bind(this),function(){i.error("_initiateThreadDFF:failure",JSON.stringify(n));var o=babelHelpers["extends"]({},n);delete o.threadKey;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o)}.bind(this))};k.prototype.$MercurySyncDeltaHandler23=function(m,n){__p&&__p();this.$MercurySyncDeltaHandler26(m,function(){return this.$MercurySyncDeltaHandler3.processMessageDFF(m,n.threadKey,n.messageId,n.isLazy)}.bind(this),function(m,o){var p=o.getPayload(),q=p.other_user_fbid?p.other_user_fbid:p.thread_fbid,r=[babelHelpers["extends"]({},p)],s=c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE;this.__delayedDispatcher.handleUpdateWaitForThread({actions:r,payload_source:s},q);this.$MercurySyncDeltaHandler4.updateLastSeqID(m)}.bind(this),function(){i.error("_initiateMessageDFF:failure",JSON.stringify(n));var o=babelHelpers["extends"]({},n);delete o.messageId;this.$MercurySyncDeltaHandler4.updateLastSeqID(m-1);this.$MercurySyncDeltaHandler4.push(m,o)}.bind(this))};k.prototype.$MercurySyncDeltaHandler16=function(m,n){var o=m-this.$MercurySyncDeltaHandler4.getLastSeqID();if(o!==1&&o!==0){if(!c("MercuryConfig").WWWSyncHolesLogging)return;new(c("MercurySyncHolesTypedLogger"))().setSeqID(m).setDifference(o).setTopicType(n).log()}};k.prototype.$MercurySyncDeltaHandler17=function(m,n){switch(n["class"]){case c("MercurySyncDeltaTypes").NewMessage:i.debug("message_delta",JSON.stringify({seqID:m,threadKey:n.messageMetadata.threadKey,messageId:n.messageMetadata.messageId}));break;case c("MercurySyncDeltaTypes").ReadReceipt:i.debug("read_receipt_delta",JSON.stringify({seqID:m,threadKey:n.threadKey,actionTimestampMs:n.actionTimestampMs,watermarkTimestampMs:n.watermarkTimestampMs}));break;case c("MercurySyncDeltaTypes").DeliveryReceipt:i.debug("delivery_receipt_delta",JSON.stringify({seqID:m,deliveredWatermarkTimestampMs:n.deliveredWatermarkTimestampMs,messageIds:n.messageIds}));break}};k.prototype.$MercurySyncDeltaHandler19=function(){this.$MercurySyncDeltaHandler14=false;c("Arbiter").unsubscribe(this.$MercurySyncDeltaHandler7);c("Arbiter").unsubscribe(this.$MercurySyncDeltaHandler9);c("Arbiter").unsubscribe(this.$MercurySyncDeltaHandler12);this.$MercurySyncDeltaHandler11.killSubscriptions();c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_INVALID_STATE)};var l=new(c("MercurySingletonProvider"))(k);f.exports=k}),null);
__d("MercurySyncEnvironment",["Arbiter","ChannelInitialData","CurrentUser","MercurySyncDeltaHandler"],(function a(b,c,d,e,f,g){"use strict";function h(){if(!c("ChannelInitialData").channelConfig)return;c("MercurySyncDeltaHandler").get();c("Arbiter").inform("MercurySyncDeltaHandler/initSeqID",{fbid:c("CurrentUser").getAccountID(),seqID:c("ChannelInitialData").channelConfig.sequenceId})}f.exports={setUp:h}}),null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionType","MercuryDispatcher","MercuryGlobalActionType","MercurySingletonProvider","MercuryThreadIDMap","MercuryThreadInfo","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","createObjectFrom","isEmpty"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("MercuryThreadlistConstants").MAX_UNSEEN_COUNT,i="unseen_thread_hash",j="unseen_thread_list",k=c("LogHistory").getInstance("mercury_unseen_state");l.getForFBID=function(n){return m.getForFBID(n)};l.get=function(){return m.get()};function l(n){__p&&__p();this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c("MercuryServerRequests").getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c("MercuryThreadIDMap").getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c("MercuryThreads").getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c("MercuryThreadInformer").getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c("MercuryDispatcher").getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new(c("KeyedCallbackManager"))();this.$MercuryUnseenState1.subscribe("update-unseen",function(o,p){this.$MercuryUnseenState12(p)}.bind(this));this.$MercuryUnseenState1.subscribe("update-thread-ids",function(o,p){this.$MercuryUnseenState13(p)}.bind(this))}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error("unguarded_unseen_count_fetch","{}");return 0}return this.$MercuryUnseenState14()};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null)this.$MercuryUnseenState6=true;else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[])}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o)};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n))};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs()};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i)};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n)return n.length;else return this.$MercuryUnseenState3};l.prototype.$MercuryUnseenState12=function(n){__p&&__p();var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids)n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c("MessagingTag").INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true}.bind(this));else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({})}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({})}}else{var o=function(){__p&&__p();var r;(n.global_actions||[]).forEach(function(x){if(x.action_type===c("MercuryGlobalActionType").MARK_ALL_SEEN)this.$MercuryUnseenState15(x.timestamp,[])}.bind(p));if(p.$MercuryUnseenState5)return{v:void 0};var s=n.actions;if(!s||!s.length)return{v:void 0};var t={},u={},v=function v(w){__p&&__p();var x=s[w],y=x.action_type,z=x.other_user_fbid?x.other_user_fbid:x.thread_fbid,A=x.thread_id?x.thread_id:z;if(y===c("MercuryActionType").MARK_THREAD_SEEN){p.$MercuryUnseenState16(A,x.persistent);return"continue"}if(!p.$MercuryUnseenState23(x))return"continue";if(y===c("MercuryActionType").USER_GENERATED_MESSAGE||y===c("MercuryActionType").LOG_MESSAGE){var B=t[A]?x.timestamp>t[A]:false,C=B||!t[A];if(x.is_unread&&C)p.$MercuryUnseenState10.getThreadMeta(A,function(D){if(!c("MercuryThreadInfo").isMuted(D)&&!(D&&D.last_read_timestamp>=x.timestamp))t[A]=x.timestamp})}else if(y===c("MercuryActionType").CHANGE_READ_STATUS&&x.mark_as_read)u[A]=x.timestamp};for(var w=0;w<s.length;w++){var r=v(w);if(r==="continue")continue}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u)}();if(typeof o==="object")return o.v}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen()}};l.prototype.$MercuryUnseenState15=function(n,o){__p&&__p();var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t}var u=Object.assign(c("createObjectFrom")(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState()}};l.prototype.$MercuryUnseenState24=function(n){__p&&__p();if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t]}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState()}.bind(this))};l.prototype.$MercuryUnseenState17=function(n,o){__p&&__p();if(!c("isEmpty")(n))this.$MercuryUnseenState19(function(p){__p&&__p();var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen()}}.bind(this))};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8)};l.prototype.$MercuryUnseenState13=function(n){__p&&__p();var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p]}}this.$MercuryUnseenState18(o)};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c("MercuryFolders").getFromMeta(o):n.folder;return p===c("MessagingTag").INBOX||p===undefined};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c("MessagingTag").INBOX)return o[p];return{}};var m=new(c("MercurySingletonProvider"))(l);f.exports=l}),null);
__d("P2PSendMoneyDialogStore",["P2PActionConstants","EventEmitter","Map","P2PDispatcher"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=36,k=void 0,l=void 0;h=babelHelpers.inherits(m,c("EventEmitter"));i=h&&h.prototype;function m(){i.constructor.call(this);l=new(c("Map"))();k=c("P2PDispatcher").register(this.onEventDispatched.bind(this))}m.prototype.onEventDispatched=function(n){var o=n.data,p=n.type;switch(p){case c("P2PActionConstants").CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(o);this.emit("change");break;case c("P2PActionConstants").CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(o);this.emit("change");break}};m.prototype.getStateByThreadID=function(n){return l.get(n)};m.prototype.handleChatSendViewOpened=function(n){l.set(n.threadID,{amount:n.amount,groupSendRecipientUserIDs:n.groupSendRecipientUserIDs,groupSendReceiptDetails:n.groupSendReceiptDetails,groupThreadFBID:n.groupThreadFBID,onCompletion:n.onCompletion,openRequestTab:n.openRequestTab,memoText:n.memoText&&n.memoText.substr(0,j),platformData:n.platformData,referrer:n.referrer,paymentRequestID:n.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:n.sendMoneyNUXDismissed,useModal:n.useModal})};m.prototype.handleChatSendViewClosed=function(n){l.set(n.threadID,{amount:"",groupSendRecipientUserIDs:[],groupSendReceiptDetails:null,groupThreadFBID:"",onCompletion:null,openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false})};m.prototype.isAnyChatSendViewOpen=function(){__p&&__p();for(var n=l.values(),o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{p=n.next();if(p.done)break;q=p.value}var r=q;if(r.sendMoneyDialogShown)return true}return false};f.exports=new m()}),null);
__d("FantaTabsAppBase",["Bootloader","ChatAppActions","ChatAppStore","ChatPerfInstrumentation","CSS","JSLogger","Map","Run","gkx"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();h.prototype.init=function(i,j,k){__p&&__p();if(this.isInitialized()){c("JSLogger").create("chat_app").error("repeated_init");return}this.$FantaTabsAppBase1=i;this.tabsElem=j;var l=c("ChatAppStore").addListener(function(){var n=c("ChatAppStore").getPreviousState(),o=c("ChatAppStore").getState();if(n.initialDisplayDone===false&&o.initialDisplayDone===true){c("ChatPerfInstrumentation").logDisplayDone();l.remove()}});c("ChatPerfInstrumentation").init();this.$FantaTabsAppBase2(k);this.initializeFantaData(k.interstitial_data);this.initializeFantaUI();var m=c("gkx")("AT7FBGrADYPEsp9qvqYtd1th6aWFd9XSwNBV43tGhyFXtrKVsfTadKZvm8LGa2YhYm4hBBmtxq-SMAAiJ9-55wql");if(!m)this.$FantaTabsAppBase3();c("ChatAppActions").tti();c("ChatPerfInstrumentation").logTTI();if(m)c("Run").onAfterLoad(function(){this.$FantaTabsAppBase4()}.bind(this))};h.prototype.isInitialized=function(){return!!c("ChatAppStore").getState().isInitialized};h.prototype.isHidden=function(){var i=c("ChatAppStore").getState();return!!(!i.isInitialized||i.isHidden)};h.prototype.hide=function(){if(this.isHidden())return;c("CSS").hide(this.$FantaTabsAppBase1);c("ChatAppActions").hide()};h.prototype.unhide=function(){__p&&__p();var i=c("ChatAppStore").getState();if(i.isInitialized){if(i.isHidden){c("CSS").show(this.$FantaTabsAppBase1);e(["Dock"],function(j){j.resizeAllFlyouts()});c("ChatAppActions").unhide()}}else if(!i.isLoaded){e(["UIPagelet"],function(j){j.loadFromEndpoint("ChatTabsPagelet","ChatTabsPagelet");j.loadFromEndpoint("BuddylistPagelet","BuddylistPagelet")});c("ChatAppActions").load()}};h.prototype.initializeFantaData=function(i){};h.prototype.initializeFantaUI=function(){};h.prototype.$FantaTabsAppBase2=function(i){__p&&__p();e(["MercuryBlockedParticipants.bs","MercuryDelayedRoger","MercuryDeliveryState","MercuryParticipants","MercuryServerPayloadPreprocessor","MercuryThreads","MercuryUnreadState","MercuryUnseenState","MercurySyncEnvironment","P2PSendMoneyDialogStore"],function(j,k,l,m,n,o,p,q,r,s){__p&&__p();j.get();k.get();l.get();m;o.get();q.get();p.get();r.setUp();c("ChatPerfInstrumentation").logInitStores();if(i.graphql_payload)c("Bootloader").loadModules(["ChatInitialDataTransformer.bs"],function(t){var u=i.graphql_payload,v=t.transform(u);v.message_blocked_ids=u.message_blocked_ids;v.message_ignored_ids=u.message_ignored_ids;v.payload_source=u.payload_source;n.get().handleUpdate(v)},"FantaTabsAppBase");else n.get().handleUpdate(i.initial_data)})};h.prototype.$FantaTabsAppBase3=function(){e(["HotLikeSound","ChatOptions"],function(i,j){i.setCheckSoundEnabledFunc(function(){return j.getSetting("sound")});c("ChatPerfInstrumentation").logInitSound()})};h.prototype.$FantaTabsAppBase4=function(){e(["HotLikeSound","ChatOptions"],function(i,j){i.setCheckSoundEnabledFunc(function(){return j.getSetting("sound")});c("ChatPerfInstrumentation").logInitSound()})};function h(){}f.exports=h}),null);
__d("FBRTCScreenSharingLogger",["Log","MarauderLogger","formatDate","keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="webrtc_screen_sharing",i=c("keyMirror")({screen_sharing_action:null,screen_sharing_error:null}),j=c("keyMirror")({PEER_ID:null,SESSION_ID:null,CONTEXT_TYPE:null,CONTENT:null}),k=c("keyMirror")({SCREEN_SHARING_TOGGLED:null,SCREEN_SHARING_CANCELLED:null,SCREEN_SHARING_ENABLED:null,SCREEN_SHARING_DISABLED:null,SCREEN_SHARING_EXT_DIALOG:null,SCREEN_SHARING_EXT_LINK:null,SCREEN_SHARING_DIALOG_SUCCESS:null,SCREEN_SHARING_DIALOG_CANCEL:null}),l=null;m.getInstance=function(){if(!l)l=new m();return l};m.prototype.logAction=function(n,o,p,q){var r={};r[i.screen_sharing_action]=p;r[j.PEER_ID]=n;r[j.SESSION_ID]=o;r[j.CONTEXT_TYPE]=this.$FBRTCScreenSharingLogger1();r[j.CONTENT]=q;this.$FBRTCScreenSharingLogger2(i.screen_sharing_action,r);this.logToConsole(n,o,p)};m.prototype.logError=function(n,o,p){var q={};q[j.PEER_ID]=n;q[j.SESSION_ID]=o;q[j.CONTEXT_TYPE]=this.$FBRTCScreenSharingLogger1();q[j.CONTENT]=p;this.$FBRTCScreenSharingLogger2(i.screen_sharing_error,q);this.logToConsole(n,o,p)};m.prototype.logToConsole=function(n,o,p){};m.prototype.$FBRTCScreenSharingLogger1=function(){return"p2p_video_call"};m.prototype.$FBRTCScreenSharingLogger2=function(n,o){c("MarauderLogger").log(n,h,o)};function m(){}m.Action=k;f.exports=m}),null);
__d("FBRTCVersionDetection",["UserAgent","UserAgentData"],(function a(b,c,d,e,f,g){__p&&__p();var h={isChrome:function i(){return c("UserAgent").isBrowser("Chrome")},isFirefox:function i(){return c("UserAgent").isBrowser("Firefox")},isChromium:function i(){return!!navigator.webkitGetUserMedia},webrtcVersion:function i(){if(this.isFirefox()||this.isChrome())return c("UserAgentData").browserVersion;if(this.isChromium()){var j=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return j!=null?parseInt(j[2],10):999}return 0}};f.exports=h}),null);
__d("FBRTCScreenSharingUtils",["Promise","FBRTCScreenSharingLogger","FBRTCStruct","FBRTCVersionDetection","RTCConfig","FBRTCSupport"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new(c("FBRTCStruct"))(["UNKNOWN","INSTALLED"]),i=h.UNKNOWN,j={RECIPIENT:"SC_CONTENT_SCRIPT",isScreenSharingSupported:function k(){return c("RTCConfig").ScreenSharingGK},isGroupCallScreenSharingSupported:function k(){return c("RTCConfig").ScreenSharingToGroupGK},isSupportedBrowser:function k(){return c("FBRTCVersionDetection").isChrome()&&c("FBRTCVersionDetection").webrtcVersion()>=34},canUserReceiveScreenSharing:function k(){return c("FBRTCSupport").isOSSupported()&&c("FBRTCVersionDetection").isChromium()&&c("FBRTCVersionDetection").webrtcVersion()>=34},canPeerReceiveScreenSharing:function k(l){return l.remoteSupport("screen_sharing")||c("RTCConfig").ScreenSharingToMobileGK&&!l.remoteSupport("www")&&!l.remoteSupport("mweb")},isExtensionInstalled:function k(){return i===h.INSTALLED},getExtensionStatus:function k(){return i},checkExtensionInstalled:function k(){__p&&__p();if(this.isExtensionInstalled())return c("Promise").resolve();var l=void 0,m=new(c("Promise"))(function(n){__p&&__p();l=function o(p){var q=p.origin,r=p.data;if(q!=window.location.origin||!r.type)return;if(r.type==="SC_EXT_INSTALLED"){window.removeEventListener("message",l);i=h.INSTALLED;n()}};window.addEventListener("message",l)});return c("Promise").race([m,this._pokeExtension()])["catch"](function(n){window.removeEventListener("message",l);return c("Promise").reject(n)})},_pokeExtension:function k(){__p&&__p();var l=arguments.length<=0||arguments[0]===undefined?13:arguments[0];return new(c("Promise"))(function(m,n){var o=setInterval(function(){setTimeout(function(){if(i===h.UNKNOWN)window.postMessage({recipient:j.RECIPIENT,type:"SC_IS_EXT_INSTALLED",text:"is extension installed"},"*")});if(l>0)l--;else{clearInterval(o);n("extension unavailable")}},200)})},logFailedAttempt:function k(l,m){c("FBRTCScreenSharingLogger").getInstance().logAction(l,m,c("FBRTCScreenSharingLogger").Action.SCREEN_SHARING_TOGGLED,"feature not available")}};f.exports=j}),null);
__d("RTCSignalingExperiments",["FBRTCScreenSharingUtils","FBRTCSupport","FBRTCVersionDetection","Set","UserAgent"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.$RTCSignalingExperiments2=new(c("Set"))();this.$RTCSignalingExperiments1=new(c("Set"))(h.getLocal());if(j)this.$RTCSignalingExperiments2=new(c("Set"))(j)}h.prototype.getLocal=function(){return Array.from(this.$RTCSignalingExperiments1)};h.prototype.setRemote=function(j){if(!j)return this;return new h(j)};h.prototype.getRemote=function(){return Array.from(this.$RTCSignalingExperiments2)};h.prototype.support=function(j){return this.localSupport(j)&&this.remoteSupport(j)};h.prototype.localSupport=function(j){return this.$RTCSignalingExperiments1.has(j)};h.prototype.remoteSupport=function(j){return this.$RTCSignalingExperiments2.has(j)};h.getLocal=function(){__p&&__p();var j=[];if(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Opera")||c("UserAgent").isBrowser("Firefox >= 38"))j.push("sdp_update");if(i())j.push("multiple_streams_plan_b");if(c("FBRTCScreenSharingUtils").canUserReceiveScreenSharing())j.push("screen_sharing");if(c("FBRTCSupport").isOSSupported())j.push("www");else j.push("mweb");return j};function i(){return(c("UserAgent").isBrowser("Chrome")||c("UserAgent").isBrowser("Opera"))&&c("FBRTCVersionDetection").webrtcVersion()>=34}f.exports=h}),null);
__d("FBRTCConfig",["CurrentUser","RTCSignalingExperiments"],(function a(b,c,d,e,f,g){__p&&__p();var h=false,i=false,j=0,k={},l={setConfig:function m(n,o,p,q,r){k=n;j=o;h=q;i=r},isVCEndpointCall:function m(){return h},canPeerUseV2:function m(){return i},getPeerID:function m(){return j},statsInterpreterConfig:function m(){return{rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1e3,bad_score_count:3}},settingsEnabled:function m(){return k.enable_settings},shouldAutoDisableVideo:function m(){return false},unsupportedBrowserUrl:function m(){if(k.troubleshooting_urls&&k.troubleshooting_urls.unsupported_browser)return k.troubleshooting_urls.unsupported_browser;if(c("CurrentUser").isWorkUser())return"https://www.facebook.com/help/work/919532078125908";else return"https://www.facebook.com/help/211644178877843"},userMediaErrorUrl:function m(){if(k.troubleshooting_urls&&k.troubleshooting_urls.user_media_error)return k.troubleshooting_urls.user_media_error;if(c("CurrentUser").isWorkUser())return"https://www.facebook.com/help/work/180714775754632";else return"https://www.facebook.com/help/232232800134371"},userMediaPermissionErrorUrl:function m(){if(k.troubleshooting_urls&&k.troubleshooting_urls.user_media_permission_error)return k.troubleshooting_urls.user_media_permission_error;if(c("CurrentUser").isWorkUser())return"https://www.facebook.com/help/work/180714775754632";else return"https://www.facebook.com/help/232232800134371"},supportedSignalingExperiments:function m(){return c("RTCSignalingExperiments").getLocal()},isMessengerDotCom:function m(){return k.is_messenger_dot_com},useMessengerCallUI:function m(){return k.messenger_call_ui},shouldCreateDataChannel:function m(){return k.data_channel},disableURLManager:function m(){return k.disable_url_manager}};f.exports=l}),null);
__d("FBRTCLocalMessageQueue",["CacheStorage","FBRTCLogger","Map","RTCConfig"],(function a(b,c,d,e,f,g){__p&&__p();var h="localstorage",i="RTC_",j="offer",k="offer_msg",l="data_",m=30*1e3,n=15*1e3,o=500,p=new(c("Map"))();function q(){"use strict";this.$FBRTCLocalMessageQueue1=c("FBRTCLogger").getInstance()}q.prototype.enqueueOffer=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue2(r,k);this.$FBRTCLocalMessageQueue3(t,j,s)};q.prototype.getOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue2(r,k);return this.$FBRTCLocalMessageQueue4(s,j)};q.prototype.removeOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue2(r,k);s.remove(j)};q.prototype.enqueueMessage=function(r,s,t,u){"use strict";var v=l+t.toString(),w=p.get(r)||new(c("Map"))();w.set(v,u);p.set(r,w);this.$FBRTCLocalMessageQueue1.logToConsole("Queued "+v)};q.prototype.drainQueue=function(r,s){"use strict";__p&&__p();var t=p.get(r)||new(c("Map"))(),u=void 0,v=void 0;for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{y=w.next();if(y.done)break;z=y.value}var A=z,u=A[0],v=A[1];void u;s(v)}p.set(r,new(c("Map"))())};q.prototype.enableDequeuing=function(r,s,t,u){"use strict";if(u===undefined)u=n;this.$FBRTCLocalMessageQueue5(r,s,t,u)};q.prototype.$FBRTCLocalMessageQueue5=function(r,s,t,u){"use strict";__p&&__p();var v=this.$FBRTCLocalMessageQueue2(r,s),w=v.keys(),x=w.length;for(var y=0;y<x;y++){var z=this.$FBRTCLocalMessageQueue6(v,w[y]);if(z&&t)t(z)}this.$FBRTCLocalMessageQueue1.logToConsole("Dequeued "+x+" ("+r+") with "+u+" left)");if(u>0){u-=o;setTimeout(function(){this.$FBRTCLocalMessageQueue5(r,s,t,u)}.bind(this),o)}};q.prototype.$FBRTCLocalMessageQueue3=function(r,s,t){"use strict";var u={__t:Date.now(),__d:t};r.set(s,u)};q.prototype.$FBRTCLocalMessageQueue4=function(r,s){"use strict";var t=r.get(s);if(t&&this.$FBRTCLocalMessageQueue7(t))return t.__d;else if(t)r.remove(s);return null};q.prototype.$FBRTCLocalMessageQueue6=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue4(r,s);if(t!==null){r.remove(s);return t}return null};q.prototype.$FBRTCLocalMessageQueue7=function(r){"use strict";return Date.now()-r.__t<m};q.prototype.$FBRTCLocalMessageQueue2=function(r,s){"use strict";return new(c("CacheStorage"))(h,""+i+r+"_"+s+"_")};f.exports=q}),null);
__d("FBRTCMessageListener",["invariant","Arbiter","ChannelConstants","FBRTCCallControlActions","FBRTCConstants","FBRTCLocalMessageQueue","FBRTCSupport","RTCConfig","guid","mixInEventEmitter"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("FBRTCConstants").ChildWindowMessageType,j=45*1e3,k=[],l=null,m=null,n=null,o=null,p=null,q=false,r=null,s=void 0,t={init:function u(v,w){__p&&__p();if(q)return;q=true;c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc_offer"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc_offerack"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("rtc_multi_json"),function(y,z){this._onMultiwayMessage(z.obj)}.bind(this));this._localMessageQueue=new(c("FBRTCLocalMessageQueue"))();if(c("RTCConfig").PassMessagesBetweenWindowsGK){if(c("FBRTCSupport").isWebrtcSupported()&&window.addEventListener){var x=v?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener("message",x,false)}if(v)this._connectToParentWindow(w)}},setParentWindowNonce:function u(v){o=v},generateNewNonce:function u(){p=c("guid")();return p},setMultiwayMessageHandler:function u(v,w){!r||h(0);r=w?v.bind(w):v},_onMultiwayMessage:function u(v){this.emit("multiwayMessageReceived",v);if(r)r(v)},setMessageHandler:function u(v,w){!l||h(0);l=w?v.bind(w):v;while(k.length)l(k.shift())},removeMessageHandler:function u(){l=null},setParentWindowStartCallHandler:function u(v){s=v;return function(){return s=null}},_onMessage:function u(v){if(v.from)v.from=v.from.toString();this.emit("messageReceived",v);if(l)l(v);else k.push(v);this._passMessageToChildWindow(v)},_connectToParentWindow:function u(v){if(window.opener&&window.opener.postMessage){var w={type:i.CHILD_WINDOW_READY,nonce:o,childNonce:this.generateNewNonce(),peerID:v};window.opener.postMessage(w,window.location.origin)}},_verifyWindowMessage:function u(event){return event.origin===window.location.origin&&event.data&&p&&event.data.nonce===p},_handleWindowMessageToParent:function u(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===i.CHILD_WINDOW_READY){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,m)}},_handleWindowMessageToChild:function u(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===i.CHILD_WINDOW_MESSAGE)this._onMessage(event.data.message);if(event.data.type===i.CHILD_WINDOW_START_CALL)if(s)s();else c("FBRTCCallControlActions").parentWindowStartCall()},_replayQueuedMessagesToChild:function u(v,w){this._localMessageQueue.drainQueue(v,function(x){var y={type:i.CHILD_WINDOW_MESSAGE,nonce:o,message:x};w.postMessage(y,window.location.origin)})},_setChildWindow:function u(v){m=v;clearTimeout(n);n=setTimeout(function(){m=null},j);this._startCallInChildWindow();this.generateNewNonce()},_passMessageToChildWindow:function u(v){if(m){var w={type:i.CHILD_WINDOW_MESSAGE,nonce:o,message:v};m.postMessage(w,window.location.origin)}},_startCallInChildWindow:function u(){if(m){var v={type:i.CHILD_WINDOW_START_CALL,nonce:o};m.postMessage(v,window.location.origin)}}};c("mixInEventEmitter")(t,{messageReceived:true,multiwayMessageReceived:true});f.exports=t}),null);
__d("FBRTCMessageHandler",["Bootloader","FBRTCMessageListener","FBRTCSupport"],(function a(b,c,d,e,f,g){__p&&__p();var h=null,i=false,j=null,k={init:function n(){if(!i&&c("FBRTCSupport").isReceiveWebrtcSupported()){i=true;c("FBRTCMessageListener").init(false);c("FBRTCMessageListener").once("messageReceived",function(o){l()});c("FBRTCMessageListener").once("multiwayMessageReceived",function(o){m(o)})}}};function l(){if(!h)c("Bootloader").loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(n,o,p,q){h=new n(o,q,new p());c("FBRTCMessageListener").setMessageHandler(h.onMessageReceived,h)},"FBRTCMessageHandler")}function m(n){if(!j)c("Bootloader").loadModules(["FBRTCGroupCallIncomingController","FBRTCGroupCallIncomingDialog"],function(o,p){j=new o(p);c("FBRTCMessageListener").setMultiwayMessageHandler(j.onMessageReceived,j);j.onMessageReceived(n)},"FBRTCMessageHandler")}f.exports=k}),null);
__d("FBRTCUtils",["AsyncRequest","CollabCallTriggerType","CurrentUser","FBIDCheck","FBRTCConfig","FBRTCConstants","RTCConfig","emptyFunction","randomInt"],(function a(b,c,d,e,f,g){__p&&__p();var h=6e3,i=window.URL||window.webkitURL,j="setSinkId"in window.HTMLMediaElement.prototype,k="srcObject"in window.HTMLMediaElement.prototype,l="mozSrcObject"in window.HTMLMediaElement.prototype,m={attachMediaStream:function n(o,p){__p&&__p();if(o==null)return;if(k){o.srcObject=p;if(p)o.play();return}if(l){o.mozSrcObject=p;if(p)o.play();return}if(o.src)i.revokeObjectURL(o.src);o.src=p?i.createObjectURL(p):""},reattachMediaStream:function n(o,p){__p&&__p();if(k){o.srcObject=p.srcObject;o.play();return}if(l){o.mozSrcObject=p.mozSrcObject;o.play();return}o.src=p.src},generateRandomInt:function n(){return c("randomInt")(0,4294967294)+1},aboutEqual:function n(o,p){return o-p<.01&&p-o<.01},getUploadLogLevel:function n(o){return Math.max(this.getLocalUploadLogLevel(),o)},getLocalUploadLogLevel:function n(){return c("CurrentUser").isEmployee()?c("FBRTCConstants").UploadLogLevel.LL_DEBUG:c("FBRTCConstants").UploadLogLevel.LL_NONE},sendServerRequest:function n(o){var p=arguments.length<=1||arguments[1]===undefined?c("emptyFunction"):arguments[1],q=arguments.length<=2||arguments[2]===undefined?c("emptyFunction"):arguments[2],r=arguments.length<=3||arguments[3]===undefined?false:arguments[3],s=arguments.length<=4||arguments[4]===undefined?h:arguments[4],t=arguments.length<=5||arguments[5]===undefined?{}:arguments[5],u=new(c("AsyncRequest"))().setURI(o).setData(t).setAllowCrossPageTransition(true).setHandler(p).setErrorHandler(q).setTimeoutHandler(s,function(){q()});if(r)u.setOption("asynchronous_DEPRECATED",false);u.send()},supportsSetSink:function n(){return j},isPeerVCEndpoint:function n(o){var p=c("FBRTCConfig").isVCEndpointCall();return p!==undefined?p:!!o&&!c("FBIDCheck").isUser_deprecated(o)&&c("RTCConfig").CollabVCEndpointsVideoCallGK},isCollabTrigger:function n(o){return o===c("CollabCallTriggerType").QUICK_DIAL||o===c("CollabCallTriggerType").MEETING_ROOM_PAGE_PROFILE}};f.exports=m}),null);
__d("MercuryAudienceRestrictedTypeaheadDataSource",["CurrentUser","DataSource","MercuryParticipantTypes","MercuryTypeaheadConstants","OrderedFriendsList","ShortProfiles"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("DataSource"));i=h&&h.prototype;function j(k){"use strict";__p&&__p();k=k||{};k.kanaNormalization=true;k.maxResults=c("MercuryTypeaheadConstants").COMPOSER_CHATTAB_MAX;k.minQueryLength=2;i.constructor.call(this,k);this.$MercuryAudienceRestrictedTypeaheadDataSource1=false;this.$MercuryAudienceRestrictedTypeaheadDataSource2=false;this.$MercuryAudienceRestrictedTypeaheadDataSource3={};this.$MercuryAudienceRestrictedTypeaheadDataSource4=true;this.queryCache={};this.localCache={};this.queryIDs={}}j.prototype.dirty=function(){"use strict";return this};j.prototype.buildData=function(k){"use strict";return i.buildData.call(this,k)};j.prototype.query=function(k,l,m,n){"use strict";var o=l||k.length===1;return i.query.call(this,k,o,m,n)};j.prototype.getQueryData=function(k,l){"use strict";return babelHelpers["extends"]({},i.getQueryData.call(this,k,l))};j.prototype.setEntry=function(k,l){"use strict";this.$MercuryAudienceRestrictedTypeaheadDataSource3[k]=l};j.prototype.getEntry=function(k){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource3[k]||null};j.prototype.getCachedShortProfileIDs=function(){"use strict";var k=c("ShortProfiles").getCachedProfileIDs(),l=k.filter(function(m){var n=c("ShortProfiles").getNow(m);return m==c("CurrentUser").getID()||n&&(n.type===c("MercuryParticipantTypes").FRIEND||n.type===c("MercuryParticipantTypes").FB4C)});return l};j.prototype.isBootstrapped=function(){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource1};j.prototype.isBootstrapping=function(){"use strict";return this.$MercuryAudienceRestrictedTypeaheadDataSource2};j.prototype.processEntries=function(k,l){"use strict";k=k&&k.map(function(m){if(m.index==null&&(m.render_type===c("MercuryParticipantTypes").FRIEND||m.render_type===c("MercuryParticipantTypes").FB4C))m.index=c("OrderedFriendsList").getActiveRank(m.uid);return m});return i.processEntries.call(this,k)};j.prototype.mergeUids=function(k,l,m,n){"use strict";var o=l.sort(function(p,q){var r=this.getEntry(p),s=this.getEntry(q);return r&&r.index&&s&&s.index?r.index-s.index:0}.bind(this));return i.mergeUids.call(this,k,o,m,n)};j.prototype.setQueryData=function(k,l){"use strict";return i.setQueryData.call(this,k)};j.prototype.respond=function(k,l,m){"use strict";return i.respond.call(this,k,l,m)};j.prototype.setShowThreads=function(k){"use strict";this.$MercuryAudienceRestrictedTypeaheadDataSource4=k};f.exports=j}),null);