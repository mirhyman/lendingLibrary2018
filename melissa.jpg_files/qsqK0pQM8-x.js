if (self.CavalryLogger) { CavalryLogger.start_js(["AkoxQ"]); }

__d("FundsAvailability",[],(function a(b,c,d,e,f,g){f.exports={NONE:0,FUNDS_AVAILABILITY_NA:65,FUNDS_AVAILABILITY_IMMEDIATE:73,FUNDS_AVAILABILITY_SAME_DAY:83,FUNDS_AVAILABILITY_NEXT_DAY:78,FUNDS_AVAILABILITY_FIVE_DAY:70,FUNDS_AVAILABILITY_UNKNOWN:85,FUNDS_AVAILABILITY_ONE_THREE_DAY:79,FUNDS_AVAILABILITY_CROSS_BORDER:66,FUNDS_AVAILABILITY_CROSS_BORDER_FAST_FUNDS:67,FUNDS_AVAILABILITY_DOMESTIC:68,FUNDS_AVAILABILITY_DOMESTIC_FAST_FUNDS:69}}),null);
__d("MercuryAPIArgsSource",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"chat",JEWEL:"jewel",MERCURY:"mercury",MERCURYSYNC:"mercury_sync",WEBMESSENGER:"web_messenger",MESSENGER:"messenger"}}),null);
__d("MercuryAudioType",[],(function a(b,c,d,e,f,g){f.exports={AudioClip:"fb_voice_message",VoiceMessageWithTranscript:"fb_voice_message_with_transcript"}}),null);
__d("PageCommItemStatus",[],(function a(b,c,d,e,f,g){f.exports={FOLLOW_UP:"FOLLOW_UP",DONE:"DONE",TODO:"TODO",SPAM:"SPAM"}}),null);
__d("EventReminderConstants",[],(function a(b,c,d,e,f,g){"use strict";var h=Object.freeze({INITIAL:"initial",GOING:"going",WATCHED:"watched",UNWATCHED:"unwatched"}),i=Object.freeze({ASSOCIATED_EVENT:"ASSOCIATED_EVENT"}),j=Object.freeze({GOING:"GOING",DECLINED:"DECLINED",INVITED:"INVITED"}),k=Object.freeze({NO_ERROR:"NO_ERROR",PAST_TIME:"PAST_TIME",AFTER_ONE_YEAR:"AFTER_ONE_YEAR"});f.exports={EventGuestStates:h,EventPlanType:i,GuestStates:j,TimeErrorType:k}}),null);
__d("MercuryMessageClientState",[],(function a(b,c,d,e,f,g){var h=Object.freeze({DO_NOT_SEND_TO_SERVER:"do_not_send_to_server",SEND_TO_SERVER:"send_to_server"});f.exports=h}),null);
__d("MessengerDispatcher",["Dispatcher_DEPRECATED"],(function a(b,c,d,e,f,g){"use strict";f.exports=new(c("Dispatcher_DEPRECATED"))()}),null);
__d("bs_char",["bs_caml_string","bs_caml_builtin_exceptions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(m){if(m<0||m>255)throw[c("bs_caml_builtin_exceptions").invalid_argument,"Char.chr"];else return m}function i(m){__p&&__p();var n=0;if(m>=40)if(m!==92)n=m>=127?1:2;else return"\\\\";else if(m>=32)if(m>=39)return"\\'";else n=2;else if(m>=14)n=1;else switch(m){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:n=1;break;case 13:return"\\r"}switch(n){case 1:var o=new Array(4);o[0]=92;o[1]=48+(m/100|0)|0;o[2]=48+(m/10|0)%10|0;o[3]=48+m%10|0;return c("bs_caml_string").bytes_to_string(o);case 2:var p=new Array(1);p[0]=m;return c("bs_caml_string").bytes_to_string(p)}}function j(m){if(m>=65&&m<=90||m>=192&&m<=214||m>=216&&m<=222)return m+32|0;else return m}function k(m){if(m>=97&&m<=122||m>=224&&m<=246||m>=248&&m<=254)return m-32|0;else return m}function l(m,n){return m-n|0}g.chr=h;g.escaped=i;g.lowercase=j;g.uppercase=k;g.compare=l}),null);
__d("bs_bytes",["bs_char","bs_list","bs_curry","bs_caml_obj","bs_caml_int32","bs_pervasives","bs_caml_string","bs_caml_builtin_exceptions"],(function a(aa,b,ba,ca,da,c){"use strict";__p&&__p();function d(P,Q){var R=b("bs_caml_string").caml_create_string(P);b("bs_caml_string").caml_fill_string(R,0,P,Q);return R}function e(P,Q){var R=b("bs_caml_string").caml_create_string(P);for(var S=0,T=P-1|0;S<=T;++S)R[S]=b("bs_curry")._1(Q,S);return R}var f=[];function g(P){var Q=P.length,R=b("bs_caml_string").caml_create_string(Q);b("bs_caml_string").caml_blit_bytes(P,0,R,0,Q);return R}function h(P){return b("bs_caml_string").bytes_to_string(g(P))}function i(P){return g(b("bs_caml_string").bytes_of_string(P))}function j(P,Q,R){if(Q<0||R<0||Q>(P.length-R|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.sub / Bytes.sub"];else{var S=b("bs_caml_string").caml_create_string(R);b("bs_caml_string").caml_blit_bytes(P,Q,S,0,R);return S}}function k(P,Q,R){return b("bs_caml_string").bytes_to_string(j(P,Q,R))}function l(P,Q,R){var S=(P.length+Q|0)+R|0,T=b("bs_caml_string").caml_create_string(S),U=Q<0?[-Q|0,0]:[0,Q],V=U[1],W=U[0],X=b("bs_pervasives").min(P.length-W|0,S-V|0);if(X>0)b("bs_caml_string").caml_blit_bytes(P,W,T,V,X);return T}function m(P,Q,R,S){if(Q<0||R<0||Q>(P.length-R|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.fill / Bytes.fill"];else return b("bs_caml_string").caml_fill_string(P,Q,R,S)}function n(P,Q,R,S,T){if(T<0||Q<0||Q>(P.length-T|0)||S<0||S>(R.length-T|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"Bytes.blit"];else return b("bs_caml_string").caml_blit_bytes(P,Q,R,S,T)}function o(P,Q,R,S,T){if(T<0||Q<0||Q>(P.length-T|0)||S<0||S>(R.length-T|0))throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.blit / Bytes.blit_string"];else return b("bs_caml_string").caml_blit_string(P,Q,R,S,T)}function p(P,Q){for(var R=0,S=Q.length-1|0;R<=S;++R)b("bs_curry")._1(P,Q[R]);return 0}function q(P,Q){for(var R=0,S=Q.length-1|0;R<=S;++R)b("bs_curry")._2(P,R,Q[R]);return 0}function r(P,Q){__p&&__p();if(Q){var R=Q[0],S=[0],T=[0];b("bs_list").iter(function(W){S[0]=S[0]+1|0;T[0]=T[0]+W.length|0;return 0},Q);var U=b("bs_caml_string").caml_create_string(T[0]+b("bs_caml_int32").imul(P.length,S[0]-1|0)|0);b("bs_caml_string").caml_blit_bytes(R,0,U,0,R.length);var V=[R.length];b("bs_list").iter(function(W){b("bs_caml_string").caml_blit_bytes(P,0,U,V[0],P.length);V[0]=V[0]+P.length|0;b("bs_caml_string").caml_blit_bytes(W,0,U,V[0],W.length);V[0]=V[0]+W.length|0;return 0},Q[1]);return U}else return f}function s(P,Q){return P.concat(Q)}function t(P){var Q=P-9|0;if(Q>4||Q<0)if(Q!==23)return 0;else return 1;else if(Q!==2)return 1;else return 0}function u(P){var Q=P.length,R=0;while(R<Q&&t(P[R]))R=R+1|0;var S=Q-1|0;while(S>=R&&t(P[S]))S=S-1|0;if(S>=R)return j(P,R,(S-R|0)+1|0);else return f}function v(P){__p&&__p();var Q=0;for(var R=0,S=P.length-1|0;R<=S;++R){var T=P[R],U;if(T>=32){var V=T-34|0;U=V>58||V<0?V>=93?4:1:V>57||V<1?2:1}else U=T>=11?T!==13?4:2:T>=8?2:4;Q=Q+U|0}if(Q===P.length)return g(P);else{var W=b("bs_caml_string").caml_create_string(Q);Q=0;for(var X=0,Y=P.length-1|0;X<=Y;++X){var Z=P[X],$=0;if(Z>=35)if(Z!==92)if(Z>=127)$=1;else W[Q]=Z;else $=2;else if(Z>=32)if(Z>=34)$=2;else W[Q]=Z;else if(Z>=14)$=1;else switch(Z){case 8:W[Q]=92;Q=Q+1|0;W[Q]=98;break;case 9:W[Q]=92;Q=Q+1|0;W[Q]=116;break;case 10:W[Q]=92;Q=Q+1|0;W[Q]=110;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:$=1;break;case 13:W[Q]=92;Q=Q+1|0;W[Q]=114;break}switch($){case 1:W[Q]=92;Q=Q+1|0;W[Q]=48+(Z/100|0)|0;Q=Q+1|0;W[Q]=48+(Z/10|0)%10|0;Q=Q+1|0;W[Q]=48+Z%10|0;break;case 2:W[Q]=92;Q=Q+1|0;W[Q]=Z;break}Q=Q+1|0}return W}}function w(P,Q){var R=Q.length;if(R){var S=b("bs_caml_string").caml_create_string(R);for(var T=0,U=R-1|0;T<=U;++T)S[T]=b("bs_curry")._1(P,Q[T]);return S}else return Q}function x(P,Q){var R=Q.length;if(R){var S=b("bs_caml_string").caml_create_string(R);for(var T=0,U=R-1|0;T<=U;++T)S[T]=b("bs_curry")._2(P,T,Q[T]);return S}else return Q}function y(P){return w(b("bs_char").uppercase,P)}function z(P){return w(b("bs_char").lowercase,P)}function A(P,Q){if(Q.length){var R=g(Q);R[0]=b("bs_curry")._1(P,Q[0]);return R}else return Q}function B(P){return A(b("bs_char").uppercase,P)}function C(P){return A(b("bs_char").lowercase,P)}function D(P,Q,R,S){__p&&__p();while(true){var T=R;if(T>=Q)throw b("bs_caml_builtin_exceptions").not_found;else if(P[T]===S)return T;else{R=T+1|0;continue}}}function E(P,Q){return D(P,P.length,0,Q)}function F(P,Q,R){var S=P.length;if(Q<0||Q>S)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.index_from / Bytes.index_from"];else return D(P,S,Q,R)}function G(P,Q,R){__p&&__p();while(true){var S=Q;if(S<0)throw b("bs_caml_builtin_exceptions").not_found;else if(P[S]===R)return S;else{Q=S-1|0;continue}}}function H(P,Q){return G(P,P.length-1|0,Q)}function I(P,Q,R){if(Q<-1||Q>=P.length)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.rindex_from / Bytes.rindex_from"];else return G(P,Q,R)}function J(P,Q,R){var S=P.length;if(Q<0||Q>S)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.contains_from / Bytes.contains_from"];else try{D(P,S,Q,R);return 1}catch(T){if(T===b("bs_caml_builtin_exceptions").not_found)return 0;else throw T}}function K(P,Q){return J(P,0,Q)}function L(P,Q,R){if(Q<0||Q>=P.length)throw[b("bs_caml_builtin_exceptions").invalid_argument,"String.rcontains_from / Bytes.rcontains_from"];else try{G(P,Q,R);return 1}catch(S){if(S===b("bs_caml_builtin_exceptions").not_found)return 0;else throw S}}var M=b("bs_caml_obj").caml_compare,N=b("bs_caml_string").bytes_to_string,O=b("bs_caml_string").bytes_of_string;c.make=d;c.init=e;c.empty=f;c.copy=g;c.of_string=i;c.to_string=h;c.sub=j;c.sub_string=k;c.extend=l;c.fill=m;c.blit=n;c.blit_string=o;c.concat=r;c.cat=s;c.iter=p;c.iteri=q;c.map=w;c.mapi=x;c.trim=u;c.escaped=v;c.index=E;c.rindex=H;c.index_from=F;c.rindex_from=I;c.contains=K;c.contains_from=J;c.rcontains_from=L;c.uppercase=y;c.lowercase=z;c.capitalize=B;c.uncapitalize=C;c.compare=M;c.unsafe_to_string=N;c.unsafe_of_string=O}),null);
__d("bs_js_boolean",[],(function a(b,c,d,e,f,g){"use strict";function h(i){if(i)return true;else return false}g.to_js_boolean=h}),null);
__d("bs_string",["bs_list","bs_bytes","bs_caml_int32","bs_caml_string"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").make(H,I))}function i(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").init(H,I))}function j(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").copy(c("bs_caml_string").bytes_of_string(H)))}function k(H,I,J){return c("bs_caml_string").bytes_to_string(c("bs_bytes").sub(c("bs_caml_string").bytes_of_string(H),I,J))}function l(H,I){__p&&__p();if(I){var J=I[0],K=[0],L=[0];c("bs_list").iter(function(O){K[0]=K[0]+1|0;L[0]=L[0]+O.length|0;return 0},I);var M=c("bs_caml_string").caml_create_string(L[0]+c("bs_caml_int32").imul(H.length,K[0]-1|0)|0);c("bs_caml_string").caml_blit_string(J,0,M,0,J.length);var N=[J.length];c("bs_list").iter(function(O){c("bs_caml_string").caml_blit_string(H,0,M,N[0],H.length);N[0]=N[0]+H.length|0;c("bs_caml_string").caml_blit_string(O,0,M,N[0],O.length);N[0]=N[0]+O.length|0;return 0},I[1]);return c("bs_caml_string").bytes_to_string(M)}else return""}function m(H,I){return c("bs_bytes").iter(H,c("bs_caml_string").bytes_of_string(I))}function n(H,I){return c("bs_bytes").iteri(H,c("bs_caml_string").bytes_of_string(I))}function o(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").map(H,c("bs_caml_string").bytes_of_string(I)))}function p(H,I){return c("bs_caml_string").bytes_to_string(c("bs_bytes").mapi(H,c("bs_caml_string").bytes_of_string(I)))}function q(H){var I=H-9|0;if(I>4||I<0)if(I!==23)return 0;else return 1;else if(I!==2)return 1;else return 0}function r(H){if(H===""||!(q(H.charCodeAt(0))||q(H.charCodeAt(H.length-1|0))))return H;else return c("bs_caml_string").bytes_to_string(c("bs_bytes").trim(c("bs_caml_string").bytes_of_string(H)))}function s(H){__p&&__p();var I=function I(J){__p&&__p();while(true){var K=J;if(K>=H.length)return 0;else{var L=H.charCodeAt(K);if(L>=32){var M=L-34|0;if(M>58||M<0)if(M>=93)return 1;else{J=K+1|0;continue}else if(M>57||M<1)return 1;else{J=K+1|0;continue}}else return 1}}};if(I(0))return c("bs_caml_string").bytes_to_string(c("bs_bytes").escaped(c("bs_caml_string").bytes_of_string(H)));else return H}function t(H,I){return c("bs_bytes").index(c("bs_caml_string").bytes_of_string(H),I)}function u(H,I){return c("bs_bytes").rindex(c("bs_caml_string").bytes_of_string(H),I)}function v(H,I,J){return c("bs_bytes").index_from(c("bs_caml_string").bytes_of_string(H),I,J)}function w(H,I,J){return c("bs_bytes").rindex_from(c("bs_caml_string").bytes_of_string(H),I,J)}function x(H,I){return c("bs_bytes").contains(c("bs_caml_string").bytes_of_string(H),I)}function y(H,I,J){return c("bs_bytes").contains_from(c("bs_caml_string").bytes_of_string(H),I,J)}function z(H,I,J){return c("bs_bytes").rcontains_from(c("bs_caml_string").bytes_of_string(H),I,J)}function A(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").uppercase(c("bs_caml_string").bytes_of_string(H)))}function B(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").lowercase(c("bs_caml_string").bytes_of_string(H)))}function C(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").capitalize(c("bs_caml_string").bytes_of_string(H)))}function D(H){return c("bs_caml_string").bytes_to_string(c("bs_bytes").uncapitalize(c("bs_caml_string").bytes_of_string(H)))}var E=c("bs_caml_string").caml_string_compare,F=c("bs_bytes").fill,G=c("bs_bytes").blit_string;g.make=h;g.init=i;g.copy=j;g.sub=k;g.fill=F;g.blit=G;g.concat=l;g.iter=m;g.iteri=n;g.map=o;g.mapi=p;g.trim=r;g.escaped=s;g.index=t;g.rindex=u;g.index_from=v;g.rindex_from=w;g.contains=x;g.contains_from=y;g.rcontains_from=z;g.uppercase=A;g.lowercase=B;g.capitalize=C;g.uncapitalize=D;g.compare=E}),null);
__d("MercuryMessageIDs.bs",["bs_curry","KeyedCallbackManager"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new(c("KeyedCallbackManager"))();function i(k,l){var m=k.filter(function(o){return+(o.indexOf("id")===-1)}),n=function n(o){return c("bs_curry")._1(l,k.map(function(p){var q=o[p];if(q!==undefined)return q;else return p}))};return h.executeOrEnqueue(m,n)}function j(k,l){h.setResource(k,l);return 0}g.getServerIDs=i;g.addServerID=j}),null);
__d("MercuryVanityIDMap.bs",["bs_string","bs_js_primitive","MercuryAssert","bs_js_null_undefined"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={},i={};function j(o){return c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(h[c("bs_string").lowercase(o)]))}function k(o){return c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(i[o]))}function l(o){var p=i[o];if(p!==undefined)return true;else return false}function m(o){var p=h[c("bs_string").lowercase(o)];if(p!==undefined)return true;else return false}function n(o,p){c("MercuryAssert").isParticipantID(p);var q=c("bs_string").lowercase(o);h[q]=p;i[p]=q;return 0}g.vanityToID=h;g.idToVanity=i;g.getID=j;g.getVanity=k;g.hasID=l;g.hasVanity=m;g.set=n}),null);
__d("MercuryAttachmentContentType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({PHOTO:"attach:image",VIDEO:"attach:video",MUSIC:"attach:music",VOICE:"attach:voice",TEXT:"attach:text",MSWORD:"attach:ms:word",MSXLS:"attach:ms:xls",MSPPT:"attach:ms:ppt",ORION:"attach:orion",SHOERACK_INVITATION:"attach:shoerackinvite",UNKNOWN:"attach:unknown"})}),null);
__d("MNCommerceBubbleType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FB_RETAIL_RECEIPT:1,FB_RETAIL_CANCELLATION:2,FB_RETAIL_SHIPMENT:3,FB_RETAIL_SHIPMENT_TRACKING_EVENT_ETA:4,FB_RETAIL_SHIPMENT_TRACKING_EVENT_IN_TRANSIT:5,FB_RETAIL_SHIPMENT_TRACKING_EVENT_OUT_FOR_DELIVERY:6,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELAYED:7,FB_RETAIL_SHIPMENT_TRACKING_EVENT_DELIVERED:8,FB_RETAIL_SHIPMENT_FOR_UNSUPPORTED_CARRIER:9,FB_RETAIL_SHIPMENT_ETA:10,FB_RETAIL_NOW_IN_STOCK:11,FB_RETAIL_AGENT_ITEM_SUGGESTION:12,FB_RETAIL_AGENT_ITEM_RECEIPT:13,FB_RETAIL_PROMOTIONAL_MSG:14})}),null);
__d("MNCommerceCallToActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({OPEN_NATIVE:1,OPEN_URL:2,OPEN_CANCEL_RIDE_MUTATION:3,POSTBACK:4,ACCOUNT_LINK:5,MANAGE_MESSAGES:6,SHARE:7,PAYMENT:8,FACEBOOK_REPORT_A_PROBLEM:9,SUBSCRIPTION_PRESELECT:10,NAVIGATION:11,EXTENSIBLE_SHARE:12,OPEN_REACT_NATIVE_MINI_APP:13,OPEN_PAGE_ABOUT:14,OPEN_BRANDED_CAMERA:15})}),null);
__d("PaymentModulesClient",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({DONATION_P4P:"donation_p4p",MOR_DONATIONS:"mor_donations",INSTANT_EXPERIENCES:"instant_experiences",BUSINESS_PLATFORM_COMMERCE:"business_platform_commerce",MESSENGER_OMNIM:"messenger_omnim",MESSENGER_PLATFORM:"messenger_platform",PAGES_COMMERCE:"pages_commerce",SHIPPING_LABEL:"shipping_label",SYNCHRONOUS_COMPONENT_FLOW:"synchronous_component_flow",PAGES_SOLUTION:"pages_solution",CHECKOUT_EXPERIENCES:"checkout_experiences",MOBILE_TOP_UP:"mobile_top_up",MOCK:"mock"})}),null);
__d("ServicesCalendarSyncType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CLIENT_ONLY:"client_only",NO_CALENDAR_SYNC:"no_calendar_sync",SERVER_CONTINUOUS:"server_continuous",SERVER_SINGLE:"server_single"})}),null);
__d("Utils.bs",["bs_array","bs_curry","bs_js_boolean","bs_caml_builtin_exceptions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(q){if(q==null)return 0;else return+q}function i(q,r){if(q)return q[0];else return r}function j(q){return+((q==null?0:[q])!==0)}function k(q){if(q)return q[0];else return 0}function l(q){if(q==null)return 0;else return[+q]}function m(q){if(q)return c("bs_js_boolean").to_js_boolean(q[0]);else return undefined}function n(q){if(q)return c("bs_js_boolean").to_js_boolean(q[0]);else return false}function o(q,r){__p&&__p();var s=q,t=r,u=0;while(true){var v=u,w=t;if(w){var x=w[1],y=c("bs_curry")._1(s,w[0]);if(y){u=[y[0],v];t=x;continue}else{t=x;continue}}else return v}}function p(q){return c("bs_array").map(function(r){if(r)return r[0];else throw[c("bs_caml_builtin_exceptions").invalid_argument,"arrayCompact: sorry, something went wrong."]},q.filter(function(r){if(r)return 1;else return 0}))}g.isTruthy=h;g.$pipe$unknown=i;g.isDefined=j;g.isSomeTrue=k;g.nullUndefinedBooleanToOptionBool=l;g.optionBoolToNullUndefinedBoolean=m;g.optionBoolToBoolean=n;g.listFilterMap=o;g.arrayCompact=p}),null);
__d("MessengerStoryAttachmentTransformer.bs",["fbt","URI","bs_array","Utils.bs","bs_string","bs_caml_array","bs_js_boolean","bs_caml_format","CurrentUser","bs_js_primitive","FundsAvailability","bs_js_null_undefined","P2PTransferStatus","MNCommerceBubbleType","PaymentModulesClient","MercuryAttachmentType","bs_caml_builtin_exceptions","P2PPaymentRequestStatus","ServicesCalendarSyncType","MNCommerceCallToActionType","LeadGenInfoFieldTypes"],(function aa(ba,a,ca,da,ea,b,c){"use strict";__p&&__p();function d(B){return a("bs_array").map(function(C){var D=C.user_confirmation,E=D==null?[null,null,null,null,false]:[D.cancel_button_label,D.continue_button_label,D.confirmation_message,D.confirmation_title,true],F=C.payment_metadata;return{action_link:C.action_link,action_type:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("MNCommerceCallToActionType")[C.action_open_type])),action_objects:C.action_objects,title:C.title,confirmation_cancel_label:E[0],confirmation_continue_label:E[1],confirmation_message:E[2],confirmation_title:E[3],id:C.id,is_disabled:C.is_disabled,is_mutable_by_server:C.is_mutable_by_server,payment_metadata:F==null?{payment_module_config:null,total_price:null}:{payment_module_config:F.payment_module_config,total_price:F.total_price},render_style:C.render_style,webview_metadata:{fallback_url:C.webview_metadata.fallback_url,messenger_extensions:C.webview_metadata.messenger_extensions,webview_height_ratio:C.webview_metadata.webview_height_ratio,webview_share_button:C.webview_metadata.webview_share_button},should_show_user_confirmation:E[4],page_id:C.page_id}},B)}function e(B){return a("bs_array").map(function(C){var D=C.url,E=D==null?null:new(a("URI"))(D).getUnqualifiedURI().toString();return{title:C.title,uri:E}},B)}function fa(B){if(!(B==null)&&B!=="")return"#"+a("bs_string").sub(B,2,B.length-2|0);else return null}function ga(B){if(B==null)return null;else return{url:B.uri,src:B.uri,width:B.width,height:B.height}}function f(B,C){var D=C.cover_photo,E;if(D==null)E=[null,null,null];else{var F=D.photo.image,G=F==null?[null,null]:[F.uri,{height:F.height,width:F.width}];E=[D.photo.id,G[0],G[1]]}var H=C.location,I=H==null?[null,null]:[H.latitude,H.longitude],J=C.overall_star_rating;return{address:C.address.single_line_full_address,category:C.top_category_name,coverPhotoID:E[0],coverPhotoURL:E[1],coverPhotoDimensions:E[2],latitude:I[0],longitude:I[1],name:C.name,rating:J==null?null:J.value,pageID:C.id,priceRange:C.price_range_description,viewerID:B}}function g(B){var C=B.group_commerce_item_seller,D=B.primary_photo,E;if(D==null)E=null;else{var F=D.image;E=F==null?null:F.uri}return{caption:B.group_commerce_item_description.text,desc:B.group_commerce_item_description.text,owner_id:C==null?null:C.id,price:B.formatted_price.text,text:B.group_commerce_item_description.text,title:B.group_commerce_item_title,thumb_url:E,url:B.url}}function h(B){return{app_name:B.application_name,artists:B.artist_names,audio_url:B.audio_url,duration_ms:B.duration_ms,title:B.music_title}}function i(B){var C=B.payment;return{id:B.id,desc:B.desc,display_total_cost:B.total_cost,merchant_name:B.merchant_name,target_url:B.target_url,thumb_url:B.thumb_url,raw_amount:B.raw_amount,payment_id:C==null?null:C.id,total_cost:{amount:a("bs_caml_format").caml_float_of_string(B.price_amount),currency:B.price_currency},name:B.name}}function j(B){return{fundraiserID:B.fundraiserID,canDonate:B.canDonate,hasViewerDonated:B.hasViewerDonated,fundraiserDetailedProgressText:B.fundraiserDetailedProgressText,fundraiserSubtitleText:B.fundraiserSubtitleText,focusedCoverPhoto:B.focusedCoverPhoto}}function k(B){return{id:B.id,name:B.name,desc:B.desc,thumb_url:B.thumb_url,item_url:B.item_url,title:B.name,text:B.desc,source:B.source,image_aspect_ratio:B.image_aspect_ratio,metalines:{metaline_1:B.first_metaline,metaline_2:B.second_metaline,metaline_3:B.third_metaline},default_action:B.default_action,call_to_actions:d(B.call_to_actions)}}function l(B){__p&&__p();var C=function C($){var E=$.page_call_to_action;if(E==null)return undefined;else return E.id},D=function D($){var E=$.page_call_to_action;if(E==null)return false;else{var F=E.component_flow_service_config;if(F==null)return false;else return true}},E=B.page,F=E==null?[undefined,undefined,undefined,false]:[E.id,a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("ServicesCalendarSyncType")[E.calendar_sync_type])),C(E),D(E)],G=B.native_component_flow_request,H;if(G==null)H=null;else{var I=G.page,J=G.page,K=G.page,L;if(K==null)L=undefined;else{var M=K.profile_picture;L=M==null?undefined:M.uri}var N=G.suggested_time_range,O=G.product_item,P=G.product_item,Q=G.product_item,R=G.product_item,S;if(R==null)S=undefined;else{var T=R.profile_picture;S=T==null?undefined:T.uri}var U=G.user,V=G.user,W=G.job_application,X=G.user,Y;if(X==null)Y=undefined;else{var ha=X.profile_picture;Y=ha==null?undefined:ha.uri}H={additionalInfo:G.additional_info,availability:G.availability,hasSavedToCalendar:G.has_saved_to_calendar,requestFlowType:G.request_flow_type,generalInfo:G.service_general_info,id:G.id,pageID:I==null?undefined:I.id,pageName:J==null?undefined:J.name,pageProfilePic:L,preferredTimeRange:N==null?null:{end:N.end,start:N.start},price:O==null?null:O.experimental_freeform_price,duration:P==null?null:P.duration_in_seconds,requestAdminApprovalType:G.request_admin_approval_type,requestedTime:G.requested_time,serviceName:Q==null?null:Q.name,serviceProfilePic:S,specialRequest:G.special_request,status:G.booking_status_value,statusLabel:G.status,userID:U==null?undefined:U.id,username:V==null?undefined:V.short_name,jobApplicationID:W==null?undefined:W.id,userProfilePic:Y}}var ia=B.message_bubble_type,Z;switch(ia){case"CANCELLED":Z=["Cancelled",c._("Cancelled")];break;case"DECLINED":Z=["Declined",c._("Declined")];break;case"REQUESTED":Z=["Requested",c._("Requested")];break;case"SCHEDULEED":Z=["Scheduled",c._("Scheduled")];break;default:throw[a("bs_caml_builtin_exceptions").invalid_argument,"Erroneous target status"]}return{id:B.id,pageID:F[0],calendarSyncType:F[1],ctaID:F[2],hasServiceConfig:F[3],userID:B.user.id,status:Z[0],statusLabel:Z[1],viewerID:a("CurrentUser").getAccountID(),requestMetadata:H}}function m(B){return{live_location_id:B.live_location_id,is_expired:a("bs_js_boolean").to_js_boolean(B.is_expired),expiration_time:B.expiration_time,sender:B.sender,coordinate:B.coordinate,location_title:B.location_title,sender_destination:B.sender_destination,stop_reason:B.stop_reason}}function n(B){var C=B.first_metaline;return{desc:B.description,id:B.id,image_aspect_ratio:B.image_aspect_ratio,item_url:B.target_url,metalines:C==null?{}:{metaline_1:C},name:B.name,source:B.source_name,text:B.description,thumb_url:B.image_url,title:B.name,default_action:B.default_action,call_to_actions:d(B.call_to_actions),media_blob_attachments:B.media_blob_attachments}}function o(B){var C=a("bs_array").map(n,B.business_items.nodes),D=d(B.call_to_actions);return{message:B.message,call_to_actions:D,items:C}}function p(B){return{message:B.message,call_to_actions:d(B.call_to_actions),items:a("bs_array").map(n,B.promotion_items.nodes)}}function q(B){var C=B.structured_address.streets,D=B.partner_logo;return{account_holder_name:B.account_holder_name,adjustments:a("bs_array").map(function(E){return{adjustment_type:E.adjustment_type,display_adjustment_amount:E.adjustment_amount}},B.adjustments),cancellation_url:B.cancellation_url,items:a("bs_array").map(n,B.items.nodes),merchant_name:B.merchant_name,messenger_commerce_bubble_type:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("MNCommerceBubbleType")[B.messenger_commerce_bubble_type])),order_id:B.order_id,order_time:B.order_time,order_url:B.order_url,payment_method:B.payment_method,receipt_id:B.receipt_id,recipient_name:B.recipient_name,shipping_cost:B.shipping_cost,shipping_method:B.shipping_method,status:B.status,structured_address:{city:B.structured_address.city,state:B.structured_address.state,country:B.structured_address.country,postal_code:B.structured_address.postal_code,street_1:a("bs_caml_array").caml_array_get(C,0),street_2:a("bs_caml_array").caml_array_get(C,1)},subtotal:B.subtotal,total_cost:B.total_cost,total_tax:B.total_tax,partner_logo:D==null?undefined:D.uri}}function r(B,C){return{payment_modules_client:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("PaymentModulesClient")[C.payment_modules_client])),is_viewer_seller:C.is_viewer_seller,payment_snippet:C.payment_snippet,item_list:a("bs_array").map(function(D){return{item_id:D.item_id,name:D.name,subtitle:D.subtitle,description:D.description,unit_price:D.unit_price,image_urls:a("bs_array").map(function(E){return E.uri},D.images),quantity:D.quantity}},C.item_list),components:C.components,payment_call_to_actions:C.payment_call_to_actions,click_action:C.click_action,actor_id:B,invoicer_id:C.invoicer_id}}var s=function s(B){__p&&__p();var C=a("LeadGenInfoFieldTypes"),D={},E=[];for(var F=B.field_data_list,G=Array.isArray(F),H=0,F=G?F:F[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var I;if(G){if(H>=F.length)break;I=F[H++]}else{H=F.next();if(H.done)break;I=H.value}var J=I,K=J.field_type,L=J.label,M=J.values;if(K===C.CUSTOM||K===C.ZIP)E.push({label:L,values:M});else D[K]={label:L,values:M}}D.questions=E;return D};function t(B,C){var D=C.invite_recipient,E=D==null?null:D.id,F=C.invite_sender,G=F==null?null:F.id;return{quick_invite_id:C.id,recipient_id:E,sender_id:G,is_viewer_recipient:a("bs_js_boolean").to_js_boolean(+(B===E))}}function u(B){var C=function C(F){if(F==null)return null;else return F.uri},D=B.listing_category,E=D==null?[null,null]:[D.offer_image,D.request_image];return{listingType:B.listing_type,mapURI:C(B.map_image),offerURI:C(E[0]),requestURI:C(E[1])}}function v(B){return{sender:B.sender,receiver:B.receiver,transfer_id:B.transfer_id,bubbleView:B.bubble_view}}function w(B){__p&&__p();var C=B.receiver_profile,D;if(C==null)D=null;else{var E=C.profile_picture;D={id:C.id,name:C.short_name,full_name:C.name,picture:E==null?null:E.uri,profile_url:C.url}}var F=B.sender,G;if(F==null)G={};else{var H=F.profile_picture;G={id:F.id,name:F.name,full_name:F.full_name,picture:H==null?null:H.uri,profile_uri:F.url}}var I=B.transfer_context,J;if(I==null)J=[null,null,null];else{var K=I.transfer_theme;J=[I.memoText,a("bs_array").map(function(N){var C=N.image;if(C==null)return null;else return C.uri},I.memo_images),K==null?null:K.id]}var L=B.platform_item,M=L==null?null:{name:L.name,description:L.description,image:a("bs_array").map(function(N){var C=N.image;if(C==null)return null;else return C.uri},L.photos),refURL:L.url};return{sender:G,amountWithSymbol:B.transaction_amount.formatted_amount,status:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("P2PTransferStatus")[B.transfer_status])),receiver:D,transfer_id:B.transfer_id,completedTime:B.completedTime,updatedTime:B.updatedTime,creationTime:B.creationTime,amount:B.transaction_amount.amount,memoText:J[0],memoPhotoURLs:J[1],themeID:J[2],discountAmount:B.amount_fb_discount.formatted,fundsAvailability:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("FundsAvailability")[B.funds_availability])),groupThreadFBID:B.group_thread_fbid,platform_item:M,statusDescription:{markup:B.status_description},bubbleView:B.bubble_view,currencyCode:B.currency_amount.currency}}function x(B){__p&&__p();var C=B.requester,D;if(C==null)D=undefined;else{var E=C.profile_picture;D={id:C.id,name:C.short_name,full_name:C.name,picture:E==null?null:E.uri,profile_url:C.url}}var F=B.requestee,G;if(F==null)G=undefined;else{var H=F.profile_picture;G={id:F.id,name:F.short_name,full_name:F.name,picture:H==null?null:H.uri,profile_url:F.url}}var I=a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("P2PPaymentRequestStatus")[B.request_status])),J=B.transfer,K=J==null?[null,""]:[w(J),J.id],L=B.request_theme;return{amount:B.transaction_amount.amount,amountWithSymbol:B.amount.formatted,requestee:G,requester:D,currentStatus:I,currency:B.amount.currency,creationTime:B.creation_time,groupThreadFBID:B.group_thread_fbid,id:B.id,memoText:B.memo_text,themeID:L==null?null:L.id,transfer:K[0],transferID:K[1],updatedTime:B.updated_time,statusDescription:{markup:B.status_description}}}function y(B){var C=x({amount:B.amount,transaction_amount:B.transaction_amount,requester:B.requester,requestee:B.requestee,request_status:B.request_status,request_theme:B.request_theme,id:B.id,memo_text:B.memo_text,transfer:B.transfer,creation_time:B.creation_time,group_thread_fbid:B.group_thread_fbid,updated_time:B.updated_time,status_description:B.status_description}),D={individualRequests:a("bs_array").map(x,B.individual_requests)};return Object.assign(C,D)}function z(B,C){__p&&__p();var D=C.media,E=D==null?null:D.animated_image,F=D==null?null:D.image,G={};a("bs_array").iter(function(U){var H=U.value;G[U.key]=H==null?null:H.text;return 0},C.properties);var H=C.target,I;if(H==null)I=null;else switch(H.tag|0){case 0:I=u(H[0]);break;case 1:I=v(H[0]);break;case 2:I=w(H[0]);break;case 3:I=y(H[0]);break;case 4:I=r(B,H[0]);break;case 7:I=p(H[0]);break;case 8:I=o(H[0]);break;case 10:I=s(H[0]);break;case 11:I=m(H[0]);break;case 12:I=t(B,H[0]);break;case 13:I=l(H[0]);break;case 14:var J=H[0],K=J.genie_sender,L=K==null?[null,null]:[K.messaging_actor.id,K.messaging_actor.name],M=L[0],N=J.story_attachment,O=N==null?null:A(B,{legacy_attachment_id:M,story_attachment:{action_links:N.action_links,messaging_attribution:N.messaging_attribution,messenger_call_to_actions:N.messenger_call_to_actions,deduplication_key:N.deduplication_key,description:N.description,media:N.media,properties:N.properties,source:N.source,style_list:N.style_list,title_with_entities:N.title_with_entities,url:N.url,subattachments:[],target:null}});I={genie_id:M,genie_name:L[1],attachment:O};break;case 16:I=h(H[0]);break;case 18:I=k(H[0]);break;case 19:I=i(H[0]);break;case 20:I=j(H[0]);break;case 21:I=q(H[0]);break;case 23:I=g(H[0]);break;case 24:I=f(B,H[0]);break;default:I=H[0]}var P=C.target,Q=!(P==null)&&P.tag===7?0:null,R=C.description,S=C.source,T=C.title_with_entities;return{description:R==null?null:R.text,media:{animated_image:E==null?null:E.uri,animated_image_size:E==null?{height:null,width:null}:{height:E.height,width:E.width},image:F==null?null:F.uri,image_size:F==null?{height:null,width:null}:{height:F.height,width:F.width},duration:D==null?null:D.playable_duration,playable:D==null?null:D.is_playable,source:D==null?null:D.playable_url},source:S==null?null:S.text,style_list:C.style_list,title:T==null?null:T.text,action_links:e(C.action_links),messaging_attribution:C.messaging_attribution,messenger_ctas:a("bs_array").map(function(U){return{id:U.id,page_id:a("Utils.bs").$pipe$unknown(a("bs_js_primitive").null_undefined_to_opt(U.page_id),""),action_title:U.title,action_url:U.action_link,action_open_type:a("bs_js_null_undefined").from_opt(a("bs_js_primitive").undefined_to_opt(a("MNCommerceCallToActionType")[U.action_open_type])),is_high_confidence:a("Utils.bs").$pipe$unknown(a("bs_js_primitive").null_undefined_to_opt(U.is_high_confidence),false),is_mutable_by_server:U.is_mutable_by_server,native_url:U.native_url,is_disabled:U.is_disabled,webview_metadata:{fallback_url:U.webview_metadata.fallback_url,messenger_extensions:U.webview_metadata.messenger_extensions,webview_height_ratio:U.webview_metadata.webview_height_ratio,webview_share_button:U.webview_metadata.webview_share_button}}},C.messenger_call_to_actions),properties:G,uri:C.url,deduplication_key:C.deduplication_key,target:I,label:Q}}function A(B,C){var D=C.story_attachment,E;if(D==null)E=null;else{var F={share_id:C.legacy_attachment_id,subattachments:a("bs_array").map(function(H){return z(B,H)},D.subattachments)},G={description:D.description,media:D.media,source:D.source,style_list:D.style_list,title_with_entities:D.title_with_entities,properties:D.properties,url:D.url,deduplication_key:D.deduplication_key,action_links:D.action_links,messaging_attribution:D.messaging_attribution,messenger_call_to_actions:D.messenger_call_to_actions,target:D.target};E=Object.assign(F,z(B,G))}return{app_attribution:null,attach_type:a("MercuryAttachmentType").SHARE,name:null,url:null,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:null,metadata:null,share:E,thumbnail_url:null}}b._getCallToActions=d;b._getActionLinks=e;b._getColor=fa;b._getLogo=ga;b._getPageTarget=f;b._getGroupCommerceProductItemTarget=g;b._getExternalSongTarget=h;b._getAgentSuggestionItemTarget=i;b._getFundraiserTarget=j;b._getRetailItemTarget=k;b._getPagesPlatformBookingMessageTarget=l;b._getMessageLiveLocationTarget=m;b._getBusinessRetailItem=n;b._getMessengerBusinessMessageTarget=o;b._getMessengerRetailPromotionTarget=p;b._getMessengerRetailReceiptTarget=q;b._getPagesPlatformAttachmentTarget=r;b._getPagesPlatformLeadGenInfoTarget=s;b._getQuickInviteTarget=t;b._getCrisisListingTarget=u;b._getMoneyTransferTarget=v;b._getP2PTransferTarget=w;b._getP2PTransferRequestTarget=x;b._getP2PTransferRequestWithIndividualRequests=y;b.transformStoryAttachment=z;b.getExtensibleAttachmentPayload=A}),null);
__d("MessengerAttachmentTransformer.bs",["fbt","bs_array","bs_js_boolean","bs_pervasives","MercuryAttachmentType","MercuryAttachmentContentType","MessengerStoryAttachmentTransformer.bs"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();function i(q){__p&&__p();if(q.is_malicious)return{app_attribution:null,icon_type:c("MercuryAttachmentContentType").UNKNOWN,metadata:null,name:null,preview_height:null,preview_url:null,preview_width:null,rel:null,share:null,thumbnail_url:null,url:null,attach_type:c("MercuryAttachmentType").ERROR,error_msg:h._("This attachment has been marked as malicious."),message_file_fbid:null,url_shimhash:null,url_skipshim:null};else{var r=q.attribution_app,s;if(r==null)s=null;else{var t=r.square_logo;s={id:r.id,icon_url:t==null?null:t.uri,metadata:q.attribution_metadata,name:r.name}}var u=q.url;return{app_attribution:s,icon_type:q.content_type,metadata:null,name:q.filename,preview_height:null,preview_url:null,preview_width:null,rel:"ignore",share:null,thumbnail_url:null,url:u==null?null:u,attach_type:c("MercuryAttachmentType").FILE,error_msg:undefined,message_file_fbid:q.message_file_fbid,url_shimhash:q.url_shimhash,url_skipshim:q.url_skipshim}}}function j(q,r,s){var t=q.chat_image,u=t==null?[null,null,null]:[t.uri,t.width,t.height],v=u[0],w=q.chat_image,x=w==null?null:{width:w.width,height:w.height},y=q.large_image,z=y==null?[null,null]:[y.uri,{width:y.width,height:y.height}],A=q.inbox_image,B=A==null?[null,null]:[A.uri,{width:A.width,height:A.height}],C=q.attribution_app,D;if(C==null)D=null;else{var E=C.square_logo;D={id:C.id,icon_url:E==null?null:E.uri,metadata:q.attribution_metadata,name:C.name}}return{app_attribution:D,attach_type:c("MercuryAttachmentType").VIDEO,name:q.filename,url:q.playable_url,rel:"async",preview_url:v,preview_width:u[1],preview_height:u[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c("MercuryAttachmentContentType").VIDEO,metadata:{fbid:q.legacy_attachment_id,render_as_sticker:c("bs_js_boolean").to_js_boolean(+(q.video_type==="SPEAKING_STICKER")),dimensions:{width:q.original_dimensions.x,height:q.original_dimensions.y},duration:q.playable_duration_in_ms,large_size:z[1],large_preview:z[0],chat_size:x,chat_preview:v,inbox_size:B[1],inbox_preview:B[0],pageid:s?r:undefined},thumbnail_url:v,share:null}}function k(q){var r=q.attribution_app,s;if(r==null)s=null;else{var t=r.square_logo;s={id:r.id,icon_url:t==null?null:t.uri,metadata:q.attribution_metadata,name:r.name}}return{app_attribution:s,attach_type:c("MercuryAttachmentType").FILE,name:q.filename,url:q.playable_url,rel:"ignore",preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c("MercuryAttachmentContentType").MUSIC,metadata:{duration:q.playable_duration_in_ms,isVoicemail:q.is_voicemail?"1":"0",type:q.audio_type==="VOICE_MESSAGE"?"fb_voice_message":q.audio_type==="VOICE_MESSAGE_WITH_TRANSCRIPT"?"fb_voice_message_with_transcript":"file_attachment"},thumbnail_url:null,share:null,url_shimhash:q.url_shimhash,url_skipshim:q.url_skipshim}}function l(q,r,s){var t=q.preview_image,u=t==null?[null,null,null]:[t.uri,t.width,t.height],v=q.animated_image,w=v==null?null:v.uri,x=q.attribution_app,y;if(x==null)y=null;else{var z=x.square_logo;y={id:x.id,icon_url:z==null?null:z.uri,metadata:q.attribution_metadata,name:x.name}}return{app_attribution:y,attach_type:c("MercuryAttachmentType").ANIMATED_IMAGE,name:q.filename,url:w,rel:"async",preview_url:u[0],preview_width:u[1],preview_height:u[2],large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c("MercuryAttachmentContentType").PHOTO,metadata:{fbid:q.legacy_attachment_id,image:w,dimensions:c("bs_pervasives").string_of_int(q.original_dimensions.x)+(","+c("bs_pervasives").string_of_int(q.original_dimensions.y)),pageid:s?r:undefined},thumbnail_url:w,share:null}}function m(q){__p&&__p();var r=q.original_extension==="gif"?c("MercuryAttachmentType").ANIMATED_IMAGE:q.render_as_sticker?c("MercuryAttachmentType").THIRDPARTYSTICKER:c("MercuryAttachmentType").PHOTO,s=q.preview,t=s==null?[null,null,null]:[s.uri,s.width,s.height],u;if(r===c("MercuryAttachmentType").PHOTO){var v=q.large_preview;u=v==null?[null,null,null]:[v.uri,v.width,v.height]}else u=[null,null,null];var w=q.attribution_app,x;if(w==null)x=null;else{var y=w.square_logo;x={id:w.id,icon_url:y==null?null:y.uri,metadata:q.attribution_metadata,name:w.name}}var z=q.thumbnail;return{app_attribution:x,attach_type:r,name:q.filename,url:null,rel:"async",preview_url:t[0],preview_width:t[1],preview_height:t[2],large_preview_url:u[0],large_preview_width:u[1],large_preview_height:u[2],icon_type:c("MercuryAttachmentContentType").PHOTO,metadata:{fbid:q.legacy_attachment_id,dimensions:c("bs_pervasives").string_of_int(q.original_dimensions.x)+(","+c("bs_pervasives").string_of_int(q.original_dimensions.y))},thumbnail_url:z==null?null:z.uri,share:null,photo_encodings:q.photo_encodings}}function n(q,r){var s=r,t=q;if(q>=r){var u=c("bs_pervasives").min(120,t/2),v=u/(t/2);return[u|0,s/2*v|0]}else{var w=c("bs_pervasives").min(120,s/2),x=w/(s/2);return[t/2*x|0,w|0]}}function o(q){var r=n(q.width,q.height),s=q.pack,t=q.sprite_image,u=q.sprite_image_2x,v=q.padded_sprite_image,w=q.padded_sprite_image_2x;return{app_attribution:null,attach_type:c("MercuryAttachmentType").STICKER,name:null,url:q.url,rel:null,preview_url:null,preview_width:null,preview_height:null,large_preview_url:null,large_preview_width:null,large_preview_height:null,icon_type:c("MercuryAttachmentContentType").UNKNOWN,metadata:{accessibilityLabel:q.label,stickerID:q.id,packID:s==null?null:s.id,frameCount:q.frame_count,frameRate:q.frame_rate,framesPerRow:q.frame_count>1?q.frames_per_row:1,framesPerCol:q.frame_count>1?q.frames_per_column:1,height:r[1],width:r[0],spriteURI:t==null?null:t.uri,spriteURI2x:u==null?null:u.uri,paddedSpriteURI:v==null?null:v.uri,paddedSpriteURI2x:w==null?null:w.uri,thumbnail_url:null,share:null}}}function p(q,r,s){__p&&__p();var t=[],u=r.extensible_attachment;if(!(u==null))t.push(c("MessengerStoryAttachmentTransformer.bs").getExtensibleAttachmentPayload(q,u));var v=r.sticker;if(!(v==null))t.push(o(v));var w=r.blob_attachments;if(!(w==null))c("bs_array").iter(function(x){__p&&__p();switch(x.tag|0){case 0:t.push(m(x[0]));return 0;case 1:t.push(l(x[0],q,s));return 0;case 2:t.push(k(x[0]));return 0;case 3:t.push(j(x[0],q,s));return 0;case 4:t.push(i(x[0]));return 0}},w);return t}g._getFilePayload=i;g._getVideoPayload=j;g._getAudioPayload=k;g._getAnimatedImagePayload=l;g._getImagePayload=m;g._getStickerDimensions=n;g._getStickerPayload=o;g.transformAttachment=p}),null);
__d("InstantGameUpdateXMATUpdateType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({UNKNOWN:"unknown",GAME_SCORE:"game_score",CUSTOM_MESSAGE:"custom_message"})}),null);
__d("MNCommerceMessageType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({TEXT:"text",IMAGE:"image",VIDEO:"video",AUDIO:"audio",FILE:"file",ROBOT_TEXT:"robot_text",LOCATION:"location",FORCED_FETCH_MESSAGE:"forced_fetch_message",SENDER_ACTION:"sender_action",RETAIL_PRODUCT_SUBSCRIPTION:"retail_product_subscription",RETAIL_PROMOTION:"retail_promotion",RETAIL_CANCELLATION:"retail_cancellation",RETAIL_SHIPMENT:"retail_shipment",SHIPMENT_TRACKING_EVENT:"shipment_tracking_event",AIRLINE_CHECKIN_REMINDER:"airline_checkin_reminder",AIRLINE_BOARDING_PASS:"airline_boarding_pass",AIRLINE_CHECKIN:"airline_checkin",AIRLINE_BOARDINGPASS:"airline_boardingpass",AIRLINE_UPDATE:"airline_update",AIRLINE_ITINERARY:"airline_itinerary",CONTENT_SUBSCRIPTION:"content_subscription",AD_ADMIN_TEXT:"ad_admin_text",AD_TEXT:"ad_text",AD_BUBBLE:"ad_bubble",NON_AD:"non_ad",UNKNOWN:"unknown",OTHER:"other",TEMPLATE:"template",OPEN_GRAPH:"open_graph",GENERIC:"generic",LIST:"list",COMPACT_LIST:"compact_list",BUTTON:"button",RECEIPT:"receipt",GENERIC_LEGACY:"generic_legacy",ICE_BREAKER:"ice_breaker",FALLBACK:"fallback",RIDE_INTENT:"ride_intent",RIDE_SIGNUP:"ride_signup",RIDE_WELCOME:"ride_welcome",RIDE_ORDER_CONFIRMATION:"ride_order_confirmation",RIDE_REQUESTED:"ride_requested",RIDE_DRIVER_ON_THE_WAY:"ride_driver_on_the_way",RIDE_NO_DRIVER:"ride_no_driver",RIDE_DRIVER_ARRIVING:"ride_driver_arriving",RIDE_DRIVER_CANCELED:"ride_driver_canceled",RIDE_RIDER_CANCELED:"ride_rider_canceled",RIDE_COMPLETE:"ride_complete",RIDE_ADMIN_MESSAGE:"ride_admin_message",RIDE_RECEIPT:"ride_receipt",RIDE_REENGAGEMENT_FIRST_RIDE:"ride_reengagement_first_ride",GET_RIDE:"give_get_ride",GIVE_RIDE:"send_give_get_ride",REFERER_PROMO:"referer_promo",INSTANT_GAMES_SHARE:"instant_games_share",INSTANT_GAMES_SCORE:"instant_games_score",INSTANT_GAMES_LIVE_STREAM:"instant_games_live_stream",LINK:"link_admin_message",UNLINK:"unlink_admin_message",BLOCK_ALL:"block_all_admin_message",UNBLOCK_ALL:"unblock_all_admin_message",BLOCK_PROMOTION:"block_promotion_admin_message",UNBLOCK_PROMOTION:"unblock_promotion_admin_message",INITIAL_PROMOTION:"initial_promotion_admin_message",WEAK_CONSENT_ADMIN_MESSAGE:"weak_consent_admin_message",MESSENGER_TEAM_BOT_MESSAGE:"messenger_team_bot",MESSENGER_BOT_BASE_GENERIC:"messenger_bot_base_generic",COMMERCE_COMPACT_LIST:"commerce_compact_list",FEEDBACK:"feedback",MEDIA:"media",PLACE_CARD:"place_card"})}),null);
__d("MercuryActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({LOG_MESSAGE:"ma-type:log-message",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",ADD_GROUP_ADMINS:"ma-type:add_group_admins",REMOVE_GROUP_ADMINS:"ma-type:remove_group_admins",CHANGE_READ_STATUS:"ma-type:change_read_status",MARK_THREAD_SEEN:"ma-type:mark_thread_seen",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings",SEND_MESSAGE:"ma-type:send-message",DELETE_MESSAGES:"ma-type:delete-messages",DELETE_THREAD:"ma-type:delete-thread",UPDATE_SNIPPET:"ma-type:update-snippet",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",CHANGE_PAGE_FOLLOW_UP_STATUS:"ma-type:change-page-follow-up-status",CHANGE_FOLDER:"ma-type:change-folder",ADD_PARTICIPANTS:"ma-type:add-participants",CANCEL_ATTACHMENT_PLACEHOLDER:"ma-type:cancel-attachment-placeholder",CONFIRM_ATTACHMENT_PLACEHOLDER:"ma-type:confirm-attachment-placeholder",CHANGE_FLAG:"ma-type:change_flag",MOVE_PENDING_TO_INBOX:"ma-type:move_pending_to_inbox",CREATE_PAGE_ADMIN_NOTE:"ma-type:create-page-admin-note",REPLACE_MESSAGE:"ma-type:replace-message",UPDATE_CUSTOM_LIKE:"ma-type:update_custom_like",UNWRAP_MESSAGE:"ma-type:unwrap-message",JOINABLE_MODE:"ma-type:joinable-mode",APPROVAL_MODE:"ma-type:approval-mode",APPROVAL_QUEUE:"ma-type:approval-queue",IS_PIN_PROTECTED:"ma-type:is_pin_protected",REACTION_UPDATE:"ma-type:reaction-update",LIVE_LOCATION_UPDATE:"ma-type:live-location-update",UPDATE_RTC_CALL_DATA:"ma-type:update-rtc-call-data",UPDATE_COMM_STATUS:"ma-type:update-comm-status",EVENT_RSVP_CHANGED:"ma-type:event-rsvp-changed",BLOCK_STATUS_CHANGED:"ma-type:block-status-changed",UPDATE_COMM_ITEM_OWNER:"ma-type:update-comm-item-owner",MONTAGE_DIRECT_EXPIRE:"ma-type:montage-direct-expire"})}),null);
__d("MercuryLogMessageType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SUBSCRIBE:"log:subscribe",UNSUBSCRIBE:"log:unsubscribe",VIDEO_CALL:"log:video-call",PHONE_CALL:"log:phone-call",THREAD_NAME:"log:thread-name",THREAD_IMAGE:"log:thread-image",SERVER_ERROR:"log:error-msg",LIVE_LISTEN:"log:live-listen",WALLPAPER:"log:wallpaper",ORION:"log:orion",SWITCH_TO_WORK:"log:switch",PAGE_REPLY:"log:page-reply",GENERIC_ADMIN_TEXT:"log:generic-admin-text"})}),null);
__d("MessagingGenericAdminTextType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({ALOHA_AUTOCONNECT_INVITED:"aloha_autoconnect_invited",ALOHA_CONTACT_ADDED:"aloha_contact_added",ALOHA_CONTACT_ADDED_TO_ALOHA_PROXY_USER:"aloha_contact_added_to_aloha_proxy_user",ALOHA_CONTACT_REMOVED:"aloha_contact_removed",ALOHA_INVITE_OWNER_ACCEPT:"aloha_invite_owner_accept",ALOHA_INVITE_OWNER_DECLINE:"aloha_invite_owner_decline",ALOHA_MEDIA_ADDED:"aloha_media_added",ALOHA_MEDIA_SENT:"aloha_media_sent",ALOHA_VISUAL_MEDIA_SENT:"aloha_visual_media_sent",ALOHA_OWNER_INVITED:"aloha_owner_invited",ALOHA_PROXY_USER_NAME_SET:"aloha_proxy_user_name_set",ALOHA_PROXY_USER_PROFILE_PHOTO_SET:"aloha_proxy_user_profile_photo_set",ALOHA_WIFI_CREDENTIALS_SET:"aloha_wifi_credentials_set",MADE_POLL_VOTE:"made_poll_vote",ALOHA_USER_JOINED_CALL_ON_ALOHA:"aloha_user_joined_call_on_aloha",ALOHA_CALL_ENDED_ON_ALOHA:"aloha_call_ended_on_aloha",GROUP_POLL:"group_poll",GENERIC_NEW_CONNECTION:"generic_new_connection",CONFIRM_FRIEND_REQUEST:"confirm_friend_request",THREAD_CUSTOMIZATION_UPSELL:"thread_customization_upsell",PHONE_CONTACT_UPLOAD:"phone_contact_upload",RELATIONSHIP_CREATED:"relationship_created",ACCEPT_PENDING_THREAD:"accept_pending_thread",RAMP_UP_WELCOME_MESSAGE:"ramp_up_welcome_message",CHANGE_THREAD_THEME:"change_thread_theme",CHANGE_THREAD_ICON:"change_thread_icon",GROUP_THREAD_CREATED:"group_thread_created",THREAD_EPHEMERAL_SEND_MODE:"thread_ephemeral_send_mode",INVITE_ACCEPTED:"invite_accepted",MESSENGER_INVITE_SENT:"messenger_invite_sent",TURN_ON_PUSH:"turn_on_push",JOURNEY_PROMPT_COLOR:"journey_prompt_color",JOURNEY_PROMPT_LIKE:"journey_prompt_like",JOURNEY_PROMPT_NICKNAME:"journey_prompt_nickname",JOURNEY_PROMPT_SETUP:"journey_prompt_setup",CHANGE_THREAD_NICKNAME:"change_thread_nickname",NOTIFY_GROUP_MAYORSHIP:"notify_group_mayorship",PROMPT_GROUP_MAYORSHIP_CUSTOMIZATION:"prompt_group_mayorship_customization",MESSAGE_COUNT_MILESTONE_MESSAGE:"message_count_milestone_message",BOT_THREAD_SUBSCRIPTION:"bot_thread_subscription",RTC_CALL_LOG:"rtc_call_log",RTC_INSTANT_VIDEO_LIFECYCLE:"rtc_instant_video_lifecycle",JOURNEY_PROMPT_BOT:"journey_prompt_bot",RIDE_ORDERED_MESSAGE:"ride_ordered_message",DESTINATION_ETA_MESSAGE:"destination_eta_message",RIDE_ARRIVED_MESSAGE:"ride_arrived_message",JOURNEY_PROMPT_NEW_SETUP:"journey_prompt_new_setup",LIGHTWEIGHT_EVENT_CREATE:"lightweight_event_create",LIGHTWEIGHT_EVENT_DELETE:"lightweight_event_delete",LIGHTWEIGHT_EVENT_NOTIFY:"lightweight_event_notify",LIGHTWEIGHT_EVENT_NOTIFY_BEFORE_EVENT:"lightweight_event_notify_before_event",LIGHTWEIGHT_EVENT_RSVP:"lightweight_event_rsvp",LIGHTWEIGHT_EVENT_UPDATE:"lightweight_event_update",LIGHTWEIGHT_EVENT_UPDATE_LOCATION:"lightweight_event_update_location",LIGHTWEIGHT_EVENT_UPDATE_TIME:"lightweight_event_update_time",LIGHTWEIGHT_EVENT_UPDATE_TITLE:"lightweight_event_update_title",SAFETY_LOCATION_REQUEST_SENT:"safety_location_request_sent",SAFETY_LOCATION_REQUEST_RESPONDED:"safety_location_request_responded",SAFETY_LOCATION_REQUEST_DENIED:"safety_location_request_denied",AD_MANAGE_MESSAGE:"ad_manage_message",AD_REPLY_MESSAGE:"ad_reply_message",TAGGED_PHOTO:"tagged_photo",GAME_SCORE:"game_score",INSTANT_GAME_UPDATE:"instant_game_update",INSTANT_GAME_BOT_INTRO:"instant_game_bot_intro",MEDIA_SUBSCRIPTION_MANAGE:"media_subscription_manage",M_AI_SURVEY:"m_ai_survey",PHONE_NUMBER_LOOKUP_NOTICE:"phone_number_lookup_notice",MESSENGER_PRECHECKED_PLUGIN:"messenger_prechecked_plugin",ADD_CONTACT:"add_contact",PRODUCT_INVOICE_RECEIPT_REJECTED:"product_invoice_receipt_rejected",PRODUCT_INVOICE_PAID:"product_invoice_paid",PRODUCT_INVOICE_VOIDED:"product_invoice_voided",PRODUCT_INVOICE_SHIPPED:"product_invoice_shipped",PRODUCT_INVOICE_PAYMENT_EXPIRED:"product_invoice_payment_expired",PRODUCT_INVOICE_RECEIPT_UPLOADED:"product_invoice_receipt_uploaded",CHANGE_JOINABLE_SETTING:"change_joinable_setting",CHANGE_THREAD_ADMINS:"change_thread_admins",CHANGE_THREAD_APPROVAL_MODE:"change_thread_approval_mode",CAPY_SESSION_BEGIN:"capy_session_begin",CAPY_SESSION_BOT_BEGIN:"capy_session_bot_begin",CAPY_SESSION_END:"capy_session_end",CAPY_AGENT_JOIN:"capy_agent_join",CAPY_AGENT_DUMPED:"capy_agent_dumped",CAPY_SESSION_WAIT_TIME:"capy_session_wait_time",GROUP_SMS_PARTICIPANT_JOINED:"group_sms_participant_joined",GROUP_SMS_PARTICIPANT_CAPPED:"group_sms_participant_capped",SMS_PHONE_NUMBER_CHECK:"sms_phone_number_check",MESSENGER_BOT_REVIEW_SENT:"messenger_bot_review_sent",MESSENGER_CODE_SCAN:"messenger_code_scan",MESSENGER_LIVECHAT_PLUGIN_OPEN:"messenger_livechat_plugin_open",MINGLE_MATCH_SUCCESS:"mingle_match_success",MINGLE_PARTICIPANT_MATCHED:"mingle_participant_matched",MN_ACCOUNT_LINKING_TEXT:"mn_account_linking_text",MN_ACCOUNT_UNLINKING_TEXT:"mn_account_unlinking_text",MN_ACCOUNT_FORCED_UNLINKING_TEXT:"mn_account_forced_unlinking_text",MN_REF_SEND_TEXT:"mn_ref_send_text",ADS_WELCOME_MSG:"ads_welcome_msg",THREAD_JOINABLE_PROMOTION_TEXT:"thread_joinable_promotion_text",PAGES_PLATFORM_REQUEST_TEXT:"pages_platform_request_text",MESSENGER_NEW_USER_GET_STARTED:"messenger_new_user_get_started",SMS_PHONE_NUMBER_TOGGLE:"sms_phone_number_toggle",PAGES_PLATFORM_CREATE_APPOINTMENT:"Pages_Platform_create_appointment",INTERNAL_CAREER_JOBSY_REACHOUT_CONNECTED:"internal_career_jobsy_reachout_connected",JOINABLE_GROUP_THREAD_CREATED:"joinable_group_thread_created",JOINABLE_ROOM_CREATED_WITH_CO_CREATORS:"joinable_room_created_with_co_creators",PAGES_PLATFORM_ACCEPT_APPOINTMENT:"pages_platform_accept_appointment",PAGES_PLATFORM_REFERRAL_CONFIRMED_APPOINTMENT:"pages_platform_referral_confirmed_appointment",PAGES_PLATFORM_DECLINE_APPOINTMENT:"pages_platform_decline_appointment",PAGES_PLATFORM_USER_CANCEL:"pages_platform_user_cancel",PAGES_PLATFORM_ADMIN_CANCEL:"pages_platform_admin_cancel",MESSENGER_OMNIM_CREATE_FLOW:"messenger_omnim_create_flow",MESSENGER_OMNIM_UPDATE_FLOW:"messenger_omnim_update_flow",MESSENGER_OMNIM_UPDATE_FLOW_STATE:"messenger_omnim_update_flow_state",MESSENGER_GROUP_DESCRITPION_UPDATE:"messenger_group_description_update",MESSENGER_EXTENSION_ADD_CART:"messenger_extension_add_cart",MESSENGER_EXTENSION_ADD_FAVORITE:"messenger_extension_add_favorite",MESSENGER_AD_CONTEXT:"messenger_ad_context",PAGES_PLATFORM_APPOINTMENT_REMINDER:"pages_platform_appointment_reminder",PAGES_PLATFORM_ADMIN_DECLINE:"pages_platform_admin_decline",POKE_RECEIVED:"poke_received",MESSENGER_STATION_SUBSCRIPTION:"messenger_station_subscription",MESSENGER_USER_ALSO_ON_MESSENGER:"messenger_user_also_on_messenger",MESSENGER_INBOX2_BIRTHDAY_BUMP:"messenger_inbox2_birthday_bump",STARTED_SHARING_VIDEO:"started_sharing_video",LIVE_VIDEO_CHAT:"live_video_chat",PARTICIPANT_JOINED_GROUP_CALL:"participant_joined_group_call",MESSENGER_ONLY_PHONE_JOINED_WITH_NEW_ACCOUNT:"messenger_only_phone_joined_with_new_account",PAGES_COMMERCE_PAYMENT_ENABLED:"pages_commerce_payment_enabled",GROUP_PAYMENT_REQUEST:"group_payment_request",P2P_CALL_ESCALATED_TO_GROUP_CALL:"p2p_call_escalated_to_group_call",INVITED_TO_ESCALATED_P2P_CALL:"invited_to_escalated_p2p_call",EVENT_UPCOMING:"event_upcoming",PAGES_VISITOR_POST_SEND_MESSAGE_UPSELL:"pages_visitor_post_send_message_upsell",PAGES_LOW_MESSAGE_RESPONSE_RATE:"pages_low_message_response_rate",PAGES_START_CALL:"pages_start_call",PARTIES_INVITE:"parties_invite",PAGES_JOIN_LOYALTY_PROGRAM:"pages_join_loyalty_program",WORK_INVITE_CLAIMED:"work_invite_claimed",P2P_PAYMENT_REQUEST_REMINDER:"p2p_payment_request_reminder",PHOTO_TAG_BUMP:"photo_tag_bump",MESSENGER_CALL_UPGRADE_LEGACY_CLIENT:"messenger_call_upgrade_legacy_client",DIRECTED_WALL_POST:"directed_wall_post",MESSENGER_CALL_LOG:"messenger_call_log",P2P_PAYMENT_MONEY_RAIN_GAME_ENTRY_POINT:"p2p_payment_money_rain_game_entry_point",MESSENGER_MONTAGE_MENTIONS:"messenger_montage_mentions",PAGES_MESSAGING_BLOCK_WORDS:"pages_messaging_block_words",ALOHA_CALL_INVITE:"aloha_call_invite",SHIPPO_TRACKING_UPDATES:"shippo_tracking_updates",NEO_APPROVED_CONNECTION_ADDED:"neo_approved_connection_added",CHANGE_FAVORITE_COLOR:"change_favorite_color",MARKETPLACE_ITEM_CHANGED:"marketplace_item_changed",SERVICES_VERTICAL_REDEEMED_REFERRAL:"services_vertical_redeemed_referral",SERVICES_VERTICAL_OPT_OUT_REQUESTS:"services_vertical_opt_out_requests",SERVICES_VERTICAL_OPT_OUT_REQUESTS_SUCCESS:"services_vertical_opt_out_requests_success",SERVICES_VERTICAL_LEAD_GEN_SURVEY:"services_vertical_lead_gen_survey",SERVICES_VERTICAL_LEAD_GEN_SURVEY_EDIT:"services_vertical_lead_gen_survey_edit",PAGES_MARK_AS_PAID:"pages_mark_as_paid",MIGRATED_TO_WORKPLACE:"migrated_to_workplace",MESSENGER_GROUP_EVENT_STATUS_UPDATE:"messenger_group_event_status_update",NEO_APPROVED_USER_REMOVED_FROM_GROUP:"neo_approved_user_removed_from_group",LIVE_CHAT_SUPPORT_AGENT_JOIN:"live_chat_support_agent_join",LIVE_CHAT_SUPPORT_SESSION_BEGIN:"live_chat_support_session_begin",LIVE_CHAT_SUPPORT_SESSION_END:"live_chat_support_session_end",MONTAGE_DIRECT_KEEP:"montage_direct_keep",CHSBOT_CONVERSATION_ENDED:"chsbot_conversation_ended",CHSBOT_LIVE_CHAT_SUPPORT_AGENT_BEGIN:"chsbot_live_chat_support_agent_begin",CHSBOT_LIVE_CHAT_SUPPORT_AGENT_END:"chsbot_live_chat_support_agent_end",CHSBOT_LIVE_PHONE_SUPPORT_AGENT_CALLING:"chsbot_live_phone_support_agent_calling",CHSBOT_SUPPORT_REQUESTED:"chsbot_support_requested",MESSENGER_SUBSCRIBE_TO_UPDATES:"messenger_subscribe_to_updates",MESSENGER_UNSUBSCRIBE_FROM_UPDATES:"messenger_unsubscribe_from_updates",MESSENGER_BLOCK_MESSAGES:"messenger_block_messages",MESSENGER_UNBLOCK_MESSAGES:"messenger_unblock_messages",THANKS_FOR_SHARING_MESSAGE_CONTEXT:"thanks_for_sharing_message_context",GROUP_ADMIN_MODEL_NUX:"group_admin_model_nux",MESSENGER_PAYMENT_INCENTIVE_INFO:"messenger_payment_incentive_info",MESSENGER_GROUP_SYNC_OPT_IN:"messenger_group_sync_opt_in",MESSENGER_GROUP_SYNC_OPT_OUT:"messenger_group_sync_opt_out",MENTORSHIP_MATCH:"mentorship_match",PAGES_CALL_DEFLECTION_UPSELL:"pages_call_deflection_upsell",RTC_PHOTOBOOTH:"rtc_photobooth"})}),null);
__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"})}),null);
__d("MessagingTagUtils",["MessagingSourceEnum","MessagingTagConstants","MercuryMessageSourceTags","Set"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=new(c("Set"))(Object.values(c("MessagingSourceEnum")));function i(l){__p&&__p();for(var m=l,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}var q=p;if(h.has(q))return q}return c("MessagingSourceEnum").UNKNOWN}function j(l){__p&&__p();for(var m=l,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}var q=p,r=q.split(c("MessagingTagConstants").app_id_root);if(r.length>1)return r[1].trim()}return null}function k(l,m){__p&&__p();var n=[],o=j(l);if(o&&c("MessagingTagConstants").orca_app_ids.indexOf(o)!==-1)n.push(c("MercuryMessageSourceTags").MESSENGER);if(c("MessagingTagConstants").chat_sources.indexOf(m)!==-1)n.push(c("MercuryMessageSourceTags").CHAT);if(c("MessagingTagConstants").email_source===m)n.push(c("MercuryMessageSourceTags").EMAIL);if(c("MessagingTagConstants").mobile_sources.indexOf(m)!==-1)n.push(c("MercuryMessageSourceTags").MOBILE);return n}f.exports={getSourceFromTags:i,getSourceTags:k}}),null);
__d("P2PPaymentLogMessageSubtype",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SENT_IN_GROUP:"sent_in_group",CANCELED_SENDER_RISK:"canceled_sender_risk",CANCELED_DECLINED:"canceled_declined",CANCELED_RECIPIENT_RISK:"canceled_recipient_risk",CANCELED_EXPIRED:"canceled_expired",CANCELED_SAME_CARD:"canceled_same_card",CANCELED_CUSTOMER_SERVICE:"canceled_customer_service",CANCELED_CHARGEBACK:"canceled_chargeback",CANCELED_SYSTEM_FAIL:"canceled_system_fail",REQUEST_CANCELED_BY_REQUESTER:"request_canceled_by_requester",REQUEST_DECLINED_BY_REQUESTEE:"request_declined_by_requestee",REQUEST_EXPIRED:"request_expired",REQUEST_REMINDER:"request_reminder",MONEY_RAIN_GAME_ENTRY_POINT:"money_rain_game_entry_point"})}),null);
__d("MessengerMessageTransformer.bs",["bs_array","bs_block","bs_string","FBIDCheck","getByPath","bs_js_boolean","MercuryIDs","bs_pervasives","bs_caml_format","CurrentUser","bs_js_primitive","MessagingTag","bs_js_null_undefined","MercuryActionType","MessagingTagUtils","MessagingSourceEnum","StoryAttachmentStyle","MNCommerceMessageType","MercuryLogMessageType","P2PPaymentLogMessageSubtype","MessagingGenericAdminTextType","MessengerAttachmentTransformer.bs","InstantGameUpdateXMATUpdateType"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(o,p,q){__p&&__p();var r;if(o.__typename==="GroupPollExtensibleMessageAdminText"){var s=o.question,t;if(s==null)t=[{},null];else{var u=Object.assign({},s);Object.assign(u,{total_count:o.total_count,options:c("bs_array").map(function(v){var w=Object.assign({},v);return Object.assign(w,{total_count:v.voters.nodes.length,voters:c("bs_array").map(function(x){return x.id},v.voters.nodes)})},s.options.nodes)});t=[u,s.id]}r={message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:{event_type:c("bs_string").lowercase(o.event_type),question_id:t[1],question_json:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(JSON.stringify(t[0])))}}}else r=o.__typename==="InstantGameUpdateExtensibleMessageAdminText"?{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:{game_id:c("getByPath")(o,["game","id"]),update_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("InstantGameUpdateXMATUpdateType")[o.update_type])),collapsed_text:o.collapsed_text,expanded_text:o.expanded_text,leaderboard_json:o.leaderboard_json,cta_url:c("getByPath")(o,["instant_game_update_data","cta_url"]),cta_title:c("getByPath")(o,["instant_game_update_data","cta_title"]),custom_image_url:c("getByPath")(o,["instant_game_update_data","photo","image","uri"]),template:c("getByPath")(o,["instant_game_update_data","template"])}}:o.__typename==="MessengerAdContextAdminText"?{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:{ad_url:o.ad_url}}:o.__typename==="AdExtensibleMessageAdminText"?{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:{ad_client_token:o.ad_client_token,ad_id:o.ad_id,ad_preferences_link:o.ad_preferences_link,ad_properties:o.ad_properties}}:o.__typename==="ThemeColorExtensibleMessageAdminText"||o.__typename==="ThreadIconExtensibleMessageAdminText"||o.__typename==="ThreadNicknameExtensibleMessageAdminText"||o.__typename==="AcceptPendingThreadExtensibleMessageAdminText"||o.__typename==="AddContactExtensibleMessageAdminText"||o.__typename==="RtcCallLogExtensibleMessageAdminText"||o.__typename==="GameScoreExtensibleMessageAdminText"||o.__typename==="ConfirmFriendRequestExtensibleMessageAdminText"||o.__typename==="PartiesInviteExtensibleMessageAdminText"||o.__typename==="AppointmentReminderExtensibleMessageAdminText"||o.__typename==="GraphQLServicesAppointmentsOptOutExtensibleMessageAdminText"?{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:Object.assign({},o)}:{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[p])),untypedData:undefined};return{log_message_body:q,log_message_data:r,log_message_type:c("MercuryLogMessageType").GENERIC_ADMIN_TEXT}}function i(o){return c("bs_array").map(function(p){if(p==="p2p_transfer")return c("StoryAttachmentStyle").ORION;else if(p==="p2p_payment_request")return c("StoryAttachmentStyle").ORION_REQUEST;else return p},o)}function j(o){__p&&__p();var p=o.target,q;if(p==null)q=null;else if(p.__typename==="CrisisListing")q=c("bs_block").__(0,[{listing_type:p.listing_type,listing_category:p.listing_category,map_image:p.map_image}]);else if(p.__typename==="MoneyTransfer")q=c("bs_block").__(1,[{sender:p.sender,receiver:p.receiver,transfer_id:p.transfer_id,bubble_view:p.bubble_view}]);else if(p.__typename==="PeerToPeerTransfer")q=c("bs_block").__(2,[{sender:p.sender,receiver_profile:p.receiver_profile,transaction_amount:p.transaction_amount,transfer_status:p.transfer_status,transfer_id:p.transfer_id,completedTime:p.completedTime,updatedTime:p.updatedTime,creationTime:p.creationTime,transfer_context:p.transfer_context,amount_fb_discount:p.amount_fb_discount,funds_availability:p.funds_availability,group_thread_fbid:p.group_thread_fbid,platform_item:p.platform_item,id:p.id,status_description:p.status_description,bubble_view:p.bubble_view,currency_amount:p.currency_amount}]);else if(p.__typename==="PeerToPeerPaymentRequest")q=c("bs_block").__(3,[{amount:p.amount,transaction_amount:p.transaction_amount,requester:p.requester,requestee:p.requestee,request_status:p.request_status,request_theme:p.request_theme,id:p.id,memo_text:p.memo_text,transfer:p.transfer,creation_time:p.creation_time,group_thread_fbid:p.group_thread_fbid,updated_time:p.updated_time,status_description:p.status_description,individual_requests:p.individual_requests}]);else if(p.__typename==="PaymentPlatformAttachment")q=c("bs_block").__(4,[{payment_modules_client:p.payment_modules_client,is_viewer_seller:p.is_viewer_seller,payment_snippet:p.payment_snippet,item_list:p.item_list,components:p.components,payment_call_to_actions:p.payment_call_to_actions,click_action:p.click_action,invoicer_id:p.invoicer_id}]);else if(p.__typename==="MomentsAppMessengerInvitation")q=c("bs_block").__(5,[{snippet:p.snippet}]);else if(p.__typename==="MomentsAppMessengerPhotoRequest")q=c("bs_block").__(6,[{snippet:p.snippet}]);else if(p.__typename==="MessengerRetailPromotion")q=c("bs_block").__(7,[{message:p.message,call_to_actions:p.call_to_actions,promotion_items:p.promotion_items}]);else if(p.__typename==="MessengerBusinessMessage")q=c("bs_block").__(8,[{message:p.message,call_to_actions:p.call_to_actions,business_items:p.business_items}]);else if(p.__typename==="Video")q=c("bs_block").__(9,[{video_id:p.video_id}]);else if(p.__typename==="PagesPlatformLeadGenInfo")q=c("bs_block").__(10,[{field_data_list:p.field_data_list}]);else if(p.__typename==="MessageLiveLocation")q=c("bs_block").__(11,[{live_location_id:p.live_location_id,is_expired:p.is_expired,expiration_time:p.expiration_time,sender:p.sender,coordinate:p.coordinate,location_title:p.location_title,sender_destination:p.sender_destination,stop_reason:p.stop_reason}]);else if(p.__typename==="QuickInvite")q=c("bs_block").__(12,[{id:p.id,invite_sender:p.invite_sender,invite_recipient:p.invite_recipient}]);else if(p.__typename==="PagesPlatformBookingMessage")q=c("bs_block").__(13,[{id:p.id,page:p.page,message_bubble_type:p.message_bubble_type,user:p.user,native_component_flow_request:p.native_component_flow_request}]);else if(p.__typename==="GenieMessage")q=c("bs_block").__(14,[{genie_sender:p.genie_sender,story_attachment:p.story_attachment}]);else if(p.__typename==="Event")q=c("bs_block").__(15,[{eventID:p.eventID,guestStatus:p.guestStatus,canViewerJoin:p.canViewerJoin,timeString:p.timeString,event_place:p.event_place,social_context:p.social_context,watchStatus:p.watchStatus,connection_style:p.connection_style,canViewerWatch:p.canViewerWatch}]);else if(p.__typename==="ExternalSong")q=c("bs_block").__(16,[{application_name:p.application_name,artist_names:p.artist_names,audio_url:p.audio_url,duration_ms:p.duration_ms,music_title:p.music_title}]);else if(p.__typename==="LightweightAction")q=c("bs_block").__(17,[{lwa_state:p.lwa_state,lwa_type:p.lwa_type}]);else if(p.__typename==="MessengerRetailItem")q=c("bs_block").__(18,[{id:p.id,name:p.name,desc:p.desc,thumb_url:p.thumb_url,item_url:p.item_url,source:p.source,image_aspect_ratio:p.image_aspect_ratio,first_metaline:p.first_metaline,second_metaline:p.second_metaline,third_metaline:p.third_metaline,default_action:p.default_action,call_to_actions:p.call_to_actions}]);else if(p.__typename==="AgentItemSuggestion")q=c("bs_block").__(19,[{id:p.id,desc:p.desc,total_cost:p.total_cost,merchant_name:p.merchant_name,target_url:p.target_url,thumb_url:p.thumb_url,raw_amount:p.raw_amount,payment:p.payment,price_amount:p.price_amount,price_currency:p.price_currency,name:p.name}]);else if(p.__typename==="FundraiserPersonToCharity"||p.__typename==="FundraiserPersonForPerson"){var r=p.fundraiser_detailed_progress_text,s=p.fundraiser_subtitle_text,t=p.focused_cover_photo;q=c("bs_block").__(20,[{fundraiserID:p.id,canDonate:p.can_donate,hasViewerDonated:p.has_viewer_donated,fundraiserDetailedProgressText:r==null?null:r.text,fundraiserSubtitleText:s==null?null:s.text,focusedCoverPhoto:t==null?null:{src:t.photo.image.uri,data:{height:t.photo.image.height,width:t.photo.image.width}}}])}else q=p.__typename==="MessengerRetailReceipt"?c("bs_block").__(21,[{account_holder_name:p.account_holder_name,adjustments:p.retail_adjustments,cancellation_url:p.cancellation_url,items:p.retail_items,merchant_name:p.merchant_name,messenger_commerce_bubble_type:p.bubble_type,order_id:p.receipt_id,order_time:p.order_time_for_display,order_url:p.receipt_url,payment_method:p.order_payment_method,receipt_id:p.id,recipient_name:p.recipient_name,shipping_cost:p.shipping_cost,shipping_method:p.shipping_method,status:p.status,structured_address:p.structured_address,subtotal:p.subtotal,total_cost:p.total,total_tax:p.tax,partner_logo:p.partner_log}]):p.__typename==="JobApplication"?c("bs_block").__(22,[{id:p.id}]):p.__typename==="GroupCommerceProductItem"?c("bs_block").__(23,[{group_commerce_item_description:p.group_commerce_item_description,group_commerce_item_seller:p.group_commerce_item_seller,formatted_price:p.formatted_price,group_commerce_item_title:p.group_commerce_item_title,primary_photo:p.primary_photo,url:p.url}]):p.__typename==="Page"?c("bs_block").__(24,[{address:p.address,top_category_name:p.top_category_name,cover_photo:p.cover_photo,location:p.location,name:p.name,overall_star_rating:p.overall_star_rating,id:p.id,price_range_description:p.price_range_description}]):p.__typename==="MessengerEventReminder"?c("bs_block").__(25,[{is_active:p.is_active}]):p.__typename==="AirlineBoardingPassCollectionMessageAttachment"?c("bs_block").__(26,[{tint_color:p.tint_color,logo:p.logo,flight_label:p.flight_label,boarding_time_label:p.boarding_time_label,departure_label:p.departure_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,flight_terminal_label:p.flight_terminal_label,flight_gate_label:p.flight_gate_label,view_boarding_pass_cta_label:p.view_boarding_pass_cta_label,boarding_passes:p.boarding_passes,share_cta_label:p.share_cta_label,message_cta_label:p.message_cta_label,boarding_pass_title_label:p.boarding_pass_title_label,boarding_pass_error_title_label:p.boarding_pass_error_title_label}]):p.__typename==="AirlineCheckInReminderMessageAttachment"?c("bs_block").__(27,[{pnr_number:p.pnr_number,tint_color:p.tint_color,checkin_url:p.checkin_url,booking_number_label:p.booking_number_label,flight_label:p.flight_label,arrival_time_label:p.arrival_time_label,departure_time_label:p.departure_time_label,checkin_cta_label:p.checkin_cta_label,logo:p.logo,flight_infos:p.flight_infos}]):p.__typename==="AirlineUpdateMessageAttachment"?c("bs_block").__(28,[{pnr_number:p.pnr_number,tint_color:p.tint_color,update_type:p.update_type,departure_time_label:p.departure_time_label,arrival_time_label:p.arrival_time_label,booking_number_label:p.booking_number_label,flight_gate_label:p.flight_gate_label,flight_label:p.flight_label,flight_status_label:p.flight_status_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,logo:p.logo,flight_info:p.flight_info,hightlighted_labels:p.hightlighted_labels}]):p.__typename==="AirlineItineraryMessageAttachment"?c("bs_block").__(29,[{confirmation_number:p.confirmation_number,pnr_number:p.pnr_number,tint_color:p.tint_color,formatted_total:p.formatted_total,itemized_price_infos:p.itemized_price_infos,formatted_tax:p.formatted_tax,formatted_base_price:p.formatted_base_price,passenger_infos:p.passenger_infos,logo:p.logo,aircraft_type_label:p.aircraft_type_label,arrival_time_label:p.arrival_time_label,base_price_label:p.base_price_label,booking_number_label:p.booking_number_label,cabin_type_label:p.cabin_type_label,departure_time_label:p.departure_time_label,flight_confirmation_label:p.flight_confirmation_label,flight_date_label:p.flight_date_label,flight_label:p.flight_label,flight_terminal_label:p.flight_terminal_label,itinerary_error_title_label:p.itinerary_error_title_label,itinerary_title_label:p.itinerary_title_label,passenger_name_label:p.passenger_name_label,passenger_names_label:p.passenger_names_label,passenger_seat_label:p.passenger_seat_label,purchase_summary_label:p.purchase_summary_label,taxes_label:p.taxes_label,total_label:p.total_label,view_details_cta_label:p.view_details_cta_label,itinerary_legs:p.itinerary_legs}]):p.__typename==="MessengerRetailShipmentTrackingEvent"?c("bs_block").__(30,[{id:p.id,shipment:p.shipment,tracking_event_time_for_display:p.tracking_event_time_for_display,shipment_tracking_event_type:p.shipment_tracking_event_type,messenger_commerce_location:p.messenger_commerce_location,tracking_event_description:p.tracking_event_description,bubble_type:p.bubble_type}]):p.__typename==="MessengerRetailShipment"?c("bs_block").__(31,[{id:p.id,tracking_number:p.tracking_number,shipdate_for_display:p.shipdate_for_display,estimated_delivery_time_for_display:p.estimated_delivery_time_for_display,commerce_origin:p.commerce_origin,commerce_destination:p.commerce_destination,retail_carrier:p.retail_carrier,shipment_tracking_events:p.shipment_tracking_events,receipt:p.receipt,recipient:p.recipient,retail_shipment_items:p.retail_shipment_items,bubble_type:p.bubble_type}]):p.__typename==="TicketOrderAttachment"?c("bs_block").__(33,[{ticket_order_id:p.ticket_order_id,event:p.event}]):p.__typename==="LeadGenDeepLinkData"?c("bs_block").__(32,[{id:p.id,cover_image:p.cover_image,headline:p.headline,name:p.name,page:p.page}]):p.__typename==="UserLeadGenInfo"?c("bs_block").__(34,[{id:p.id,field_data:p.field_data}]):p.__typename==="IceBreakerMessageAttachment"?c("bs_block").__(35,[{ice_breaker_title:p.ice_breaker_title,ice_breaker_messages:p.ice_breaker_messages,ad_id:p.ad_id}]):p.__typename==="MontageDirect"?c("bs_block").__(36,[{message_state:p.message_state,is_keep_disabled:p.is_keep_disabled}]):null;return{description:o.description,media:o.media,source:o.source,style_list:i(o.style_list),title_with_entities:o.title_with_entities,properties:o.properties,url:o.url,deduplication_key:o.deduplication_key,action_links:o.action_links,messaging_attribution:o.messaging_attribution,messenger_call_to_actions:o.messenger_call_to_actions,target:q}}function k(o){var p=j({description:o.description,media:o.media,source:o.source,style_list:o.style_list,title_with_entities:o.title_with_entities,properties:o.properties,url:o.url,deduplication_key:o.deduplication_key,action_links:o.action_links,messaging_attribution:o.messaging_attribution,messenger_call_to_actions:o.messenger_call_to_actions,target:o.target});if(p==null)return null;else{var q=c("bs_array").map(j,o.subattachments);return Object.assign({subattachments:q},p)}}function l(o){__p&&__p();var p=o.blob_attachments,q=[];if(!(p==null))c("bs_array").iter(function(r){__p&&__p();if(r.__typename==="MessageImage"){q.push(c("bs_block").__(0,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,preview:r.preview,large_preview:r.large_preview,thumbnail:r.thumbnail,legacy_attachment_id:r.legacy_attachment_id,original_dimensions:r.original_dimensions,original_extension:r.original_extension,render_as_sticker:r.render_as_sticker,photo_encodings:r.photo_encodings}]));return 0}else if(r.__typename==="MessageAnimatedImage"){q.push(c("bs_block").__(1,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,animated_image:r.animated_image,legacy_attachment_id:r.legacy_attachment_id,preview_image:r.preview_image,original_dimensions:r.original_dimensions}]));return 0}else if(r.__typename==="MessageAudio"){q.push(c("bs_block").__(2,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,playable_url:r.playable_url,playable_duration_in_ms:r.playable_duration_in_ms,is_voicemail:r.is_voicemail,audio_type:r.audio_type,url_shimhash:r.url_shimhash,url_skipshim:r.url_skipshim}]));return 0}else if(r.__typename==="MessageVideo"){q.push(c("bs_block").__(3,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,playable_url:r.playable_url,playable_duration_in_ms:r.playable_duration_in_ms,legacy_attachment_id:r.legacy_attachment_id,chat_image:r.chat_image,video_type:r.video_type,original_dimensions:r.original_dimensions,large_image:r.large_image,inbox_image:r.inbox_image}]));return 0}else if(r.__typename==="MessageFile"){q.push(c("bs_block").__(4,[{attribution_app:r.attribution_app,attribution_metadata:r.attribution_metadata,filename:r.filename,url:r.url,content_type:r.content_type,is_malicious:r.is_malicious,message_file_fbid:r.message_file_fbid,url_shimhash:r.url_shimhash,url_skipshim:r.url_skipshim}]));return 0}else return 0},p);return q}function m(o){__p&&__p();var p=o.message;if(p==null)return[];else{var q=[];c("bs_array").iter(function(r){__p&&__p();var p=r.entity;if(p==null)return 0;else{var s=p.id,t=p.thread_key;if(s==null)if(t==null)return 0;else{var u=t.thread_fbid;if(u==null)return 0;else{q.push({id:u,offset:r.offset,length:r.length,type:r.__typename});return 0}}else{q.push({id:s,offset:r.offset,length:r.length,type:r.__typename});return 0}}},p.ranges);return q}}function n(o,p,q,r){__p&&__p();var s={};c("bs_array").iter(function(X){s[X.user.id]=X.reaction;return 0},p.message_reactions);var t=+c("FBIDCheck").isUser_deprecated(p.message_sender.id),u=t?c("MessagingTagUtils").getSourceFromTags(p.tags_list):c("MessagingSourceEnum").UNKNOWN,v=t?c("MessagingTagUtils").getSourceTags(p.tags_list,u):[],w=p.commerce_message_type,x=p.customizations,y={thread_id:q.thread_id,thread_fbid:q.thread_fbid,other_user_fbid:q.other_user_fbid,action_type:p.__typename==="UserMessage"?c("MercuryActionType").USER_GENERATED_MESSAGE:c("MercuryActionType").LOG_MESSAGE,message_id:p.message_id,threading_id:null,offline_threading_id:p.offline_threading_id,author:c("MercuryIDs").getParticipantIDFromUserID(p.message_sender.id),author_email:p.message_sender.email,ephemeral_ttl_mode:p.ttl,timestamp:c("bs_caml_format").caml_float_of_string(p.timestamp_precise),is_unread:p.unread,is_filtered_content:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").FILTERED_CONTENT)!==-1)),is_filtered_content_bh:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").FILTERED_CONTENT_BH)!==-1)),is_filtered_content_account:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").FILTERED_CONTENT_ACCOUNT)!==-1)),is_filtered_content_quasar:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").FILTERED_CONTENT_QUASAR)!==-1)),is_filtered_content_invalid_app:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").FILTERED_CONTENT_INVALID_APP)!==-1)),is_sponsored:p.is_sponsored,ad_id:p.ad_id,ad_client_token:p.ad_client_token,commerce_message_type:w==null?null:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MNCommerceMessageType")[w])),customizations:x==null?[]:x,source:u,source_tags:v,tags:p.tags_list,is_spoof_warning:c("bs_js_boolean").to_js_boolean(+(p.tags_list.indexOf(c("MessagingTag").DOMAIN_AUTH_FAIL)!==-1||p.tags_list.indexOf(c("MessagingTag").SPAM_SPOOFING)!==-1||p.tags_list.indexOf(c("MessagingTag").SPOOF_WARNING)!==-1)),folder:q.folder,platform_xmd:p.platform_xmd_encoded,message_source:p.message_source_data,montage_reply_data:p.montage_reply_data,skip_bump_thread:false,profile_ranges:m(p),reactions:s};if(p.__typename==="UserMessage"){var z=l(p),A=p.extensible_attachment,B;if(A==null)B=null;else{var C=A.story_attachment;B={legacy_attachment_id:A.legacy_attachment_id,story_attachment:C==null?null:k(C)}}var D=c("MessengerAttachmentTransformer.bs").transformAttachment(o,{extensible_attachment:B,blob_attachments:z,sticker:p.sticker},r),E=p.message,F=p.page_admin_sender;Object.assign(y,{body:E==null?null:E.text,creator_info:F==null?null:{creatorID:F.admin_id,creatorName:F.name,creatorType:F.sender_type,labelType:F.label_type,pageID:F.page_id,profileURI:F.profile_uri},subject:null,has_attachment:c("bs_js_boolean").to_js_boolean(+(D.length>0)),attachments:D,raw_attachments:null,ranges:undefined,meta_ranges:p.meta_ranges.map(function(X){return babelHelpers["extends"]({},X,{data:JSON.parse(X.data)})})})}else if(p.__typename==="VoiceCallMessage"||p.__typename==="VideoCallMessage"){var G=p.__typename,H=G==="VoiceCallMessage"?c("MercuryLogMessageType").PHONE_CALL:c("MercuryLogMessageType").VIDEO_CALL,I=p.message_sender.id,J=q.other_user_fbid,K=J==null?null:c("MercuryIDs").getParticipantIDFromUserID(I===J?c("CurrentUser").getID():J),L=p.answered;Object.assign(y,{log_message_type:H,log_message_data:{answered:L==null?false:L,caller:c("MercuryIDs").getParticipantIDFromUserID(I),callee:K},log_message_body:p.snippet})}else if(p.__typename==="ThreadNameMessage")Object.assign(y,{log_message_type:c("MercuryLogMessageType").THREAD_NAME,log_message_data:{name:p.thread_name},log_message_body:p.snippet});else if(p.__typename==="ThreadImageMessage"){var M=p.image_with_metadata,N;if(M==null)N=null;else{var O=M.preview;N={preview_url:O==null?null:O.uri,metadata:{fbid:M.legacy_attachment_id,dimensions:c("bs_pervasives").string_of_int(M.original_dimensions.x)+(","+c("bs_pervasives").string_of_int(M.original_dimensions.y))}}}Object.assign(y,{log_message_type:c("MercuryLogMessageType").THREAD_IMAGE,log_message_data:{image:N},log_message_body:p.snippet})}else if(p.__typename==="ParticipantsAddedMessage"){var P=p.participants_added;Object.assign(y,{log_message_type:c("MercuryLogMessageType").SUBSCRIBE,log_message_data:{added_participants:P==null?[]:c("bs_array").map(function(X){return c("MercuryIDs").getParticipantIDFromUserID(X.id)},P)},log_message_body:p.snippet})}else if(p.__typename==="ParticipantLeftMessage"){var Q=p.participants_removed;Object.assign(y,{log_message_type:c("MercuryLogMessageType").UNSUBSCRIBE,log_message_data:{removed_participants:Q==null?[]:c("bs_array").map(function(X){return c("MercuryIDs").getParticipantIDFromUserID(X.id)},Q)},log_message_body:p.snippet})}else if(p.__typename==="GenericAdminTextMessage"){var R=p.extensible_message_admin_text,S=p.extensible_message_admin_text_type;if(R==null){if(!(S==null))Object.assign(y,{log_message_body:p.snippet,log_message_data:{message_type:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("MessagingGenericAdminTextType")[S])),untypedData:undefined},log_message_type:c("MercuryLogMessageType").GENERIC_ADMIN_TEXT})}else if(!(S==null))Object.assign(y,h(R,S,p.snippet))}else if(p.__typename==="P2PPaymentRequestMessage"){var T=p.p2p_sender,U=p.p2p_receiver,V=p.amount,W=p.message_type;Object.assign(y,{log_message_body:p.snippet,log_message_data:{transfer_id:p.transfer_id,senderId:T==null?null:c("MercuryIDs").getParticipantIDFromUserID(T.id),receiverId:U==null?null:c("MercuryIDs").getParticipantIDFromUserID(U.id),formattedAmount:V==null?null:V.formatted,subtype:W==null?null:c("bs_js_null_undefined").from_opt(c("bs_js_primitive").undefined_to_opt(c("P2PPaymentLogMessageSubtype")[W]))},log_message_type:c("MercuryLogMessageType").ORION})}return y}g._getGenericAdminTextMessage=h;g._getStyleList=i;g.unsafeCastExtensibleAttachmentWithoutSubattachments=j;g.unsafeCastExtensibleAttachment=k;g.unsafeCastBlobAttachments=l;g._getProfileRanges=m;g.transformMessage=n}),null);
__d("MessengerAttachmentTransformerForSend.bs",["bs_array","bs_caml_array","MercuryAttachmentType","MessengerMessageTransformer.bs","MessengerAttachmentTransformer.bs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j,k,l){__p&&__p();var m=k.node;if(m==null)return{attach_type:c("MercuryAttachmentType").ERROR};else{var n;if(m.__typename==="ExtensibleMessageAttachment"){var o=m.story_attachment;n={legacy_attachment_id:m.legacy_attachment_id,story_attachment:o==null?null:c("MessengerMessageTransformer.bs").unsafeCastExtensibleAttachment(o)}}else n=null;var p=m.__typename==="Sticker"?m:null,q=m.__typename,r;switch(q){case"MessageAnimatedImage":case"MessageAudio":case"MessageFile":case"MessageImage":case"MessageVideo":r=[m];break;default:r=null}var s=c("MessengerMessageTransformer.bs").unsafeCastBlobAttachments({blob_attachments:r}),t=c("MessengerAttachmentTransformer.bs").transformAttachment(j,{extensible_attachment:n,blob_attachments:s,sticker:p},l);if(t.length)return c("bs_caml_array").caml_array_get(t,0);else return{}}}function i(j,k,l){return c("bs_array").map(function(m){return h(j,m,l)},k)}g._transform=h;g.transform=i}),null);
__d("MessengerState.bs",["Set","bs_list","bs_array","bs_block","bs_curry","Utils.bs","MercuryIDs","CurrentUser","ReasonReact.bs","bs_js_primitive"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(u){return u[0]}function i(u){return u[1]}function j(u){return u[2]}var k={};function l(h){__p&&__p();var u=k[h];if(u!==undefined)return u;else{var v=[[h,{},new(c("Set"))()]],w=[0],x=function x(A){__p&&__p();v[0]=c("bs_array").fold_left(function(v,B){__p&&__p();var C=B[0];switch(C.tag|0){case 0:var D=v,E=C[0];Object.keys(E).forEach(function(J){var K=E[J],L=c("Utils.bs").$pipe$unknown(c("bs_js_primitive").undefined_to_opt(D[1][J]),0);if(K>L){D[1][J]=K;return 0}else return 0});return[D[0],D[1],D[2]];case 1:var F=v,G=C[0];c("bs_array").iter(function(J){F[2].add(J);return 0},G);return[F[0],F[1],F[2]];case 2:var H=v,I=C[0];I.forEach(function(J){__p&&__p();var K=J.fbid,C=c("Utils.bs").nullUndefinedBooleanToOptionBool(J.is_messenger_ignored);if(C)if(C[0]!==0){H[2].add(c("MercuryIDs").getParticipantIDFromUserID(K));return 0}else{+H[2]["delete"](c("MercuryIDs").getParticipantIDFromUserID(K));return 0}else return 0});return[H[0],H[1],H[2]]}},v[0],A);return c("bs_list").iter(function(B){return c("bs_curry")._1(B,v[0])},w[0])},y=function y(A){__p&&__p();w[0]=[A,w[0]];c("bs_curry")._1(A,v[0]);return function(B){__p&&__p();var C=A,D=function D(w){if(w){var E=w[1],F=w[0];if(F===C)return E;else return[F,D(E)]}else return 0};w[0]=D(w[0]);return 0}},m=function m(){return v[0]},z=[x,y,m];k[h]=z;return z}}function m(){return l(c("CurrentUser").getID())}function n(u,v){__p&&__p();var w=[];if(!(v==null)){var x=v.delivery_receipts;if(!(x==null))w.push([c("bs_block").__(0,[x])]);var y=v.message_ignored_ids;if(!(y==null))w.push([c("bs_block").__(1,[y])]);var z=v.participants;if(!(z==null))w.push([c("bs_block").__(2,[z])])}return c("bs_curry")._1(u[0],w)}var o=c("ReasonReact.bs").reducerComponent("MessengerStateRoot");function p(h,u){__p&&__p();var v=o.slice();v[9]=function(w){return c("bs_curry")._1(u,w[1])};v[10]=function(){return c("bs_curry")._1(l(h)[2],0)};v[12]=function(w,x){return c("bs_block").__(0,[w])};v[13]=function(w){var x=w[3];return[[function(){return c("bs_curry")._1(l(h)[1],x)},function(y){return c("bs_curry")._1(y,0)}],0]};return v}function q(u){return c("bs_curry")._1(u[2],0)}var r=[q],s=c("ReasonReact.bs").wrapReasonForJs(o,function(u){return p(u.fbid,u.children)}),t=[p];g.fbid=h;g.deliveryReceipts=i;g.ignoredIds=j;g.getForFBID=l;g.get=m;g.updateJS=n;g.Root=t;g.Test=r;g.jsComponent=s}),null);
__d("EmojiLikeConstants",["EmojiStaticConfig"],(function a(b,c,d,e,f,g){"use strict";var h=c("EmojiStaticConfig").sizeMap,i=Object.freeze({XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",LARGE:"large"}),j={dp16:"xsmall",dp32:"small",dp64:"medium",db64:"medium",dp128:"large"},k=Object.freeze({PICKER:"picker",HOT_LIKE:"hot_like"}),l=[983040],m="hot_emoji_source",n="hot_emoji_size",o="emoji_like",p="\ud83d\udc4d",q=[128077];f.exports={FB_THUMBS_UP_EMOJI:l,size:i,sizeMap:h,sizeMapTransfer:j,source:k,SOURCE_TAG_PREFIX:m,TAG_PREFIX_NEW:n,TAG_PREFIX_OLD:o,THUMBS_UP_EMOJI:p,THUMBS_UP_EMOJI_CODES:q}}),null);
__d("MercuryTagHelper",[],(function a(b,c,d,e,f,g){"use strict";var h={get:function i(j,k){var l=j.find(function(m){return m.startsWith(k)});return l&&l.substr(l.indexOf(":")+1)}};f.exports=h}),null);
__d("EmojiLikeUtils",["EmojiLikeConstants","EmoticonEmojiList","MercuryTagHelper"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(n,o){if(!n.tags)n.tags=[i(o)];else n.tags.push(i(o));return n}function i(n){var o=c("EmojiLikeConstants").TAG_PREFIX_NEW;return o+":"+n}function j(n,o){if(!n.tags)n.tags=[k(o)];else n.tags.push(k(o));return n}function k(n){return c("EmojiLikeConstants").SOURCE_TAG_PREFIX+":"+n}function l(n){return m(n)!=null}function m(n){if(!n.tags)return null;var o=c("MercuryTagHelper").get(n.tags,c("EmojiLikeConstants").TAG_PREFIX_NEW);if(o)return o;return c("MercuryTagHelper").get(n.tags,c("EmojiLikeConstants").TAG_PREFIX_OLD)}f.exports={getEmojiSize:m,isEmojiLike:l,setEmojiSize:h,setEmojiSource:j}}),null);
__d("MessengerThreadCannotReplyReason",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({BLOCKED:"blocked",COMPOSER_DISABLED_BOT:"composer_disabled_bot",HAS_EMAIL_PARTICIPANT:"has_email_participant",OBJECT_ORIGINATED:"object_originated",READ_ONLY:"read_only",VIEWER_NOT_SUBSCRIBED:"viewer_not_subscribed",RECIPIENTS_NOT_LOADABLE:"recipients_not_loadable",RECIPIENTS_UNAVAILABLE:"recipients_unavailable",RECIPIENTS_INVALID:"recipients_invalid",RECIPIENTS_INACTIVE_WORK_ACC:"recipients_inactive_work_account",MONTAGE_NOT_AUTHOR:"montage_not_author"})}),null);
__d("MercuryThreadInfo",["CurrentUser","MercuryIDs","MessengerThreadCannotReplyReason"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={canReply:function j(k){return!!(k.is_subscribed&&(k.can_reply===undefined||k.can_reply)&&!k.has_email_participant&&!k.read_only)},getMuteSetting:function j(k){return!k.mute_until?undefined:k.mute_until},isEmptyLocalThread:function j(k){return c("MercuryIDs").tokenize(k.thread_id).type==="root"&&!k.timestamp},isMuted:function j(k){return h.getMuteSetting(k)!==undefined},areMentionsMuted:function j(k){return k.mentions_mute_mode===1},areReactionsMuted:function j(k){return k.reactions_mute_mode===1},isNewEmptyLocalThread:function j(k){return!!(h.isEmptyLocalThread(k)&&k.participants&&k.participants.length===0)},showComposer:function j(k){return!!(k.is_subscribed&&(k.can_reply||!k.cannot_reply_reason||k.cannot_reply_reason===c("MessengerThreadCannotReplyReason").BLOCKED)&&!k.has_email_participant&&!k.read_only)},isColdOpen:function j(k){return!!(k.is_canonical_user&&(k.message_count===0||!k.timestamp))}};function i(j){return j+"@facebook.com"}f.exports=h}),null);
__d("MercurySingletonMixin",["CurrentUser"],(function a(b,c,d,e,f,g){__p&&__p();var h={_getInstances:function i(){if(!this._instances)this._instances={};return this._instances},get:function i(){return this.getForFBID(c("CurrentUser").getID())},getForFBID:function i(j){var k=this._getInstances();if(!k[j])k[j]=new this(j);return k[j]}};f.exports=h}),null);
__d("MercuryDispatcher",["invariant","ArbiterMixin","MessengerState.bs","LogHistory","MercuryActionType","MercuryPayloadSource","MercurySingletonProvider","MercuryThreadInformer","isEmpty","mixin"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("LogHistory").getInstance("mercury_dispatcher");i=babelHelpers.inherits(l,c("mixin")(c("ArbiterMixin")));j=i&&i.prototype;l.getForFBID=function(n){return m.getForFBID(n)};l.get=function(){return m.get()};function l(n){j.constructor.call(this);this.$MercuryDispatcher1=n;this.$MercuryDispatcher2=c("MessengerState.bs").getForFBID(n)}l.prototype.handleUpdate=function(n){__p&&__p();this.$MercuryDispatcher3(n);!!n.from_client!==!!n.preprocessed||h(0);delete n.preprocessed;if(!c("isEmpty")(n))c("MercuryThreadInformer").getForFBID(this.$MercuryDispatcher1).synchronizeInforms(function(){__p&&__p();if(n.payload_source===c("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE)this.inform("invalidate-global-state",{});if(n.payload_source===c("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE){var o=n.threads&&n.threads.length>0&&n.threads[0]&&n.threads[0].thread_id;if(o)this.inform("invalidate-thread-state",o)}this.inform("update-thread-ids",n.newlyAddedClientIDs);this.inform("update-participants",n);this.inform("update-threads",n);this.inform("update-unread",n);this.inform("update-threadlist",n);this.inform("update-messages",n);this.inform("update-unseen",n);this.inform("update-typing-state",n);this.inform("update-delivery",n);this.inform("update-roger",n.roger);this.inform("update-blocked-users",n);this.inform("update-ignored-users",n);this.inform("model-update-completed",null);this.inform("update-work-group-threads",n);c("MessengerState.bs").updateJS(this.$MercuryDispatcher2,n)}.bind(this))};l.prototype.$MercuryDispatcher3=function(n){__p&&__p();var o=n.payload_source;if(o===c("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS||o===c("MercuryPayloadSource").CLIENT_MARK_THREAD_SEEN)return;var p={from_client:n.from_client,messages:null};if(n.actions){var q=n.actions.filter(function(r){return r.action_type===c("MercuryActionType").USER_GENERATED_MESSAGE||r.action_type===c("MercuryActionType").LOG_MESSAGE}).map(function(r){return{action_type:r.action_type,other_user_fbid:r.other_user_fbid,thread_fbid:r.thread_fbid,message_id:r.message_id}});if(q.length)p.messages=q}k.debug("update:"+o,JSON.stringify(p))};var m=new(c("MercurySingletonProvider"))(l);f.exports=l}),null);
__d("MercuryActionStatus",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({UNSENT:0,SUCCESS:1,UNCONFIRMED:3,FAILED_UNKNOWN_REASON:4,UNABLE_TO_CONFIRM:5,RESENT:6,RESENDING:7,ERROR:10})}),null);
__d("MercuryAttachment",["cx","EmojiLikeUtils","MercuryAttachmentContentType","MercuryAttachmentType","MercuryAudioType","Set","StoryAttachmentStyle"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=function i(m){return m===Object(m)},j="_1c_u",k=new(c("Set"))([c("MercuryAttachmentType").ANIMATED_IMAGE,c("MercuryAttachmentType").PHOTO,c("MercuryAttachmentType").VIDEO,c("MercuryAttachmentType").THIRDPARTYSTICKER]),l={getAttachIconClass:function m(n){__p&&__p();switch(n){case c("MercuryAttachmentContentType").PHOTO:return"_y2-";case c("MercuryAttachmentContentType").VIDEO:return"_y2_";case c("MercuryAttachmentContentType").MUSIC:return"_y30";case c("MercuryAttachmentContentType").VOICE:return"_y31";case c("MercuryAttachmentContentType").TEXT:return"_y32";case c("MercuryAttachmentContentType").MSWORD:return"_y33";case c("MercuryAttachmentContentType").MSXLS:return"_y34";case c("MercuryAttachmentContentType").MSPPT:return"_y35"}return"_y36"},getAttachIconClassByMime:function m(n){return this.getAttachIconClass(this.getAttachTypeByMime(n))},getAttachTypeByMime:function m(n){__p&&__p();if(n.startsWith("image"))return c("MercuryAttachmentContentType").PHOTO;else if(n.startsWith("video"))return c("MercuryAttachmentContentType").VIDEO;else if(n.startsWith("audio"))return c("MercuryAttachmentContentType").MUSIC;else if(n.startsWith("text/plain"))return c("MercuryAttachmentContentType").TEXT;else if(n=="application/msword"||n.startsWith("application/vnd.ms-word")||n.startsWith("application/vnd.openxmlformats-officedocument.wordprocessingml"))return c("MercuryAttachmentContentType").MSWORD;else if(n.startsWith("application/vnd.ms-excel")||n.startsWith("application/vnd.openxmlformats-officedocument.spreadsheetml"))return c("MercuryAttachmentContentType").MSXLS;else if(n.startsWith("application/vnd.ms-powerpoint")||n.startsWith("application/vnd.openxmlformats-officedocument.presentationml"))return c("MercuryAttachmentContentType").MSPPT;else return c("MercuryAttachmentContentType").UNKNOWN},convertRaw:function m(n){__p&&__p();var o=[];for(var p=0;p<n.length;p++){var q=n[p];if(q.attach_type===c("MercuryAttachmentType").PHOTO)o.push(q);else if(q.filename){var r=l.getAttachTypeByMime(q.filetype),s={};s.attach_type=c("MercuryAttachmentType").FILE;s.name=q.filename;s.icon_type=r;s.url="";o.push(s)}}return o},get:function m(n){__p&&__p();var o=[];if(n.attachments)o=n.attachments;else if(n.raw_attachments)o=this.convertRaw(n.raw_attachments);var p=c("EmojiLikeUtils").getEmojiSize(n);if(p)o=o.concat([{attach_type:c("MercuryAttachmentType").EMOJI_LIKE,size:p}]);if(!(n.attachments&&n.attachments.length>0)){if(n.sticker_id)return o.concat([{attach_type:c("MercuryAttachmentType").STICKER}]);if(n.preview_attachments&&n.preview_attachments.length>0)return o.concat(n.preview_attachments)}return o},resizeContain:function m(n,o){var p=n.width/n.height,q=o.width/o.height;if(q<p)return{width:Math.ceil(Math.min(n.height*q,o.width)),height:Math.ceil(Math.min(n.height,o.height))};else return{width:Math.ceil(Math.min(n.width,o.width)),height:Math.ceil(Math.min(n.width/q,o.height))}},isBubblePreferred:function m(n){return this.isFileAttachment(n)},isPhotoAttachment:function m(n){return!!(n.attach_type==c("MercuryAttachmentType").PHOTO||n.attach_type==c("MercuryAttachmentType").ANIMATED_IMAGE||n.attach_type==c("MercuryAttachmentType").THIRDPARTYSTICKER||n.attach_type==c("MercuryAttachmentType").FILE&&n.preview_url)},isPhotoGroupAttachment:function m(n){return k.has(n.attach_type)},isSinglePhotoGroupAttachment:function m(n){return!!(n.attachments&&n.attachments.length===1&&n.attachments[0]&&this.isPhotoGroupAttachment(n.attachments[0]))},isVideoAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").VIDEO},isShareAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").SHARE},isFileAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").FILE},isErrorAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").ERROR},isStickerAttachment:function m(n){return n.attach_type==c("MercuryAttachmentType").STICKER},isEmojiLikeAttachment:function m(n){return n.attach_type===c("MercuryAttachmentType").EMOJI_LIKE},isVoiceAttachment:function m(n){if(!n.metadata)return false;return n.metadata.type===c("MercuryAudioType").AudioClip||n.metadata.type===c("MercuryAudioType").VoiceMessageWithTranscript},hasAttribution:function m(n){return!!n.app_attribution},isLightweightActionAttachment:function m(n){return l.isShareAttachment(n)&&n.share&&n.share.target!=null&&n.share.target.lwa_type!=null},isSingleVideoAttachment:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isVideoAttachment(p)}.bind(this));return o.length===1},isSharedVideoAttachment:function m(n){var o=n.attach_type===c("MercuryAttachmentType").SHARE&&n.share&&n.share.subattachments&&n.share.subattachments[0];return!!(o&&o.target&&o.target.video_id)},isGenieSharedVideoAttachment:function m(n){return!!(n.attach_type===c("MercuryAttachmentType").SHARE&&n.share&&n.share.style_list.indexOf(c("StoryAttachmentStyle").GENIE_MESSAGE)>-1&&n.share.target&&n.share.target.attachment&&this.isSharedVideoAttachment(n.share.target.attachment))},isSharedVideoAttachmentMessage:function m(n){var o=this.get(n).filter(i).filter(function(p){return this.isSharedVideoAttachment(p)||this.isGenieSharedVideoAttachment(p)}.bind(this));return o.length===1},getVideoElem:function m(n,o){var p=o.getMessageElement(n);if(!p)return null;var q=p.getElementsByClassName(j);return q&&q.length?q[0]:p}};f.exports=l}),null);
__d("MercurySendErrorLogger",["Banzai","BanzaiLogger"],(function a(b,c,d,e,f,g){var h=c("BanzaiLogger").create({retry:true}),i=c("Banzai").isEnabled("mercury_send_error_logging"),j={log:function k(l){if(!i)return;var m={message_id:l.message_id,timestamp_client:Date.now(),error_type:l.error_data.type,error_code:l.error_data.code,error_description:l.error_data.description,is_transient:l.error_data.is_transient};h.log("MercurySendErrorLoggerConfig",m)}};f.exports=j}),null);
__d("MercuryServerPayloadPreprocessor",["invariant","MessengerEnvironment","MercuryIDs","MercuryActionStatus","MercuryActionType","MercuryAttachment","MercuryDispatcher","MercurySendErrorLogger","MercurySingletonProvider","MercuryThreadIDMap","URI"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();function i(k){this.$MercuryServerPayloadPreprocessor1=k;this.$MercuryServerPayloadPreprocessor2=c("MercuryThreadIDMap").getForFBID(this.$MercuryServerPayloadPreprocessor1);this.$MercuryServerPayloadPreprocessor3=c("MercuryDispatcher").getForFBID(this.$MercuryServerPayloadPreprocessor1)}i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};i.prototype.handleUpdate=function(k){__p&&__p();var l={};!k.from_client||h(0);(k.threads||[]).forEach(function(x){this.$MercuryServerPayloadPreprocessor4(x,l);var y=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(x.thread_id);e(["MercuryServerRequests"],function(z){var A=z.getForFBID(this.$MercuryServerPayloadPreprocessor1);A.markThreadFetched(x.thread_id);if(y)A.markThreadFetched(y);A.updateLastActionTimestamp(x.timestamp)}.bind(this))}.bind(this));(k.work_top_named_threads||[]).forEach(function(x){this.$MercuryServerPayloadPreprocessor4(x,l);var y=this.$MercuryServerPayloadPreprocessor2.getServerIDFromClientIDNow(x.thread_id);e(["MercuryServerRequests"],function(z){var A=z.getForFBID(this.$MercuryServerPayloadPreprocessor1);A.markThreadFetched(x.thread_id);if(y)A.markThreadFetched(y);A.updateLastActionTimestamp(x.timestamp)}.bind(this))}.bind(this));(k.ordered_threadlists||[]).forEach(function(x){var y=x.thread_fbids||[];y=y.concat(x.other_user_fbids||[]);x.thread_ids=y.map(function(z){return this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(z.toString())}.bind(this))}.bind(this));if(k.delivery_receipts){var m={};for(var n=k.delivery_receipts,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var q;if(o){if(p>=n.length)break;q=n[p++]}else{p=n.next();if(p.done)break;q=p.value}var r=q,s=r.other_user_fbid?c("MercuryIDs").getThreadIDFromUserID(r.other_user_fbid):this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(r.thread_fbid);if(s)m[s]=r.time}k.delivery_receipts=m}k.actions=k.actions||[];k.actions.forEach(function(x){__p&&__p();if(x.action_type===c("MercuryActionType").SEND_MESSAGE&&x.status===c("MercuryActionStatus").ERROR)c("MercurySendErrorLogger").log(x);var y=null,z=null;if(x.other_user_fbid){z=c("MercuryIDs").getThreadIDFromUserID(x.other_user_fbid);y=x.other_user_fbid}else if(x.thread_fbid){z=c("MercuryIDs").getThreadIDFromThreadFBID(x.thread_fbid);y=x.thread_fbid}else if(x.thread_id){z=c("MercuryIDs").getThreadIDFromThreadFBID(x.thread_id);y=x.thread_id}else if(x.status&&x.status!=c("MercuryActionStatus").SUCCESS&&x.client_thread_id)z=x.client_thread_id;else h(0);y=y&&y.toString();x.thread_id=this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(y)?this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(y):z;if(x.action_type==c("MercuryActionType").SEND_MESSAGE&&x.client_thread_id&&y){x.thread_id=x.client_thread_id;this.$MercuryServerPayloadPreprocessor2.forceSetServerIDToClientID(y,x.client_thread_id);l[y]=x.client_thread_id}x.thread_id||h(0);if(!k.payload_source||!k.payload_source.startsWith("server"))e(["MercuryServerRequests"],function(A){A.getForFBID(this.$MercuryServerPayloadPreprocessor1).updateLastActionTimestamp(x.timestamp)}.bind(this))}.bind(this));this.$MercuryServerPayloadPreprocessor5(k);this.$MercuryServerPayloadPreprocessor6(k);if(k.end_of_history){var t=[];for(var u=0;u<k.end_of_history.length;u++){var v=k.end_of_history[u];if(v.type=="user")t.push("user:"+v.fbid);else if(v.type=="thread"&&this.$MercuryServerPayloadPreprocessor2.hasClientIDForServerID(v.fbid))t.push(this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(v.fbid))}k.end_of_history=t}if(k.roger){var w={};Object.keys(k.roger).forEach(function(x){__p&&__p();var y=Object.keys(k.roger[x]),z=void 0;if(x)z=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(x);else if(y.length===1)z=c("MercuryIDs").getThreadIDFromUserID(y[0]);if(z){var A=k.roger[x];w[z]={};for(var B in A)if(Object.prototype.hasOwnProperty.call(A,B)){var C=c("MercuryIDs").getParticipantIDFromUserID(B);w[z][C]=A[B]}}}.bind(this));k.roger=w}k.newlyAddedClientIDs=l;k.preprocessed=true;this.$MercuryServerPayloadPreprocessor3.handleUpdate(k)};i.prototype.$MercuryServerPayloadPreprocessor4=function(k,l){__p&&__p();var m=k.other_user_fbid?k.other_user_fbid:k.thread_fbid;m||h(0);var n=this.$MercuryServerPayloadPreprocessor2.getClientIDFromServerIDNow(m);if(!n){n=k.other_user_fbid?c("MercuryIDs").getThreadIDFromUserID(k.other_user_fbid):c("MercuryIDs").getThreadIDFromThreadFBID(k.thread_fbid);this.$MercuryServerPayloadPreprocessor2.setServerIDToClientID(m,n);this.$MercuryServerPayloadPreprocessor2.setDeprecatedServerIDToClientID(k.thread_id,n);l[m]=n}k.thread_id=n};i.prototype.$MercuryServerPayloadPreprocessor5=function(k){__p&&__p();k.actions.forEach(function(l){if(l.action_type===c("MercuryActionType").USER_GENERATED_MESSAGE){l.attachments=l.attachments||[];l.attachments.forEach(function(m){if(c("MercuryAttachment").isShareAttachment(m)&&c("MessengerEnvironment").messengerui){var n=new(c("URI"))(m.share.uri);if(!n.getDomain())m.share.uri=n.setDomain("facebook.com").setSubdomain(c("URI").getRequestURI().getSubdomain()).setProtocol("https").toString()}})}})};i.prototype.$MercuryServerPayloadPreprocessor6=function(k){__p&&__p();k.actions.forEach(function(l){__p&&__p();if(l.action_type!==c("MercuryActionType").USER_GENERATED_MESSAGE)return;var m=l;if(!m.has_attachment||!m.attachments)return;for(var n=m.attachments.length-1;n>=0;n-=1){var o=m.attachments[n];if(!o.share||!o.share.style_list||o.share.style_list[0]!="genie_message")continue;if(o.share.target.genie_id)m.author=c("MercuryIDs").getParticipantIDFromUserID(o.share.target.genie_id);if(o.share.target&&!o.share.target.attachment){m.attachments.splice(n,1);m.has_attachment=m.attachments.length>0}}})};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MercuryErrorType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({SERVER:1,TRANSPORT:2,TIMEOUT:3})}),null);
__d("MercuryGlobalActionType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({MARK_ALL_READ:"mga-type:mark-all-read",MARK_ALL_SEEN:"mga-type:mark-all-seen"})}),null);
__d("MercuryServerSendMessageQueueOptions",[],(function a(b,c,d,e,f,g){function h(i,j,k,l,m,n){"use strict";this.success_handler=i;this.error_handler=j;this.transport_error_handler=k;this.timeout_handler=l;this.timeout=m;this.connection_retries=n}f.exports=h}),null);
__d("MercuryServerSendMessageQueueSimulatedError",["AsyncRequest","AsyncResponse"],(function a(b,c,d,e,f,g){var h=9999,i={create:function j(k){var l=new(c("AsyncRequest"))(this.endpoint_uri).setData({message_batch:[k],client:this.client}),m=new(c("AsyncResponse"))(l,{});Object.assign(m,{error:h,silentError:false,transientError:true,request:l});return m}};f.exports=i}),null);
__d("XMessagingSendController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/messaging/send/",{})}),null);
__d("MercuryServerSendMessageQueue",["fbt","BanzaiODS","ChatReliabilityInstrumentation","LogHistory","MercuryLoggingHelper","MercuryServerRequestsConfig","MessengerAttachmentTransformerForSend.bs","Run","MercuryServerDispatcher","MercuryServerSendMessageQueueSimulatedError","XMessagingSendController","idx"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("LogHistory").getInstance("mercury_server_send_message_queue");function j(k,l,m,n){__p&&__p();var o;this.pending_message=null;this.queue=[];this.$MercuryServerSendMessageQueue5=function(){if(this.queue.length||this.pending_message)return h._("You haven't sent your message yet. Do you want to leave without sending?");return undefined}.bind(this);this.sender_id=k;this.queue_id=l;this.$MercuryServerSendMessageQueue2=m.success_handler;this.$MercuryServerSendMessageQueue1=m.error_handler;this.$MercuryServerSendMessageQueue4=m.transport_error_handler;this.$MercuryServerSendMessageQueue3=m.timeout_handler;this.client=n;c("Run").onBeforeUnload(this.$MercuryServerSendMessageQueue5,false);var p=null;if(c("MercuryServerRequestsConfig").msgrRegion)p={name:"X-MSGR-Region",value:c("MercuryServerRequestsConfig").msgrRegion};var q=c("XMessagingSendController").getURIBuilder().getURI().toString(),r=(o={},o[q]={request_user_id:this.sender_id,endpoint_id:this.queue_id,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:p,handler:this.handleSuccess.bind(this),error_handler:this.handleError.bind(this),transport_error_handler:this.handleTransportError.bind(this),timeout:m.timeout,timeout_handler:this.handleTimeout.bind(this),connection_retries:m.connection_retries},o);c("MercuryServerDispatcher").registerEndpoints(r)}j.prototype.enqueue=function(k){this.queue.push(k);this.$MercuryServerSendMessageQueue6()};j.prototype.$MercuryServerSendMessageQueue6=function(){__p&&__p();if(this.pending_message||!this.queue.length){if(this.pending_message)this.$MercuryServerSendMessageQueue7();return}this.pending_message=this.queue.shift();var k={client:this.client,action_type:this.pending_message.action_type,app_id:this.pending_message.app_id,audio_ids:this.pending_message.audio_ids,body:this.pending_message.body,client_thread_id:this.pending_message.client_thread_id,content_attachment:this.pending_message.content_attachment,ephemeral_ttl_mode:this.pending_message.ephemeral_ttl_mode,file_ids:this.pending_message.file_ids,gif_ids:this.pending_message.gif_ids,has_attachment:this.pending_message.has_attachment,image_ids:this.pending_message.image_ids,location_attachment:this.pending_message.location_attachment,lightweight_action_attachment:this.pending_message.lightweight_action_attachment,log_message_data:this.pending_message.log_message_data,log_message_type:this.pending_message.log_message_type,message_id:this.pending_message.message_id,message_source_data:this.pending_message.message_source_data,montage_reply_data:this.pending_message.montage_reply_data,offline_threading_id:this.pending_message.offline_threading_id,other_user_fbid:this.pending_message.other_user_fbid,photo_fbids:this.pending_message.photo_fbids,shareable_attachment:this.pending_message.shareable_attachment,signature_id:this.pending_message.signatureID,source:this.pending_message.source,specific_to_list:this.pending_message.specific_to_list,sticker_id:this.pending_message.sticker_id,tags:this.pending_message.tags,thread_fbid:this.pending_message.thread_fbid,timestamp:this.pending_message.timestamp,ui_push_phase:this.pending_message.ui_push_phase,video_ids:this.pending_message.video_ids,platform_xmd:this.pending_message.platform_xmd,profile_xmd:this.pending_message.profile_xmd};for(var l in k)if(k[l]===undefined||k[l]===null)delete k[l];if(!k.action_type){var m=c("MercuryLoggingHelper").obfuscateMessage(k);c("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller");i.debug("missing_action_type",JSON.stringify(m))}if(!k.message_id){var n=c("MercuryLoggingHelper").obfuscateMessage(k);c("ChatReliabilityInstrumentation").logERROR("missing action type before sending to send controller"+JSON.stringify(n));i.debug("missing_message_id",JSON.stringify(n))}c("MercuryServerDispatcher").trySend(c("XMessagingSendController").getURIBuilder().getURI().toString(),k,null,this.sender_id,this.queue_id)};j.prototype.$MercuryServerSendMessageQueue8=function(){while(this.queue.length)this.$MercuryServerSendMessageQueue9(this.queue.shift())};j.prototype.$MercuryServerSendMessageQueue9=function(k){this.$MercuryServerSendMessageQueue1(c("MercuryServerSendMessageQueueSimulatedError").create(k));i.error("mark_as_failed",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,message:c("MercuryLoggingHelper").obfuscateMessage(k)}))};j.prototype.handleSuccess=function(k,l){__p&&__p();var m=(k.actions||[]).map(function(n){__p&&__p();var o,p=babelHelpers["extends"]({},n);if(n.graphql_payload&&n.graphql_payload.length>0){var q=c("MessengerAttachmentTransformerForSend.bs").transform(this.sender_id,n.graphql_payload,n.for_page);p=Object.assign(p,{attachments:q})}var r=(o=n)!=null?(o=o.log_message_data)!=null?o.graphql_image:o:o;if(r){var s=c("MessengerAttachmentTransformerForSend.bs").transform(this.sender_id,[r],n.for_page);p=Object.assign(p,{log_message_data:{image:s[0]}})}return p}.bind(this));k.actions=m;this.$MercuryServerSendMessageQueue2(k,l);this.pending_message=null;this.$MercuryServerSendMessageQueue6()};j.prototype.handleError=function(k){this.$MercuryServerSendMessageQueue1(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.handleTransportError=function(k){this.$MercuryServerSendMessageQueue4(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.handleTimeout=function(k){this.$MercuryServerSendMessageQueue3(k);this.$MercuryServerSendMessageQueue8();this.pending_message=null};j.prototype.$MercuryServerSendMessageQueue7=function(){i.debug("maybe_send_next_pending_message",JSON.stringify({fbid:this.sender_id,queue_id:this.queue_id,pending_message:c("MercuryLoggingHelper").obfuscateMessage(this.pending_message),queue:this.queue.map(function(l){return c("MercuryLoggingHelper").obfuscateMessage(l)})}));var k="send_queue.delayed.queue_length."+this.queue.length.toString();c("BanzaiODS").bumpEntityKey("chat.web",k)};f.exports=j}),null);
__d("MercuryServerSendMessageQueueRouter",["BanzaiODS","LogHistory","Map","MercuryServerSendMessageQueue","MercurySingletonMixin"],(function a(b,c,d,e,f,g){__p&&__p();var h=c("LogHistory").getInstance("mercury_server_send_message_queue_router"),i="chat.web.send_queue_router";c("BanzaiODS").setEntitySample(i,.1);function j(k){"use strict";this.queues=new(c("Map"))();this.fbid=k}j.prototype.enqueue=function(k,l,m,n){"use strict";var o=this.queues.get(k);if(o===undefined){o=new(c("MercuryServerSendMessageQueue"))(this.fbid,k,l,m);this.queues.set(k,o);h.debug("added queue",JSON.stringify({fbid:this.fbid,queue_id:k}));c("BanzaiODS").bumpEntityKey(i,"new_queue")}o.enqueue(n)};Object.assign(j,c("MercurySingletonMixin"));f.exports=j}),null);
__d("MercurySourceType",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CHAT_ORCA:"source:chat:orca",CHAT_IPHONE:"source:chat:iphone",CHAT_JABBER:"source:chat:jabber",CHAT_MEEBO:"source:chat:meebo",CHAT_WEB:"source:chat:web",CHAT_TEST:"source:chat:test",CHAT_FORWARD_DIALOG:"source:chat:forward",CHAT:"source:chat",CONTACT_ADD_MUTATION:"source:contact_add:graphql_mutation",CONTACT_ADD_CYMK:"source:contact_add:cymk_suggestion",CUSTOMER_CHAT_PLUGIN:"source:discovery:customer_chat_plugin",EMAIL:"source:email",EVENT_MESSAGE_BLAST:"source:event_message_blast",EVENT_TICKETING:"source:event_ticket",EVENT_REMINDERS:"source:event_reminders",FUNDRAISER_MESSAGE_BLAST:"source:fundraiser_message_blast",GENERIC_ADMIN_TEXT:"source:generic_admin_text",GIGABOXX_API:"source:gigaboxx:api",GIGABOXX_BLAST:"source:gigaboxx:blast",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",GIGABOXX_MOBILE:"source:gigaboxx:mobile",GIGABOXX_WAP:"source:gigaboxx:wap",GIGABOXX_WEB:"source:gigaboxx:web",INVITE:"source:invite",LEIA:"source:leia",MESSENGER_WEB:"source:messenger:web",MESSENGER_WEB_SEARCH:"source:messenger:web_search",SAM_UFI:"source:sam:ufi",SHARE_DIALOG:"source:share:dialog",SEND_PLUGIN:"source:sendplugin",SMS:"source:sms",TEST:"source:test",TITAN_WAP:"source:titan:wap",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_FREE:"source:titan:m_free_basic",TITAN_M_JAPAN:"source:titan:m_japan",TITAN_M_MINI:"source:titan:m_mini",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_M_APP:"source:titan:m_app",TITAN_M_TABLET:"source:titan:m_tablet",TITAN_M_ZERO:"source:titan:m_zero",TITAN_M_TALK:"source:titan:m_talk",TITAN_WEB:"source:titan:web",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",TITAN_API:"source:titan:api",TITAN_API_MOBILE:"source:titan:api_mobile",TITAN_ORCA:"source:titan:orca",TITAN_EMAIL_REPLY:"source:titan:emailreply",MOBILE:"source:mobile",PAGE_PLATFORM_API:"source:page_platform_api",PAGE_UNIFIED_INBOX:"source:page_unified_inbox",UNKNOWN:"source:unknown",WEB:"source:web",HELPCENTER:"source:helpcenter",NEW_SHARE_DIALOG:"source:share:dialog:new",PAID_PROMOTION:"source:paid_promotion",BUFFY_SMS:"source:buffy:sms",WEBRTC_MOBILE:"source:webrtc:mobile",MESSENGER_COMMERCE:"source:messenger:commerce",MESSENGER_BOT:"source:bot",MESSENGER_EMPLOYEE_ONLY_BOT:"source:bot:employee_only",MESSENGER_OMNIM:"source:messenger:omnim",PAGES_PRIVATE_REPLY:"source:pages:private_reply",MESSENGER_FORWARD_DIALOG:"source:messenger:forward",MESSENGER_AD:"source:messenger:ad",MARKETPLACE:"source:marketplace",MESSENGER_LEAD_GEN:"source:messenger:lead_gen",PAGES_MESSAGE_SHORTLINK:"source:pages:message_shortlink",STICKER_SUBSCRIBE:"source:messenger:sticker_subscribe",PHOTO_TAG:"source:messenger:photo_tag",INTERNAL_TEST_PENDING:"source:internal:test_pending",JOB_SEARCH_APPLICATION:"source:job_search:application",MESSENGER_JOINABLE_LINK:"source:messenger:joinable_link",MESSENGER_ADD_WITH_APPROVAL:"source:messenger:add_with_approval",MESSENGER_SMS_BRIDGE_CONVERT:"source:messenger:sms_bridge_conversion",TINCAN_ORCA:"source:tincan:orca",TINCAN_IOS:"source:tincan:ios",TINCAN_UNKNOWN:"source:tincan:unknown",FACEBOOK_GROUPS_CHANNELS:"source:groups:channels",GROUP_COMMERCE:"source:group_commerce",INTERNAL_TOOL:"source:internal:tool",PAGES_PLATFORM:"source:pages:platform",PAGES_RECOMMENDATION:"source:pages:recommendation",PAGES_ORDER_MANAGEMENT:"source:pages:order_management",PAGE_AUTO_RESPONSE:"source:pages:auto_response",PAGES_INVITE:"source:pages:invite",PAGES_CHAT_EXTENSION:"source:pages:chat_extension",SAVED_CHAT_EXTENSION:"source:saved:chat_extension",CREATOR_PAGE_INITIATE_TO_CREATOR_PAGE:"source:pages:creator_page_initiate_to_creator_page",LIVE_VIDEO_CHAT:"source:live_video_chat",FRIENDING_ADMIN_BUMP:"source:messenger_growth:friending_admin_bump",NEW_MESSENGER_USER_ADMIN_BUMP:"source:messenger_growth:new_messenger_user_admin_bump",EVENT_UPCOMING_BUMP:"source:messenger_growth:event_upcoming_bump",PHOTO_TAG_BUMP:"source:messenger_growth:photo_tag_bump",WALL_POST_BUMP:"source:messenger_growth:wall_post_bump",CUSTOMIZATION_UPSELL_BUMP:"source:messenger_growth:customization_upsell_bump",PAGE_COMMENT_MSG:"source:pages:question_triggered_convo",COMMENT_PIVOT:"source:messenger_growth:comment_pivot",PAGE_HOVERCARD:"source:pages:hovercard",INSTANT_GAMES:"source:instant_games",PAGE_EMAIL_REPLY:"source:pages:email_reply",PAGE_HOME_PAGE_PANEL:"source:page_home_page_panel",GROUPSYNC_MESSENGER_GROUP_CREATE:"source:groupsync:messenger_group_create",GROUPSYNC_SYNC_FROM_FB:"source:groupsync:sync_from_fb",GROUPSYNC_NAMING:"source:groupsync:naming",PAGE_PQI_MESSAGE:"source:pages:pqi_message"})}),null);
__d("MercurySyncConstants",[],(function a(b,c,d,e,f,g){"use strict";var h=Object.freeze({ARBITER_EVENT_INVALID_STATE:"SYNC:INVALID_STATE",ARBITER_EVENT_INVALID_STATE_RETRY:"SYNC:INVALID_STATE_RETRY",ARBITER_EVENT_INVALID_STATE_RECOVER:"SYNC:INVALID_STATE_RECOVER",ARBITER_EVENT_SERVER_REQUESTS_FAIL:"NET:SERVER_REQUESTS_FAIL",ARBITER_EVENT_SERVER_REQUESTS_RECOVER:"NET:SERVER_REQUESTS_RECOVER"});f.exports=h}),null);
__d("MercurySyncDeltaHolder",["Map","MercurySingletonProvider"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.$MercurySyncDeltaHolder2=new(c("Map"))();this.$MercurySyncDeltaHolder3=[];this.$MercurySyncDeltaHolder1=0}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.peek=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(j,k){return j-k});return this.$MercurySyncDeltaHolder3[0]};h.prototype.getTop=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(j,k){return j-k});return this.$MercurySyncDeltaHolder3.reverse()[0]};h.prototype.pop=function(){this.$MercurySyncDeltaHolder3=this.$MercurySyncDeltaHolder3.sort(function(l,m){return l-m});if(this.$MercurySyncDeltaHolder3.length===0)return undefined;var j=this.$MercurySyncDeltaHolder3.shift(),k=this.$MercurySyncDeltaHolder2.get(j);this.$MercurySyncDeltaHolder2["delete"](j);return{seqID:j,delta:k}};h.prototype.push=function(j,k){if(this.$MercurySyncDeltaHolder2.has(j))return;this.$MercurySyncDeltaHolder2.set(j,k);this.$MercurySyncDeltaHolder3.push(j)};h.prototype.getLastSeqID=function(){return this.$MercurySyncDeltaHolder1};h.prototype.updateLastSeqID=function(j){this.$MercurySyncDeltaHolder1=j};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("PageMessageEnumTag",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({FLAG:"flag",IMPORTANT:"important",LOW_VALUE:"low_value",SPAM_SPOOFING:"spam_spoofing",JOB_APPLICATION:"job_application",CONFIRMED_APPOINTMENT:"confirmed_appointment",PENDING_APPOINTMENT:"pending_appointment",REQUESTED_APPOINTMENT:"requested_appointment",MESSENGER_ADS:"messenger_ads"})}),null);
__d("XMercuryUnseenThreadIDsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/mercury/unseen_thread_ids/",{})}),null);
__d("XMessagingChangeMentionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/mercury/change_mentions_mute_thread/",{})}),null);
__d("XMessagingChangeReactionsMuteModeController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/mercury/change_reactions_mute_thread/",{})}),null);
__d("MercuryServerRequests",["errorCode","invariant","Arbiter","AsyncResponse","BanzaiODS","ChannelConstants","ChatReliabilityInstrumentation","CurrentUser","FBJSON","EventProfiler","LogHistory","MercuryActionStatus","MercuryActionType","MercuryAPIArgsSource","MercuryAssert","MercuryConfig","MercuryDispatcher","MercuryErrorType","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySendErrorLogger","MercuryServerPayloadPreprocessor","MercuryServerRequestsConfig","MercuryServerSendMessageQueueRouter","MercuryServerURIs","MercurySingletonProvider","MercurySourceType","MercurySyncDeltaHolder","MercurySyncConstants","MercuryThreadIDMap","MercuryThreadlistConstants","MercuryMessageIDs.bs","MessagingConfig","MessagingTag","PageMessageEnumTag","MercuryServerSendMessageQueueOptions","MercuryServerDispatcher","Set","XMercuryUnseenThreadIDsController","XMessagingChangeMentionsMuteModeController","XMessagingChangeReactionsMuteModeController","createObjectFrom","gkx","ifRequired","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=c("LogHistory").getInstance("mercury_server"),k=c("MercuryAPIArgsSource").MERCURY,l=1e3,m=30*1e3,n=true;function o(z){return z.getError()?"_"+z.getError():""}function p(z,A){__p&&__p();var B=babelHelpers["extends"]({},z),C=void 0;if(A.threads){if(!B.threads)B.threads={};for(C in A.threads)B.threads[C]=Object.keys(c("createObjectFrom")((B.threads[C]||[]).concat(A.threads[C]||[])))}if(A.messages){if(!B.messages)B.messages={};for(C in A.messages){if(!B.messages[C])B.messages[C]={};for(var D in A.messages[C])if(B.messages[C][D])B.messages[C][D]=t(B.messages[C][D],A.messages[C][D]);else B.messages[C][D]=A.messages[C][D]}}B.client=z.client||A.client;return B}function q(z,A){var B=Object.assign(c("createObjectFrom")(z.folders,true),c("createObjectFrom")(A.folders,true)),C=z.client||A.client;return{folders:Object.keys(B),client:C}}function r(z,A){for(var B in A)if(z[B]&&typeof z[B]==="object")z[B]=t(z[B],A[B]);else if(A[B]&&typeof A[B]==="object"){var C={};Object.assign(C,A[B]);z[B]=C}return z}function s(z,A){return A}function t(z,A){var B=z.offset<A.offset?z.offset:A.offset,C=z.offset+z.limit,D=A.offset+A.limit,E=C>D?C:D,F=E-B,G=z.timestamp>A.timestamp?z.timestamp:A.timestamp;return{offset:B,limit:F,timestamp:G}}function u(z,A){var B=z.client||A.client,C={ids:{},client:B};Object.assign(C.ids,z.ids,A.ids);return C}function v(z,A){__p&&__p();var B={},C=void 0,D=z.client||A.client;delete z.client;delete A.client;for(C in z)Object.assign(B,c("createObjectFrom")(z[C],C));for(C in A)Object.assign(B,c("createObjectFrom")(A[C],C));var E={client:D};for(var F in B){C=B[F];if(!E[C])E[C]=[];E[C].push(F)}return E}function w(z,A){var B=z.client||A.client,C=c("createObjectFrom")(z.ids,true),D=c("createObjectFrom")(A.ids,true),E=Object.assign(C,D);return{ids:Object.keys(E),client:B}}function x(z){__p&&__p();this.$MercuryServerRequests1=z;this.$MercuryServerRequests2=0;this.$MercuryServerRequests3={};this.$MercuryServerRequests4={};this.$MercuryServerRequests9=new(c("Set"))();this.__threadIDMap=c("MercuryThreadIDMap").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests5=c("MercuryDispatcher").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests6=c("MercuryServerPayloadPreprocessor").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests7=new(c("MercuryServerSendMessageQueueOptions"))(function(A,B){this.__handleUpdate(A,B)}.bind(this),function(A){return this.$MercuryServerRequests10(A)}.bind(this),function(A){this.$MercuryServerRequests11(A)}.bind(this),function(A){return this.$MercuryServerRequests12(A)}.bind(this),c("MercuryServerRequestsConfig").sendMessageTimeout,c("MessagingConfig").SEND_CONNECTION_RETRIES);this.$MercuryServerRequests8=c("MercurySyncDeltaHolder").getForFBID(this.$MercuryServerRequests1);this.$MercuryServerRequests13()}x.getForFBID=function(z){return y.getForFBID(z)};x.get=function(){return y.get()};x.prototype.fetchThreadlistInfo=function(z,A){__p&&__p();var B=arguments.length<=2||arguments[2]===undefined?c("MessagingTag").INBOX:arguments[2],C=arguments[3],D=arguments.length<=4||arguments[4]===undefined?k:arguments[4],E=arguments[5];if(n){n=false;c("EventProfiler").tagCurrentActiveInteractionsAs("FirstMercuryThreadFetch")}var F=C?c("MercuryServerDispatcher").IMMEDIATE:null;if(c("MercuryConfig").MessengerInboxRequests&&!F&&c("gkx")("AT6k4q_FpxHOg5pke0cIeoOSz9TDOKLGTv6uQmXW3Apzeacou2FfBIyiYS2xi1X396k4nIwSLJ6rBI1n0hbeA_ij"))F=c("MercuryServerDispatcher").BATCH_DEFERRED_MULTI;var G={client:D};G[B]={offset:z,limit:A,filter:C,before:E};this.__sendRequest(c("MercuryServerURIs").THREADLIST_INFO,G,F)};x.prototype.fetchUnseenThreadIDs=function(){var z=arguments.length<=0||arguments[0]===undefined?c("MessagingTag").INBOX:arguments[0],A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString(),{})};x.prototype.fetchUnreadThreadIDs=function(z){var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];this.__sendRequest(c("MercuryServerURIs").UNREAD_THREADS,{folders:[z],client:A})};x.prototype.fetchThreadData=function(z){__p&&__p();var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];c("MercuryAssert").allThreadID(z);var B={threads:{},client:A},C=[],D=[];z.forEach(function(F){__p&&__p();if(this.$MercuryServerRequests3[F])return;this.$MercuryServerRequests3[F]=true;var G=this.__threadIDMap.getServerIDFromClientIDNow(F),H=c("MercuryIDs").tokenize(F);if(H.type=="user"){C.push(H.value);B.threads.user_ids=C}else if(H.type=="thread"){if(G)D.push(G);else D.push(H.value);B.threads.thread_fbids=D}else if(H.type=="root"){if(G){D.push(G);B.threads.thread_fbids=D}}else if(H.type!="pending")throw new Error("Unknown thread type",H)}.bind(this));this.$MercuryServerRequests5.inform("fetch-thread-data",B);if(B.threads.user_ids)B.threads.user_ids.forEach(function(F){if(!F){j.error("empty user id",JSON.stringify(C));c("ChatReliabilityInstrumentation").logERROR("Invalid user ID sent to thread_info.php: "+JSON.stringify(C))}});if(B.threads.thread_fbids)B.threads.thread_fbids.forEach(function(F){if(!F)c("ChatReliabilityInstrumentation").logERROR("Invalid FBID sent to thread_info.php: "+JSON.stringify(z))});for(var E in B.threads){this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,B);break}};x.prototype.ensureThreadIsFetched=function(z){__p&&__p();var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!this.__threadIDMap.getClientIDFromServerIDNow(z)&&!this.$MercuryServerRequests3[z]){if(!z){c("ChatReliabilityInstrumentation").logERROR("Ensure invalid FBID sent to thread_info.php");j.error("attempting to fetch empty thread_fbid. Bad idea!");return}this.$MercuryServerRequests3[z]=true;this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,{threads:{thread_fbids:[z]},client:A})}};x.prototype.fetchThreadMessages=function(z,A,B,C,D){__p&&__p();var E=arguments.length<=5||arguments[5]===undefined?k:arguments[5];c("MercuryAssert").isThreadID(z);var F=void 0,G=void 0,H=c("MercuryIDs").tokenize(z),I=this.__threadIDMap.getServerIDFromClientIDNow(z),J=false;if(I){F=I;G=H.type=="user"?"user_ids":"thread_fbids"}else{F=H.value;switch(H.type){case"user":G="user_ids";J=true;break;case"thread":G="thread_fbids";break}}var K={messages:{},threads:{},client:E};if(G){K.messages[G]={};K.messages[G][F]={offset:A,timestamp:C,limit:B};if(J)K.threads[G]=[F];this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,K,D)}else this.__threadIDMap.getServerIDFromClientID(z,function(L){K.messages.thread_fbids={};K.messages.thread_fbids[L]={offset:A,timestamp:C,limit:B};this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,K,D)}.bind(this))};x.prototype.handleThreadInfoError=function(z,A){__p&&__p();var B,C=this,D=z.getData(),E=[];if(D.messages){for(var F in D.messages.thread_fbids){var G=this.__threadIDMap.getClientIDFromServerIDNow(F);if(G)E.push(this.$MercuryServerRequests14(G))}for(var H in D.messages.user_ids)E.push(this.$MercuryServerRequests14("user:"+H));for(var I in D.messages.group_ids)E.push(this.$MercuryServerRequests14("group:"+I))}if(E.length)this.$MercuryServerRequests5.handleUpdate({actions:E,from_client:true,payload_source:c("MercuryPayloadSource").CLIENT_CHANNEL_MESSAGE});if(D.threads&&(D.threads.user_ids||D.threads.thread_fbids||D.threads.group_ids||D.threads.thread_ids)){var J=5,K=true;if(!D.retry_count){D.retry_count=0;if(D.messages)delete D.messages}else if(D.retry_count>=J&&(!A||!c("gkx")("AT6272W7G37c2zZOpPDUPGXaehXUPvo7_ZqAqdSAoKzgP5DQ8Luz0w5hQkLZeaPa8UmuuAXTSUI8FctXnbHnbKTw"))){K=false;(D.threads.thread_ids||[]).concat(D.threads.thread_fbids||[]).forEach(function(M){if(M in this.$MercuryServerRequests3)delete this.$MercuryServerRequests3[M]},this)}[].concat(D.threads.thread_ids||[],D.threads.thread_fbids||[],D.threads.user_ids||[],D.threads.group_ids||[]).forEach(function(M){if(M)this.$MercuryServerRequests9.add(M);else c("ChatReliabilityInstrumentation").logERROR("lost a thread id somehow")}.bind(this));if(K){var L=Math.pow(2,Math.min(D.retry_count,J))*1e3;c("setTimeoutAcrossTransitions")(function(){j.log("retry_thread","{}");this.__sendRequest(c("MercuryServerURIs").THREAD_INFO,D)}.bind(this),L);D.retry_count++}if(this.$MercuryServerRequests9.size)(function(){var M=[];C.$MercuryServerRequests9.forEach(function(N){return M.push(N)});j.debug("failed threads",JSON.stringify(M));c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_FAIL,M)})()}};x.prototype.markFolderAsRead=function(z){this.__sendRequest(c("MercuryServerURIs").MARK_FOLDER_READ,{folder:z});var A=[{action_type:c("MercuryGlobalActionType").MARK_ALL_READ,folder:z}];this.$MercuryServerRequests5.handleUpdate({global_actions:A,from_client:true,payload_source:c("MercuryPayloadSource").CLIENT_CHANGE_READ_STATUS})};x.prototype.changeThreadReadStatus=function(z,A,B,C,D,E){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(F){var G,H={ids:(G={},G[F]=A,G),source:B,watermarkTimestamp:C,shouldSendReadReceipt:D,commerce_last_message_type:E};j.log("initiate_change_read_status",JSON.stringify({thread_id:z,thread_fbid:F,mark_as_read:A,watermarkTimestamp:C}));this.__sendRequest(c("MercuryServerURIs").CHANGE_READ_STATUS,H)}.bind(this))};x.prototype.changeThreadArchivedStatus=function(z,A,B){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(C){var D={ids:{},source:B};D.ids[C]=A;this.__sendRequest(c("MercuryServerURIs").CHANGE_ARCHIVED_STATUS,D)}.bind(this))};x.prototype.changeThreadPageFollowUpStatus=function(z,A,B){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(C){var D={ids:{},source:B};D.ids[C]=A;this.__sendRequest(c("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS,D)}.bind(this))};x.prototype.changeThreadFolder=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){var C={};C[A]=[B];this.__sendRequest(c("MercuryServerURIs").MOVE_THREAD,C)}.bind(this))};x.prototype.changeMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").CHANGE_MUTE_THREAD,{thread_fbid:B,mute_settings:A,payload_source:k})}.bind(this))};x.prototype.changeMentionsMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:B,mentions_mute_mode:A,payload_source:k})}.bind(this))};x.prototype.changeReactionsMutingOnThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI(),{thread_fbid:B,reactions_mute_mode:A,payload_source:k})}.bind(this))};x.prototype.markThreadSpam=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").MARK_SPAM,{id:B,source:A})}.bind(this))};x.prototype.unmarkThreadSpam=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){this.__sendRequest(c("MercuryServerURIs").UNMARK_SPAM,{id:B,source:A})}.bind(this))};x.prototype.deleteThread=function(z,A){c("MercuryAssert").isThreadID(z);this.__threadIDMap.getServerIDFromClientID(z,function(B){var C={ids:[B],source:A};this.__sendRequest(c("MercuryServerURIs").DELETE_THREAD,C)}.bind(this))};x.prototype.deleteMessages=function(z,A){c("MercuryMessageIDs.bs").getServerIDs(A||[],function(B){this.__sendRequest(c("MercuryServerURIs").DELETE_MESSAGES,{message_ids:B})}.bind(this))};x.prototype.sendDeliveryReceipts=function(z,A){c("MercuryMessageIDs.bs").getServerIDs(z||[],function(B){this.__sendRequest(c("MercuryServerURIs").DELIVERY_RECEIPTS,{message_ids:B,thread_ids:A})}.bind(this))};x.prototype.sendNewMessage=function(z){__p&&__p();var A=arguments.length<=1||arguments[1]===undefined?k:arguments[1];if(!z.offline_threading_id)c("BanzaiODS").bumpEntityKey("chat.web","missing_otid_on_send");if(z.client_state&&z.client_state!==c("MercuryMessageClientState").SEND_TO_SERVER)return;var B=c("MercuryIDs").tokenize(z.thread_id),C=B.type,D=babelHelpers["extends"]({},z);D.thread_id=null;if(C=="user"){D.other_user_fbid=B.value;this.$MercuryServerRequests15(D,A)}else if(C=="thread"){D.thread_fbid=B.value;this.$MercuryServerRequests15(D,A)}else if(C=="root"&&B.value==D.offline_threading_id){D.client_thread_id=z.thread_id;this.$MercuryServerRequests15(D,A)}else{c("MercuryIDs").isLocalThread(z.thread_id)||i(0);this.__threadIDMap.getServerIDFromClientID(z.thread_id,function(E){D.thread_fbid=E;this.$MercuryServerRequests15(D,A)}.bind(this))}c("ChatReliabilityInstrumentation").logMESSAGE_SEND_START(c("FBJSON").stringify({otid:D.offline_threading_id,message_id:D.message_id,other_user_fbid:D.other_user_fbid,viewer_page_fbid:!D.creator_info?null:D.creator_info.pageID}))};x.prototype.$MercuryServerRequests15=function(z,A){c("Arbiter").inform(c("ChannelConstants").ATTEMPT_RECONNECT);this.$MercuryServerRequests4[z.message_id]=Date.now();c("MercuryServerSendMessageQueueRouter").getForFBID(this.$MercuryServerRequests1).enqueue(z.other_user_fbid||z.thread_fbid||z.client_thread_id,this.$MercuryServerRequests7,A,z)};x.prototype.markSeen=function(){var z=this.$MercuryServerRequests2;this.__sendRequest(c("MercuryServerURIs").MARK_SEEN,{seen_timestamp:z})};x.prototype.$MercuryServerRequests16=function(z,A,B,C){__p&&__p();var D=z.getData(),E=D.message_batch||[D];j.debug("handle_send_message_error_common",JSON.stringify({reliability_error_status:B,request_error_status:A,error_data:C,message_list:E}));var F=E.map(function(H){var I={action_type:c("MercuryActionType").SEND_MESSAGE,other_user_fbid:H.other_user_fbid,thread_fbid:H.thread_fbid,client_message_id:H.message_id,message_id:H.message_id,client_thread_id:H.client_thread_id,status:A,error_data:C};return I});F.forEach(function(H){if(H.action_type===c("MercuryActionType").SEND_MESSAGE&&H.status===c("MercuryActionStatus").ERROR)this.__logMercurySendError(H)},this);var G={actions:F,payload_source:c("MercuryPayloadSource").CLIENT_HANDLE_ERROR};this.$MercuryServerRequests6.handleUpdate(G)};x.prototype.handleSendMessageError=function(z){__p&&__p();var A=z.getPayload(),B=null,C=null;if(A&&A.error_payload){B=c("MercuryActionStatus").UNCONFIRMED;C="send_error"}else{B=c("MercuryActionStatus").ERROR;C="request_error"+o(z)}var D=z.error;if(D===1404102)c("AsyncResponse").verboseErrorHandler(z);var E=/<.*>/.test(z.getErrorDescription())?z.getErrorSummary():z.getErrorDescription();this.$MercuryServerRequests16(z.getRequest(),B,C,{type:c("MercuryErrorType").SERVER,code:z.getError(),description:E,is_transient:z.isTransient()})};x.prototype.handleSendMessageTransportError=function(z){this.$MercuryServerRequests16(z.getRequest(),c("MercuryActionStatus").ERROR,"transport_error"+o(z),{type:c("MercuryErrorType").TRANSPORT,code:z.getError(),is_transient:true})};x.prototype.handleSendMessageTimeout=function(z){this.$MercuryServerRequests16(z,c("MercuryActionStatus").ERROR,"transport_timeout",{type:c("MercuryErrorType").TIMEOUT,is_transient:true})};x.prototype.getLastActionTimestamp=function(){return this.$MercuryServerRequests2};x.prototype.__logMercurySendError=function(z){c("MercurySendErrorLogger").log(z)};x.prototype.updateLastActionTimestamp=function(z){var A=Date.now()-1e3*60*60*24;if(z&&z>A)this.$MercuryServerRequests2=Math.max(this.$MercuryServerRequests2,z)};x.prototype.markThreadFetched=function(z){delete this.$MercuryServerRequests3[z];if(this.$MercuryServerRequests9["delete"](z)&&!this.$MercuryServerRequests9.size){j.debug("no_failed_threads","{}");c("Arbiter").inform(c("MercurySyncConstants").ARBITER_EVENT_SERVER_REQUESTS_RECOVER)}};x.prototype.$MercuryServerRequests14=function(z){return{action_type:c("MercuryActionType").LOG_MESSAGE,thread_id:z,message_id:z,timestamp:Date.now(),is_unread:false,source:c("MercurySourceType").UNKNOWN,log_message_body:"",log_message_type:c("MercuryLogMessageType").SERVER_ERROR,log_message_data:{}}};x.prototype.__getForAsyncRequest=function(z){var A=z.getData(),B=A.request_user_id?A.request_user_id:c("CurrentUser").getID();return x.getForFBID(B)};x.prototype.__handleUpdate=function(z,A){this.__getForAsyncRequest(A).$MercuryServerRequests6.handleUpdate(z)};x.prototype.$MercuryServerRequests17=function(z){var A=this.__getForAsyncRequest(z);A.handleThreadInfoError(z)};x.prototype.$MercuryServerRequests18=function(z){var A=this.__getForAsyncRequest(z);A.handleThreadInfoError(z,true)};x.prototype.$MercuryServerRequests10=function(z){var A=this.__getForAsyncRequest(z.getRequest());A.handleSendMessageError(z)};x.prototype.$MercuryServerRequests11=function(z){var A=this.__getForAsyncRequest(z.getRequest());A.handleSendMessageTransportError(z)};x.prototype.$MercuryServerRequests12=function(z){var A=this.__getForAsyncRequest(z);A.handleSendMessageTimeout(z)};x.prototype.$MercuryServerRequests13=function(){__p&&__p();var z,A=null;if(c("MercuryServerRequestsConfig").msgrRegion)A={name:"X-MSGR-Region",value:c("MercuryServerRequestsConfig").msgrRegion};var B=(z={},z[c("MercuryServerURIs").THREAD_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,customHeader:A,batch_function:p,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this),error_handler:function(F){return this.$MercuryServerRequests17(F.getRequest())}.bind(this),timeout_handler:function(F){return this.$MercuryServerRequests18(F)}.bind(this),timeout:m},z[c("MercuryServerURIs").MARK_FOLDER_READ]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_READ_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){this.__handleUpdate(F,G);var H=(F.threads||[]).map(function(I){return I&&I.thread_id});j.log("response_change_read_status",JSON.stringify({threads:H}))}.bind(this)},z[c("MercuryServerURIs").MARK_SEEN]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:s,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").THREADLIST_INFO]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:A,batch_function:r,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").MARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").UNMARK_SPAM]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").UNREAD_THREADS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE_UNIQUE,customHeader:A,batch_function:q,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_ARCHIVED_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:u,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_PAGE_FOLLOW_UP_STATUS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:u,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELETE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:w,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELETE_MESSAGES]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").DELIVERY_RECEIPTS]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").MOVE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").BATCH_SUCCESSIVE,customHeader:A,batch_function:v,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z[c("MercuryServerURIs").CHANGE_MUTE_THREAD]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)},z),C=c("XMercuryUnseenThreadIDsController").getURIBuilder().getURI().toString();B[C]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};var D=c("XMessagingChangeMentionsMuteModeController").getURIBuilder().getURI().toString();B[D]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};var E=c("XMessagingChangeReactionsMuteModeController").getURIBuilder().getURI().toString();B[E]={request_user_id:this.$MercuryServerRequests1,mode:c("MercuryServerDispatcher").IMMEDIATE,customHeader:A,handler:function(F,G){return this.__handleUpdate(F,G)}.bind(this)};c("MercuryServerDispatcher").registerEndpoints(B)};x.prototype.__sendRequest=function(z,A,B){if(c("gkx")("AT5ciOxCuhvQiPHB-OF0aBC8VDwgTuUgU0qCNeLTy9HW8OGAaj6YECdnrVkZOqNRHzX5-Wxrb9FeQ1ToJxYOvCPs"))switch(z){case c("MercuryServerURIs").THREADLIST_INFO:case c("MercuryServerURIs").THREAD_INFO:A.cachius_min_seq_id=this.$MercuryServerRequests8.getLastSeqID();break;default:break}c("MercuryServerDispatcher").trySend(z,A,B,this.$MercuryServerRequests1)};x.prototype.__getFBID=function(){return this.$MercuryServerRequests1};var y=new(c("MercurySingletonProvider"))(x);f.exports=x}),null);
__d("MercuryThreadIDMap",["KeyedCallbackManager","MercuryAssert","MercuryIDs","MercurySingletonProvider"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(j){this.$MercuryThreadIDMap1=j;this.$MercuryThreadIDMap2=new(c("KeyedCallbackManager"))();this.$MercuryThreadIDMap3=new(c("KeyedCallbackManager"))()}h.getForFBID=function(j){return i.getForFBID(j)};h.get=function(){return i.get()};h.prototype.setServerIDToClientID=function(j,k){var l=this.getClientIDFromServerIDNow(j);if(l){l!==k;return}this.forceSetServerIDToClientID(j,k)};h.prototype.forceSetServerIDToClientID=function(j,k){this.$MercuryThreadIDMap2.setResource(j,k);this.$MercuryThreadIDMap3.setResource(k,j)};h.prototype.setDeprecatedServerIDToClientID=function(j,k){if(j)this.$MercuryThreadIDMap2.setResource(j,k)};h.prototype.getClientIDFromServerIDNow=function(j){return this.$MercuryThreadIDMap2.getResource(j)};h.prototype.getClientIDFromServerID=function(j,k){this.$MercuryThreadIDMap2.executeOrEnqueue(j,k);e(["MercuryServerRequests"],function(l){l.getForFBID(this.$MercuryThreadIDMap1).ensureThreadIsFetched(j)}.bind(this))};h.prototype.getServerIDFromClientIDNow=function(j){return this.$MercuryThreadIDMap3.getResource(j)};h.prototype.getServerIDFromClientID=function(j,k){c("MercuryAssert").isThreadID(j);var l=this.$MercuryThreadIDMap3.executeOrEnqueue(j,k);e(["MercuryServerRequests"],function(m){var n=this.$MercuryThreadIDMap3.getUnavailableResources(l),o=c("MercuryIDs").tokenize(j);if(n.length&&o.type!="root")m.getForFBID(this.$MercuryThreadIDMap1).fetchThreadData(n)}.bind(this))};h.prototype.hasClientIDForServerID=function(j){return!!this.getClientIDFromServerIDNow(j)};h.prototype.convertThreadIDIfAvailable=function(j){var k=this.getClientIDFromServerIDNow(j);return k||j};h.prototype.canLinkExternally=function(j){c("MercuryAssert").isThreadID(j);var k=c("MercuryIDs").tokenize(j);return k.type=="user"||!!this.getServerIDFromClientIDNow(j)};var i=new(c("MercurySingletonProvider"))(h);f.exports=h}),null);
__d("MercuryParticipantFetcher",["LogHistory","MercuryIDs","MercuryPayloadSource","MercuryServerPayloadPreprocessor","Set","ShortProfiles","setImmediate","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("LogHistory").getInstance("short_profiles");function i(k){this.$MercuryParticipantFetcher4=c("MercuryServerPayloadPreprocessor").getForFBID(k);this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2=new(c("Set"))();this.$MercuryParticipantFetcher3=new(c("Set"))();this.$MercuryParticipantFetcher5=setInterval(this.$MercuryParticipantFetcher7.bind(this),20*1e3)}i.prototype.fetch=function(k){this.$MercuryParticipantFetcher8(k);this.$MercuryParticipantFetcher7()};i.prototype.fetchMulti=function(k){if(k.length){k.forEach(function(l){return this.$MercuryParticipantFetcher8(l)}.bind(this));this.$MercuryParticipantFetcher7()}};i.prototype.$MercuryParticipantFetcher8=function(k){if(!this.$MercuryParticipantFetcher3.has(k))this.$MercuryParticipantFetcher2.add(k)};i.prototype.$MercuryParticipantFetcher7=function(){__p&&__p();if(this.$MercuryParticipantFetcher1||this.$MercuryParticipantFetcher2.size===0)return;this.$MercuryParticipantFetcher1=true;c("setImmediate")(function(){__p&&__p();this.$MercuryParticipantFetcher1=false;this.$MercuryParticipantFetcher2.forEach(function(k){return this.$MercuryParticipantFetcher3.add(k)}.bind(this));this.$MercuryParticipantFetcher9(this.$MercuryParticipantFetcher2,function(k){k.forEach(function(l){return this.$MercuryParticipantFetcher3["delete"](l.id)}.bind(this));this.$MercuryParticipantFetcher10(k);if(this.$MercuryParticipantFetcher6)clearTimeout(this.$MercuryParticipantFetcher6)}.bind(this));this.$MercuryParticipantFetcher11();this.$MercuryParticipantFetcher2.clear()}.bind(this))};i.prototype.$MercuryParticipantFetcher11=function(){this.$MercuryParticipantFetcher6=c("setTimeoutAcrossTransitions")(function(){this.$MercuryParticipantFetcher3.forEach(function(k){return this.$MercuryParticipantFetcher2.add(k)}.bind(this));this.$MercuryParticipantFetcher3.clear()}.bind(this),11*1e3)};i.prototype.$MercuryParticipantFetcher9=function(k,l){__p&&__p();var m=[];k.forEach(function(n){var o=c("MercuryIDs").tokenize(n),p=o.type,q=o.value;p==="fbid"&&m.push(q)});if(m.length>0){c("ShortProfiles").getMulti(m,function(n){var o=[];for(var p in n)o.push(j(n[p],p));l(o);if(o.length!==m.length)h.error("server_fetch_participant_count_error",JSON.stringify({expectedIDs:m,receivedIDs:Object.keys(n)}))});h.debug("client_fetch_participants",JSON.stringify({userIDs:m}))}};i.prototype.$MercuryParticipantFetcher10=function(k){this.$MercuryParticipantFetcher4.handleUpdate({participants:k,from_client:false,payload_source:c("MercuryPayloadSource").SERVER_FETCH_PARTICIPANTS})};function j(k,l){__p&&__p();var m=babelHelpers["extends"]({gender:k.gender,fbid:k.id||l,href:k.uri,id:c("MercuryIDs").getParticipantIDFromUserID(k.id||l),image_src:k.thumbSrc,name:k.name,short_name:k.firstName,employee:k.employee,is_employee_away:k.is_employee_away,type:k.type,vanity:k.vanity,is_friend:k.is_friend,is_messenger_user:k.is_messenger_user,is_coworker:k.is_coworker},{});if(k.officeStatus){m.officeStatus=k.officeStatus;m.officeStatusEndDate=k.officeStatusEndDate;m.officeStatusComment=k.officeStatusComment;m.officeStatusLocation=k.officeStatusLocation}if(k.timezone||k.timezone===0)m.timezone=k.timezone;if(k.personal_id)m.personal_id=k.personal_id;if(k.work_id)m.work_id=k.work_id;return m}f.exports=i}),null);
__d("ImageSourceType",[],(function a(b,c,d,e,f,g){var h=Object.freeze({PROFILE_PICTURE:"profile_picture",IMAGE:"image"});f.exports=h}),null);
__d("PhotoResizeModeConst",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CONTAIN:"s",COVER:"p"})}),null);
__d("ImageSourceRequest",["CurrentUser","ImageSourceType","KeyedCallbackManager","PhotoResizeModeConst","MercuryServerDispatcher"],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict";this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null}h.prototype.setFBID=function(l){"use strict";this._request.fbid=l;return this};h.prototype.setType=function(l){"use strict";if(![c("ImageSourceType").PROFILE_PICTURE,c("ImageSourceType").IMAGE].includes(l))throw new TypeError("ImageSourceRequest.setType: invalid type "+l);this._request.type=l;return this};h.prototype.setDimensions=function(l,m){"use strict";this._request.width=l;this._request.height=m;return this};h.prototype.setResizeMode=function(l){"use strict";if(![c("PhotoResizeModeConst").COVER,c("PhotoResizeModeConst").CONTAIN].includes(l))throw new TypeError("ImageSourceRequest.setResizeMode: invalid resize mode "+l);this._request.resize_mode=l;return this};h.prototype.setCallback=function(l){"use strict";this._callback=l;return this};h.prototype.send=function(){"use strict";__p&&__p();if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error("ImageSourceRequest: You must set all the fields");var l=j(),m=k(this._request);l.executeOrEnqueue(m,this._callback);if(l.getUnavailableResourcesFromRequest(m).length===1){c("MercuryServerDispatcher").trySend("/ajax/image_source.php",{requests:[this._request]});return true}return false};var i=null;function j(){__p&&__p();if(i)return i;var l=new(c("KeyedCallbackManager"))();i=l;c("MercuryServerDispatcher").registerEndpoints({"/ajax/image_source.php":{request_user_id:c("CurrentUser").getID(),mode:c("MercuryServerDispatcher").BATCH_DEFERRED_MULTI,batch_function:function m(n,o){var p;(p=n.requests).push.apply(p,o.requests);return n},handler:function m(n,o){var p=o.getData().requests;for(var q=0;q<p.length;++q)l.setResource(k(p[q]),n[q])}}});return l}function k(l){return[l.fbid,l.type,l.width,l.height,l.resize_mode].join("|")}f.exports=h}),null);
__d("MercuryParticipants",["fbt","CurrentUser","EventEmitter","ImageSourceRequest","ImageSourceType","ImmutableObject","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryParticipantFetcher","MercuryParticipantTypes","MercuryParticipantsConstants","MercuryDispatcher","MercuryVanityIDMap.bs","PhotoResizeModeConst","Set","createObjectFrom"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i="change";function j(l){__p&&__p();this.$MercuryParticipants1=l;this.$MercuryParticipants2=new(c("EventEmitter"))();this.$MercuryParticipants3=new(c("KeyedCallbackManager"))();this.$MercuryParticipants4=new(c("MercuryParticipantFetcher"))(this.$MercuryParticipants1);this.$MercuryParticipants5=c("MercuryDispatcher").getForFBID(this.$MercuryParticipants1);this.$MercuryParticipants5.subscribe("update-participants",function(m,n){if(n.participants&&n.participants.length>0)this.$MercuryParticipants6(n.participants)}.bind(this));this.$MercuryParticipants5.subscribe("invalidate-global-state",function(){this.$MercuryParticipants7()}.bind(this))}j.prototype.addListener=function(l,m){return this.$MercuryParticipants2.addListener(l,m)};j.prototype.getIDFromVanityOrFBID=function(l){if(!l)return null;if(c("MercuryVanityIDMap.bs").hasVanity(l))return c("MercuryVanityIDMap.bs").getID(l);if(/^\d+$/.test(l))return c("MercuryIDs").getParticipantIDFromUserID(l);return undefined};j.prototype.getNow=function(l){return this.$MercuryParticipants8(l)};j.prototype.getOrFetch=function(l){var m=this.$MercuryParticipants8(l);if(!m)this.$MercuryParticipants4.fetch(l);return m};j.prototype.get=function(l,m){c("MercuryAssert").isParticipantID(l);return this.$MercuryParticipants9([l],function(n){m(n[l])})};j.prototype.getMulti=function(l,m){return this.$MercuryParticipants9(l,m)};j.prototype.getBigImageMulti=function(l,m){__p&&__p();var n=arguments.length<=2||arguments[2]===undefined?c("MercuryParticipantsConstants").BIG_IMAGE_SIZE:arguments[2];c("MercuryAssert").allParticipantIDs(l);var o=false,p=this.$MercuryParticipants9(l,function(q){__p&&__p();var r={},s=0,t=new(c("Set"))(),u=function(w,y){s++;r[w]=y;if(s===l.length){if(!o)m(r);if(t.size>0)this.$MercuryParticipants10(t)}}.bind(this),v=function(w,y){var z=this.$MercuryParticipants3.getResource(w);if(!z)return;this.$MercuryParticipants3.setResource(w,c("ImmutableObject").set(z,{big_image_src:y.uri}));t.add(w);u(w,y.uri)}.bind(this);for(var w in q){var x=q[w];if(!x.big_image_src)new(c("ImageSourceRequest"))().setFBID(c("MercuryIDs").getUserIDFromParticipantID(w)).setType(c("ImageSourceType").PROFILE_PICTURE).setDimensions(n,n).setResizeMode(c("PhotoResizeModeConst").COVER).setCallback(v.bind(null,w)).send();else u(x.id,x.big_image_src)}}.bind(this));return{remove:function q(){o=true;p.remove()}}};j.prototype.getOrderedBigImageMulti=function(l,m){return this.getBigImageMulti(l,function(n){m(l.map(function(o){return n[o]}))})};j.prototype.$MercuryParticipants9=function(l,m){__p&&__p();c("MercuryAssert").allParticipantIDs(l);var n=this.$MercuryParticipants3.executeOrEnqueue(l,m),o=this.$MercuryParticipants3.getUnavailableResources(n).filter(function(p){__p&&__p();var q=c("MercuryIDs").tokenize(p),r=q.type,s=q.value;if(r==="email"){this.$MercuryParticipants11(p,s);return false}if(r==="name"){this.$MercuryParticipants12(p,s);return false}return true}.bind(this));this.$MercuryParticipants4.fetchMulti(o);return this.$MercuryParticipants13(n)};j.prototype.$MercuryParticipants8=function(l){var m=this.$MercuryParticipants3.getResource(l);if(!m){var n=c("MercuryIDs").tokenize(l),o=n.type,p=n.value;if(o==="email")m=this.$MercuryParticipants11(l,p);if(o==="name")m=this.$MercuryParticipants12(l,p)}return m};j.prototype.$MercuryParticipants11=function(l,m){var n=new(c("ImmutableObject"))(k(l,m));this.$MercuryParticipants3.setResource(l,n);return n};j.prototype.$MercuryParticipants12=function(l,m){var n=new(c("ImmutableObject"))({gender:c("MercuryParticipantsConstants").UNKNOWN_GENDER,href:null,id:l,image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,big_image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,name:m,short_name:m,employee:false});this.$MercuryParticipants3.setResource(l,n);return n};j.prototype.$MercuryParticipants10=function(l){this.$MercuryParticipants2.emit(i,l)};j.prototype.$MercuryParticipants6=function(l){var m=l.map(function(n){return n.id});l=l.map(function(n){if(n.vanity)c("MercuryVanityIDMap.bs").set(n.vanity,n.id);var o=this.$MercuryParticipants3.getResource(n.id);return o?c("ImmutableObject").set(o,n):new(c("ImmutableObject"))(this.$MercuryParticipants14(n))}.bind(this));this.$MercuryParticipants3.addResourcesAndExecute(c("createObjectFrom")(m,l));this.$MercuryParticipants10(new(c("Set"))(m))};j.prototype.$MercuryParticipants14=function(l){var m=l.type===c("MercuryParticipantTypes").USER||l.type===c("MercuryParticipantTypes").FRIEND;if(!m)return l;if(!l.name&&!l.href&&!l.vanity){var n=h._("Facebook User");l.name=n;l.short_name=n}return l};j.prototype.$MercuryParticipants13=function(l){return{remove:function(){this.$MercuryParticipants3.unsubscribe(l)}.bind(this)}};j.prototype.$MercuryParticipants7=function(){this.$MercuryParticipants3=new(c("KeyedCallbackManager"))()};function k(l,m){return{gender:c("MercuryParticipantsConstants").UNKNOWN_GENDER,href:null,id:l,image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,big_image_src:c("MercuryParticipantsConstants").EMAIL_IMAGE,name:m,short_name:m,employee:false,fbid:undefined,accepts_messenger_user_feedback:undefined,is_business_enabled:undefined,is_messenger_platform_bot:undefined,is_employee_away:undefined,is_friend:undefined,is_messenger_user:undefined,is_verified:undefined,type:undefined,vanity:undefined,timezone:undefined,personal_id:undefined,work_id:undefined}}f.exports=new j(c("CurrentUser").getID())}),null);
__d("MercuryDisplayTimeFilterMessageRenderer",["fbt"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i={renderFilteredContent:function j(k){if(k.is_filtered_content_bh)return h._("This message was removed because it contains blocked or harmful links.");if(k.is_filtered_content_account)return h._("This message has been temporarily removed because the sender's account requires verification.");if(k.is_filtered_content_quasar)return h._("This message was removed because it contains blocked or harmful content.");if(k.is_filtered_content_invalid_app)return h._("This message was removed because the app that it's being sent from is blocked from sending messages.");return h._("This message has been temporarily removed because the sender's account requires verification, or it has been identified as abusive.")}};f.exports=i}),null);
__d("MercuryGiftSnippetRenderer",["fbt"],(function a(b,c,d,e,f,g,h){"use strict";var i={renderText:function j(k,l){return k?h._("You sent a Valentine."):h._("{name} sent a Valentine.",[h.param("name",l)])}};f.exports=i}),null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h={generateMessageID:function j(k){var l=k||Date.now(),m=c("randomInt")(0,4294967295),n=c("PresenceUtil").getSessionID();return"<"+l+":"+m+"-"+n+"@mail.projektitan.com>"},generateThreadID:function j(k){return"root:"+h.generateOfflineThreadingID(k)},generateOfflineThreadingID:function j(k){var l=k||Date.now(),m=c("randomInt")(0,4294967295),n=("0000000000000000000000"+m.toString(2)).slice(-22),o=l.toString(2)+n;return i(o.slice(-63))}};function i(j){__p&&__p();var k="";while(j!="0"){var l=0,m="";for(var n=0;n<j.length;n++){l=2*l+parseInt(j[n],10);if(l>=10){m+="1";l-=10}else m+="0"}k=l.toString()+k;j=m.slice(m.indexOf("1"))}return k}f.exports=h}),null);
__d("MercurySyncFakeDFFSender",["Arbiter","ChannelConstants","MercurySingletonProvider","MercurySyncDeltaTypes"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("ChannelConstants").getArbiterType(c("ChannelConstants").FAKE_DFF);i.getForFBID=function(k){return j.getForFBID(k)};i.get=function(){return j.get()};function i(k){this.$MercurySyncFakeDFFSender1=k}i.prototype.sendGlobalDFF=function(){c("Arbiter").inform(h,{obj:{delta:{"class":c("MercurySyncDeltaTypes").ForcedFetch},queue:this.$MercurySyncFakeDFFSender1}})};i.prototype.sendThreadDFF=function(k,l){c("Arbiter").inform(h,{obj:{delta:{"class":c("MercurySyncDeltaTypes").ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l}},queue:this.$MercurySyncFakeDFFSender1}})};i.prototype.sendMessageDFF=function(k,l,m){c("Arbiter").inform(h,{obj:{delta:{"class":c("MercurySyncDeltaTypes").ForcedFetch,threadKey:{otherUserFbId:k,threadFbId:l},messageId:m},queue:this.$MercurySyncFakeDFFSender1}})};var j=new(c("MercurySingletonProvider"))(i);f.exports=i}),null);
__d("MessagingGiftWrapConstants",[],(function a(b,c,d,e,f,g){"use strict";var h="gift_wrap",i="gift_unwrapped",j="valentines2016";f.exports={TAG_PREFIX:h,UNWRAPPED_TAG:i,VALENTINES_GIFT:j}}),null);
__d("MessagingGiftWrapChecker",["MercuryConfig","MercuryTagHelper","MessagingGiftWrapConstants"],(function a(b,c,d,e,f,g){"use strict";var h={shouldRenderWithGiftWrap:function k(l){return!!(l.tags&&i(l.tags)&&!j(l.tags))}};function i(k){return c("MercuryTagHelper").get(k,c("MessagingGiftWrapConstants").TAG_PREFIX)===c("MessagingGiftWrapConstants").VALENTINES_GIFT}function j(k){return!!c("MercuryTagHelper").get(k,c("MessagingGiftWrapConstants").UNWRAPPED_TAG)}f.exports=h}),null);
__d("MercuryThreads",["invariant","ChatReliabilityInstrumentation","EventEmitter","EventReminderConstants","MercuryDisplayTimeFilterMessageRenderer","ImmutableObject","KeyedCallbackManager","LogHistory","Map","MercuryActionType","MercuryAssert","MercuryAttachment","MercuryDispatcher","MercuryGiftSnippetRenderer","MercuryGlobalActionType","MercuryIDs","MercuryLocalIDs","MercuryLoggingHelper","MercuryLogMessageType","MercuryParticipants","MercuryPayloadSource","MercuryServerRequests","MercurySingletonProvider","MercurySyncFakeDFFSender","MercuryThreadInfo","MercuryThreadInformer","MessagingGenericAdminTextType","MessagingGiftWrapChecker","MessagingTag","PageCommItemStatus","Set","emptyFunction","ifRequired","requireWeak","setImmediate"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("EventReminderConstants").GuestStates,j=new(c("EventEmitter"))(),k=c("LogHistory").getInstance("mercury_threads"),l=new(c("Set"))();function m(o){__p&&__p();this.$MercuryThreads1=o;this.$MercuryThreads2=c("MercuryServerRequests").getForFBID(this.$MercuryThreads1);this.$MercuryThreads3=c("MercuryThreadInformer").getForFBID(this.$MercuryThreads1);this.$MercuryThreads4=c("MercuryIDs").getParticipantIDFromUserID(this.$MercuryThreads1);this.$MercuryThreads5=c("MercuryDispatcher").getForFBID(this.$MercuryThreads1);this.$MercuryThreads6=c("MercurySyncFakeDFFSender").getForFBID(this.$MercuryThreads1);this.$MercuryThreads7=false;this.$MercuryThreads8=new(c("KeyedCallbackManager"))();this.$MercuryThreads9=new(c("Set"))();this.$MercuryThreads10=false;this.$MercuryThreads11=new(c("Set"))();this.$MercuryThreads12=new(c("Set"))();this.$MercuryThreads13()}m.getForFBID=function(o){return n.getForFBID(o)};m.get=function(){return n.get()};m.prototype.getThreadMetaNow=function(o){c("MercuryAssert").isThreadID(o);var p=this.$MercuryThreads8.getResource(o);if(p&&!p.participants){c("ChatReliabilityInstrumentation").logERROR("participants are null!",{thread_id:o});this.$MercuryThreads6.sendThreadDFF(null,o);return new(c("ImmutableObject"))(babelHelpers["extends"]({},p,{participants:[]}))}return p};m.prototype.getOrFetch=function(o){var p=this.getThreadMetaNow(o);if(!p&&!this.$MercuryThreads12.has(o))this.$MercuryThreads11.add(o);if(this.$MercuryThreads11.size>0&&!this.$MercuryThreads10)this.$MercuryThreads14();return p};m.prototype.$MercuryThreads14=function(){__p&&__p();if(this.$MercuryThreads10)return;this.$MercuryThreads10=true;c("setImmediate")(function(){this.$MercuryThreads10=false;this.$MercuryThreads11.forEach(function(o){return this.$MercuryThreads12.add(o)}.bind(this));this.getMultiThreadMeta(Array.from(this.$MercuryThreads11),function(o){for(var p in o)Object.prototype.hasOwnProperty.call(o,p)&&this.$MercuryThreads12["delete"](p)}.bind(this));this.$MercuryThreads11.clear()}.bind(this))};m.prototype.getThreadMeta=function(o,p,q){return this.getMultiThreadMeta([o],function(r){return p(r[o])},q)};m.prototype.getMultiThreadMeta=function(o,p,q){__p&&__p();c("MercuryAssert").allThreadID(o);var r=this.$MercuryThreads8.executeOrEnqueue(o,p),s=this.$MercuryThreads8.getUnavailableResources(r);if(s.length){var t=[];for(var u=0;u<s.length;u++){var v=s[u],w=c("MercuryIDs").tokenize(v),x=w.type,y=w.value;if(x=="user"){var z=c("MercuryIDs").getParticipantIDFromUserID(y);this.createNewLocalThread(v,z===this.$MercuryThreads4?[this.$MercuryThreads4]:[this.$MercuryThreads4,z])}t.push(v)}if(t.length)this.$MercuryThreads2.fetchThreadData(t,q)}return r};m.addListener=function(o,p){return j.addListener(o,p)};m.prototype.unsubscribe=function(o){this.$MercuryThreads8.unsubscribe(o)};m.prototype.getCanonicalThreadToParticipant=function(o,p,q,r){var s=c("MercuryIDs").getThreadIDFromParticipantID(o);!!s||h(0);var t=this.$MercuryThreads8.getResource(s);if(t==undefined){t=this.createNewLocalThread(s,this.$MercuryThreads4===o?[this.$MercuryThreads4]:[this.$MercuryThreads4,o],p);!r&&this.$MercuryThreads2.fetchThreadData([s],q)}return t};m.prototype.createNewLocalThread=function(o,p,q){var r=this.$MercuryThreads8.getResource(o);if(!r){var s=c("MercuryIDs").tokenize(o),t=s.type,u=s.value;r=new(c("ImmutableObject"))({thread_id:o,participants:Array.from(p),admin_ids:[],name:"",snippet:"",snippet_sender:null,unread_count:q?q:0,message_count:0,image_src:null,timestamp:null,other_user_fbid:t==="user"?u:null,is_canonical_user:t=="user",is_canonical:this.$MercuryThreads15(p),is_subscribed:true,folder:c("MessagingTag").INBOX,is_archived:false,is_page_follow_up:false});this.$MercuryThreads8.setResource(o,r)}return r};m.prototype.createNewLocalThreadGenerateID=function(){var o=c("MercuryLocalIDs").generateThreadID();this.createNewLocalThread(o,[]);return o};m.prototype.isEmptyLocalThread=function(o){var p=this.$MercuryThreads8.getResource(o);if(!p)return false;return c("MercuryThreadInfo").isEmptyLocalThread(p)};m.prototype.isNewEmptyLocalThread=function(o){var p=this.$MercuryThreads8.getResource(o);if(!p)return false;return c("MercuryThreadInfo").isNewEmptyLocalThread(p)};m.prototype.$MercuryThreads16=function(o,p){__p&&__p();if(!o||!o.length)return;var q=new(c("Map"))(),r=new(c("Map"))(),s=new(c("Map"))(),t=[];for(var u=0;u<o.length;u++){var v=o[u],w=v.action_type;if(w==c("MercuryActionType").LOG_MESSAGE&&v.log_message_type==c("MercuryLogMessageType").SERVER_ERROR)continue;var x=!p&&!!(v.thread_fbid||v.other_user_fbid||v.is_from_iris),y=v.thread_id;c("MercuryAssert").isThreadID(y);var z=this.$MercuryThreads8.getResource(y);if(!z&&!x&&w===c("MercuryActionType").USER_GENERATED_MESSAGE){z=this.$MercuryThreads17(v);if(!z.participants||!z.participants.length){k.debug("missing_local_participants",JSON.stringify(c("MercuryLoggingHelper").obfuscateMessage(v)));c("ChatReliabilityInstrumentation").logERROR("missing_local_participants",{thread_id:y});z=new(c("ImmutableObject"))(babelHelpers["extends"]({},z,{participants:[]}));var A=v.other_user_fbid,B=v.thread_fbid;if(A||B)this.$MercuryThreads6.sendThreadDFF(A,B);else continue}this.$MercuryThreads8.setResource(y,z)}if(!z)continue;if(w==c("MercuryActionType").LOG_MESSAGE||w==c("MercuryActionType").USER_GENERATED_MESSAGE)x=!p;if(z.server_timestamp&&v.timestamp<z.server_timestamp&&x)continue;if(z.server_timestamp&&w===c("MercuryActionType").USER_GENERATED_MESSAGE&&v.offline_threading_id&&v.author!==c("MercuryIDs").getParticipantIDFromUserID(this.$MercuryThreads1))if(l.has(v.offline_threading_id))continue;else l.add(v.offline_threading_id);if(!s.has(y))s.set(y,babelHelpers["extends"]({},z));else k.error("skipping thread metadata update",JSON.stringify({have:s.get(y),skipped:z}));var C=s.get(y);!!C||h(0);this.$MercuryThreads18(C,v,p);var D=q.get(y);if(w==c("MercuryActionType").USER_GENERATED_MESSAGE&&(!D||v.timestamp>D.timestamp))q.set(y,v);if((w==c("MercuryActionType").USER_GENERATED_MESSAGE||w==c("MercuryActionType").LOG_MESSAGE)&&!v.skip_bump_thread)if(v&&v.timestamp&&(!r.has(y)||v.timestamp>r.get(y).timestamp))r.set(y,v)}s.forEach(function(E,F){__p&&__p();var G=r.get(F),D=q.get(F);if(D)this.$MercuryThreads19(E,D);else if(G&&G.log_message_body){var H=babelHelpers["extends"]({},G,{body:G.log_message_body});this.$MercuryThreads19(E,H)}var I=E.timestamp;if(G){if(G.timestamp>I)Object.assign(E,{timestamp:G.timestamp});var J=E.server_timestamp;if(!p&&G.timestamp>J)E.server_timestamp=G.timestamp}var K=new(c("ImmutableObject"))(E);if((!K.participants||!K.participants.length)&&!this.isEmptyLocalThread(K.thread_id)){var L=(o||[]).map(c("MercuryLoggingHelper").obfuscateMessage),M={update:c("MercuryLoggingHelper").obfuscateThread(K),actions:L};k.error("bad metadata update no_participants",JSON.stringify(M));c("ChatReliabilityInstrumentation").logERROR("refusing to set thread metadata with no participants",M);return}this.$MercuryThreads8.setResource(F,K);t.push(c("MercuryLoggingHelper").obfuscateThread(K))}.bind(this),this);t.length&&this.$MercuryThreads7&&k.debug("threads_updated",JSON.stringify({threads:t}))};m.prototype.$MercuryThreads18=function(o,p,q){__p&&__p();var r=p.action_type;if(r==c("MercuryActionType").USER_GENERATED_MESSAGE||r==c("MercuryActionType").LOG_MESSAGE){if(p.is_unread||p.skip_bump_thread)if(!(o.unread_count===0&&p.skip_bump_thread))if(p.timestamp>o.server_timestamp)o.unread_count++;o.message_count++;o.is_archived=false}switch(r){case c("MercuryActionType").DELETE_THREAD:o.message_count=0;this.$MercuryThreads20(p.thread_id);break;case c("MercuryActionType").USER_GENERATED_MESSAGE:if(o.unread_count===0&&p.author===this.$MercuryThreads4&&p.timestamp>=o.last_read_timestamp)o.last_read_timestamp=p.timestamp;if(p.offline_threading_id!==p.message_id)o.last_message_timestamp=p.timestamp;if(p.comm_status!=null)if(o.comm_status&&o.comm_status.toUpperCase()!==c("PageCommItemStatus").FOLLOW_UP)o.comm_status=p.comm_status;if(p.creator_info&&p.creator_info.pageID===this.$MercuryThreads1)o.folder=p.folder;this.$MercuryThreads21(o,p.author);break;case c("MercuryActionType").SEND_MESSAGE:var s=p.log_message_type;if(s==c("MercuryLogMessageType").THREAD_IMAGE){o.image_src=p.log_message_data.image?p.log_message_data.image.preview_url:null;this.$MercuryThreads22(p.thread_id)}if(s!==c("MercuryLogMessageType").SUBSCRIBE&&s!==c("MercuryLogMessageType").UNSUBSCRIBE)o.snippet_attachments=p.attachments;break;case c("MercuryActionType").LOG_MESSAGE:var s=p.log_message_type;if(s==c("MercuryLogMessageType").SUBSCRIBE&&!q){this.$MercuryThreads23(o,p.log_message_data.added_participants);this.$MercuryThreads22(p.thread_id)}else if(s==c("MercuryLogMessageType").UNSUBSCRIBE&&!q){this.$MercuryThreads24(o,p.log_message_data.removed_participants);this.$MercuryThreads22(p.thread_id)}else if(s==c("MercuryLogMessageType").THREAD_IMAGE){if(!q)o.image_src=p.log_message_data.image?p.log_message_data.image.preview_url:null}else if(s==c("MercuryLogMessageType").THREAD_NAME){if(o.name!==p.log_message_data.name)this.$MercuryThreads22(p.thread_id);o.name=p.log_message_data.name}else if(s===c("MercuryLogMessageType").GENERIC_ADMIN_TEXT)this.$MercuryThreads25(o,p);break;case c("MercuryActionType").CHANGE_READ_STATUS:var t=this.$MercuryThreads26(o,p,p.mark_as_read);if(t)o.last_read_timestamp=o.last_message_timestamp;var u=!o.read_only&&o.folder===c("MessagingTag").INBOX;if(t&&q)this.$MercuryThreads2.changeThreadReadStatus(o.thread_id,p.mark_as_read,p.source,o.last_read_timestamp,u,o.last_message_type);break;case c("MercuryActionType").CHANGE_ARCHIVED_STATUS:if(o.is_archived!=p.archived){o.is_archived=p.archived;if(o.comm_status!=null)o.comm_status=p.archived?c("PageCommItemStatus").DONE:c("PageCommItemStatus").TODO;this.$MercuryThreads22(p.thread_id)}break;case c("MercuryActionType").CHANGE_PAGE_FOLLOW_UP_STATUS:if(o.is_page_follow_up!=p.is_page_follow_up){o.is_page_follow_up=p.is_page_follow_up;this.$MercuryThreads22(p.thread_id)}break;case c("MercuryActionType").CHANGE_FOLDER:if(o.folder!=p.new_folder){o.folder=p.new_folder;if(o.comm_status!=null)if(p.new_folder===c("MessagingTag").OTHER)o.comm_status=c("PageCommItemStatus").SPAM;else if(p.new_folder===c("MessagingTag").INBOX)o.comm_status=c("PageCommItemStatus").TODO;this.$MercuryThreads22(p.thread_id)}break;case c("MercuryActionType").DELETE_MESSAGES:if(q){o.snippet="...";o.snippet_attachments=null;o.snippet_sender=null;this.$MercuryThreads22(p.thread_id)}else if(p.message_ids){o.message_count-=p.message_ids.length;c("ifRequired")("MercuryMessages",function(y){__p&&__p();y=y.getForFBID(this.$MercuryThreads1);for(var z=p.message_ids,A=Array.isArray(z),B=0,z=A?z:z[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var C;if(A){if(B>=z.length)break;C=z[B++]}else{B=z.next();if(B.done)break;C=B.value}var D=C,E=y.getMessagesFromIDs([D]),F=E[0];if(F&&F.timestamp>o.last_read_timestamp)o.unread_count=Math.max(0,o.unread_count-1)}this.$MercuryThreads22(p.thread_id)}.bind(this),c("emptyFunction"))}break;case c("MercuryActionType").UPDATE_SNIPPET:c("ifRequired")("MercuryMessages",function(y){__p&&__p();y=y.getForFBID(this.$MercuryThreads1);var z=0,A=1,B=y.getThreadMessagesRangeNow(p.thread_id,z,A),C=B[0];if(C){o.snippet=C.body;o.snippet_attachments=C.attachments;o.snippet_sender=C.author}else{o.snippet="...";o.snippet_attachments=null;o.snippet_sender=null;y.getThreadMessagesRange(p.thread_id,z,A,function(D){if(D.length)this.$MercuryThreads5.handleUpdate({from_client:true,actions:[{thread_id:p.thread_id,action_type:c("MercuryActionType").UPDATE_SNIPPET,deleted_ids:p.deleted_ids}]})}.bind(this))}this.$MercuryThreads22(p.thread_id)}.bind(this),c("emptyFunction"));break;case c("MercuryActionType").CHANGE_MUTE_SETTINGS:if(Object.prototype.hasOwnProperty.call(p,"reactions_mute_mode"))o.reactions_mute_mode=p.reactions_mute_mode;else if(Object.prototype.hasOwnProperty.call(p,"mentions_mute_mode"))o.mentions_mute_mode=p.mentions_mute_mode;else o.mute_until=!p.mute_until?undefined:p.mute_until;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").BLOCK_STATUS_CHANGED:o.can_reply=p.canViewerReply;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").ADD_PARTICIPANTS:this.$MercuryThreads23(o,p.participants);this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").CHANGE_FLAG:this.$MercuryThreads27(o,p.mark_as_flag);this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").MOVE_PENDING_TO_INBOX:this.$MercuryThreads28(o);this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").UPDATE_CUSTOM_LIKE:o.custom_like_icon=p.custom_like;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").ADD_GROUP_ADMINS:o.admin_ids=o.admin_ids.concat(p.added_admin_ids.filter(function(y){return o.admin_ids.indexOf(y)===-1}));this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").REMOVE_GROUP_ADMINS:o.admin_ids=o.admin_ids.filter(function(y){return p.removed_admin_ids.indexOf(y)===-1});this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").JOINABLE_MODE:o.joinable_mode=p.joinable_mode;this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").APPROVAL_MODE:o.approval_mode=p.approval_mode;this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").APPROVAL_QUEUE:if(p.added_id&&o.approval_queue_ids&&o.approval_queue_ids.indexOf(p.added_id)===-1)o.approval_queue_ids=o.approval_queue_ids.concat(p.added_id);if(p.removed_id&&o.approval_queue_ids)o.approval_queue_ids=o.approval_queue_ids.filter(function(y){return p.removed_id!==y});if(p.added_group_id&&o.group_approval_queue&&!o.group_approval_queue.find(function(y){p.added_group_id.requester.id===y.requesterId}))o.group_approval_queue=o.group_approval_queue.concat([p.added_group_id]);if(p.removed_group_id&&o.group_approval_queue)o.group_approval_queue=o.group_approval_queue.filter(function(y){return p.removed_group_id!==y.requester.id});this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").IS_PIN_PROTECTED:o.is_pin_protected=p.is_pin_protected;this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").UPDATE_RTC_CALL_DATA:var v=p.initiator_fbid||(o.rtc_call_data?o.rtc_call_data.initiator_fbid:undefined);o.rtc_call_data=new(c("ImmutableObject"))({call_state:p.call_state,server_info_data:p.server_info_data,initiator_fbid:v});this.$MercuryThreads22(p.thread_id);break;case c("MercuryActionType").UPDATE_COMM_STATUS:this.$MercuryThreads29(o,p.comm_status);this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").UPDATE_COMM_ITEM_OWNER:var w=void 0;if(p.id===null)w={nodes:[]};else w={nodes:[{admin:{id:p.id,name:p.name,profile_picture:{uri:p.profile_pic_uri}}}]};o.comm_item_owners=w;this.$MercuryThreads22(o.thread_id);break;case c("MercuryActionType").EVENT_RSVP_CHANGED:var x=o.participants_event_status.filter(function(y){return y.participant_id!==p.actor_fbid});x.push({participant_id:p.actor_fbid.toString(),event_status:p.rsvp_status});o.participants_event_status=x;this.$MercuryThreads22(p.thread_id);break}};m.prototype.$MercuryThreads25=function(o,p){__p&&__p();var q,r=this;if(p.log_message_data&&p.log_message_data.untypedData)(function(){__p&&__p();var s=p.log_message_data.untypedData,event=o.lightweight_event;switch(p.log_message_data.message_type){case c("MessagingGenericAdminTextType").THREAD_EPHEMERAL_SEND_MODE:var t=parseInt(s.ttl,10);if(t!==null&&o.ephemeral_ttl_mode!==t){o.ephemeral_ttl_mode=t;r.$MercuryThreads22(p.thread_id)}break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_NICKNAME:var u={};for(var v in o.custom_nickname){if(v==s.participant_id&&s.nickname.trim().length==0)continue;u[v]=o.custom_nickname[v]}if(s.nickname.trim().length>0)u[s.participant_id]=s.nickname;o.custom_nickname=u;r.$MercuryThreads22(p.thread_id);break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_ICON:c("requireWeak")("MercuryThreadActions",function(z){z.getForFBID(this.$MercuryThreads1).updateCustomLike(p.thread_id,s.thread_icon)}.bind(r));break;case c("MessagingGenericAdminTextType").CHANGE_THREAD_THEME:var w=s.theme_color;if(w&&w.length>0)o.custom_color="#".concat(w.substring(2));else o.custom_color=null;r.$MercuryThreads22(p.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_CREATE:var x={};o.participants.map(function(z){var A=c("MercuryIDs").getUserIDFromParticipantID(z);if(A)x[A]=A===s.event_creator_id?i.GOING:i.INVITED},r);o.lightweight_event={track_rsvp:s.event_track_rsvp,title:s.event_title,event_time:parseInt(s.event_time,10),location_name:s.event_location_name,event_members:x,oid:s.event_id,event_type:s.event_type};r.$MercuryThreads22(p.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TIME:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_TITLE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_UPDATE_LOCATION:if(event)o.lightweight_event=r.$MercuryThreads30(s,event,event.event_members);r.$MercuryThreads22(p.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_RSVP:if(event&&event.event_members){var y=r.$MercuryThreads31(event.event_members,s);o.lightweight_event=r.$MercuryThreads30(s,event,y)}r.$MercuryThreads22(p.thread_id);break;case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_DELETE:case c("MessagingGenericAdminTextType").LIGHTWEIGHT_EVENT_NOTIFY:o.lightweight_event=null;r.$MercuryThreads22(p.thread_id);break}})()};m.prototype.$MercuryThreads31=function(o,p){var q={};for(var r in o)q[r]=o[r];q[p.guest_id]=p.guest_status;return q};m.prototype.$MercuryThreads30=function(o,event,p){return{track_rsvp:event.track_rsvp,title:o.event_title===undefined?event.title:o.event_title,event_time:o.event_time===undefined?event.event_time:parseInt(o.event_time,10),location_name:o.event_location_name===undefined?event.location_name:o.event_location_name,event_members:p===undefined?event.event_members:p,oid:event.oid,event_type:event.event_type}};m.prototype.$MercuryThreads17=function(o){var p=c("MercuryIDs").tokenize(o.thread_id),q=p.type,r=p.value,s=q==="user",t=s||o.specific_to_list&&this.$MercuryThreads15(o.specific_to_list),u=t||s?this.$MercuryThreads32(o):o.specific_to_list;return new(c("ImmutableObject"))({thread_id:o.thread_id,participants:u,name:null,snippet:o.body,snippet_attachments:[],snippet_sender:o.author,unread_count:0,message_count:0,image_src:null,timestamp:o.timestamp,other_user_fbid:s?r:null,is_canonical_user:s,is_canonical:t,is_subscribed:true,folder:c("MessagingTag").INBOX,is_archived:false,is_page_follow_up:false})};m.prototype.$MercuryThreads26=function(o,p,q){__p&&__p();if(p.timestamp)this.$MercuryThreads33(o.thread_id,q,p.timestamp);if(!o||!o.thread_id||!o.participants)return false;if(!o.timestamp){this.$MercuryThreads9.add(o.thread_id);return false}var r=!o.unread_count;if(q==r)return false;o.unread_count=q?0:1;this.$MercuryThreads22(o.thread_id);return true};m.prototype.$MercuryThreads34=function(o){var p=this.$MercuryThreads8.getAllResources();for(var q in p)if(Object.prototype.hasOwnProperty.call(p,q)){var r=p[q];if(r.folder==o){this.$MercuryThreads8.setResource(q,c("ImmutableObject").setProperty(r,"unread_count",0));this.$MercuryThreads22(q)}}};m.prototype.$MercuryThreads23=function(o,p){__p&&__p();var q=new(c("Set"))(o.participants);o.participants=Array.from(o.participants||[]);p.forEach(function(r){if(!q.has(r)){o.participants.push(r);if(r===this.$MercuryThreads4){o.is_subscribed=true;o.can_reply=true;o.cannot_reply_reason=null;this.$MercuryThreads6.sendThreadDFF(undefined,o.thread_fbid)}}}.bind(this))};m.prototype.$MercuryThreads24=function(o,p){__p&&__p();var q=new(c("Set"))(p);if(o&&!o.participants)c("ChatReliabilityInstrumentation").logERROR("participants are null in thread_info!",{thread_info:o});else o.participants=o.participants.filter(function(r){return!q.has(r)});if(o&&!o.admin_ids)c("ChatReliabilityInstrumentation").logERROR("admin_ids are null in thread_info!",{thread_info:o});else o.admin_ids=o.admin_ids.filter(function(r){return!q.has(r)});if(q.has(this.$MercuryThreads4))o.is_subscribed=false;this.$MercuryThreads2.fetchThreadData([o.thread_id])};m.prototype.$MercuryThreads21=function(o,p){if(!o.participants){var q=JSON.stringify({thread_info:o,participant:p});k.error("missing_participants",q);return}var r=o.participants.indexOf(p);if(r>0)o.participants=[p].concat(o.participants.slice(0,r),o.participants.slice(r+1))};m.prototype.$MercuryThreads19=function(o,p){__p&&__p();var q=p.body,r=p.subject,s="";if(r){r=r.toLowerCase();if(q.slice(0,r.length).toLowerCase()==r)s=q;else if(q)s=r+" \xb7 "+q;else s=r}else s=q;if(p.is_filtered_content)s=c("MercuryDisplayTimeFilterMessageRenderer").renderFilteredContent(p);if(c("MessagingGiftWrapChecker").shouldRenderWithGiftWrap(p)){var t=p.author,u=t==this.$MercuryThreads4,v=null;if(!u){v=o.custom_nickname&&o.custom_nickname[c("MercuryIDs").getUserIDFromParticipantID(t)];if(!v){var w=c("MercuryParticipants").getNow(t);if(w!=null)v=w.short_name}}s=c("MercuryGiftSnippetRenderer").renderText(u,v)}o.snippet=s;if(p.raw_attachments&&p.raw_attachments.length>0){var x=c("MercuryAttachment").convertRaw(p.raw_attachments);o.snippet_attachments=x}else o.snippet_attachments=p.attachments;if(p.log_message_type)o.snippet_sender=null;else o.snippet_sender=p.author};m.prototype.$MercuryThreads27=function(o,p){o.page_thread_info=babelHelpers["extends"]({},o.page_thread_info,{flagged:p})};m.prototype.$MercuryThreads29=function(o,p){o.comm_status=p};m.prototype.$MercuryThreads28=function(o){if(o.folder!==c("MessagingTag").PENDING)return;o.folder=c("MessagingTag").INBOX};m.prototype.$MercuryThreads15=function(o){return o.filter(function(p){return p!=this.$MercuryThreads4}.bind(this)).length<=1};m.prototype.$MercuryThreads13=function(){__p&&__p();this.$MercuryThreads5.subscribe("invalidate-thread-state",function(o,p){return this.$MercuryThreads35(p)}.bind(this));this.$MercuryThreads5.subscribe("invalidate-global-state",function(o,p){return this.$MercuryThreads36()}.bind(this));this.$MercuryThreads5.subscribe("update-threads",function(o,p){__p&&__p();var q=(p.actions||[]).filter(function(r){return r.thread_id});if(p.threads&&p.payload_source==c("MercuryPayloadSource").SERVER_FETCH_THREAD_INFO)p.threads.forEach(function(r){var s=r.thread_id;if(this.$MercuryThreads9.has(s)){this.$MercuryThreads9["delete"](s);if(r.unread_count)this.$MercuryThreads2.changeThreadReadStatus(r.thread_id,true)}}.bind(this));this.$MercuryThreads37(p.threads);this.$MercuryThreads16(q,p.from_client);p.threads&&p.threads.forEach(function(r){this.$MercuryThreads22(r.thread_id)}.bind(this));if(p.global_actions)p.global_actions.forEach(function(r){if(r.action_type==c("MercuryGlobalActionType").MARK_ALL_READ)this.$MercuryThreads34(r.folder)}.bind(this));if(this.$MercuryThreads7){this.$MercuryThreads7=false;j.emit("change")}}.bind(this))};m.prototype.$MercuryThreads37=function(o){if(!o||!o.length)return;var p={},q=[];o.forEach(function(r){var s=new(c("ImmutableObject"))(r);p[r.thread_id]=s;q.push(c("MercuryLoggingHelper").obfuscateThread(s))});q.length&&k.debug("threads_added",JSON.stringify({threads:q}));this.$MercuryThreads8.addResourcesAndExecute(p)};m.prototype.$MercuryThreads22=function(o){this.$MercuryThreads7=true;this.$MercuryThreads3.updatedThread(o)};m.prototype.$MercuryThreads20=function(o){this.$MercuryThreads7=true;this.$MercuryThreads3.deletedThread(o)};m.prototype.$MercuryThreads33=function(o,p,q){this.$MercuryThreads7=true;this.$MercuryThreads3.changedThreadReadState(o,p,q)};m.prototype.$MercuryThreads35=function(o){this.$MercuryThreads8.setResource(o,undefined)};m.prototype.$MercuryThreads36=function(){this.$MercuryThreads7=false;this.$MercuryThreads8=new(c("KeyedCallbackManager"))();this.$MercuryThreads9=new(c("Set"))();this.$MercuryThreads10=false;this.$MercuryThreads11=new(c("Set"))();this.$MercuryThreads12=new(c("Set"))()};m.prototype.$MercuryThreads32=function(o){if(o.specific_to_list)return o.specific_to_list;var p=c("MercuryIDs").tokenize(o.thread_id),q=p.type,r=p.value;if(!r||q!=="user")return[this.$MercuryThreads4];return[c("MercuryIDs").getParticipantIDFromUserID(r),this.$MercuryThreads4]};var n=new(c("MercurySingletonProvider"))(m);f.exports=m}),null);